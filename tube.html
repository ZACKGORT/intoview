<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=no,viewport-fit=cover" />
  <title>v intoview:tube</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <style>
:root {
  --bg-color: #050505;
  --card-bg: #111111;
  --ink: #ffffff;
  --ink-dim: #888888;
  --accent: #FF0000;
  --neon-green: #22c55e;
  --neon-orange: #f97316;
  --neon-red: #ef4444;
  --neon-blue: #3b82f6;
  --youtube-red: #FF0000;
  --glass-bg: rgba(20, 20, 20, 0.85);
  --glass-border: rgba(255, 255, 255, 0.1);
  --glass-blur: 16px;
  --nav-height: 80px;
  --header-height: 100px;
  --font-mono: 'JetBrains Mono', monospace;
  --font-sans: 'Inter', sans-serif;
  --edge-blur-amount: 4px;
  --vignette-strength: 0.6;
  --vignette-size: 20%;
}

[data-theme="light"] {
  --bg-color: #ffffff;
  --card-bg: #ffffff;
  --ink: #000000;
  --ink-dim: #666666;
  --accent: #FF0000;
  --glass-bg: rgba(0, 0, 0, 0.03);
  --glass-border: rgba(0, 0, 0, 0.15);
  --neon-green: #006400;
  --neon-orange: #ff6600;
  --neon-red: #cc0000;
  --neon-blue: #0066cc;
  --vignette-strength: 0;
  --edge-blur-amount: 0px;
}

[data-theme="light"] .logo-cube .f-face {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #000000;
  box-shadow: none;
  animation: none;
}

[data-theme="light"] .logo-text {
  color: #000000;
  text-shadow: none;
}

[data-theme="light"] .logo:hover .logo-text {
  transform: scale(1.05);
  filter: none;
}

[data-theme="light"] .logo-cube .fab-cube {
  animation: spin 6s linear infinite;
}

[data-theme="rose"] {
  --bg-color: #0a0a0a;
  --card-bg: #1a1a1a;
  --ink: #ffffff;
  --ink-dim: #cccccc;
  --accent: #ff8da1;
  --rose-primary: #ff8da1;
  --rose-secondary: #ff6b8b;
  --retro-blue: #00d4ff;
  --retro-yellow: #ffeb3b;
  --retro-purple: #e91e63;
  --glass-bg: rgba(255, 141, 161, 0.05);
  --glass-border: rgba(255, 141, 161, 0.2);
}

[data-theme="theater"] {
  --bg-color: #000000;
  --card-bg: #0a0a0a;
  --ink: #e0e0e0;
  --ink-dim: #666666;
  --accent: #ff0000;
  --glass-bg: rgba(0, 0, 0, 0.9);
  --glass-border: rgba(255, 0, 0, 0.2);
  --vignette-strength: 0.8;
  --neon-green: #00ff00;
  --neon-orange: #ff8800;
  --neon-red: #ff0000;
  --neon-blue: #0088ff;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: var(--font-sans);
  background: var(--bg-color);
  color: var(--ink);
  overflow: hidden;
  position: relative;
  min-height: 100vh;
  overscroll-behavior: none;
}

.toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--card-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 12px 20px;
  color: var(--ink);
  font-weight: 500;
  z-index: 10000;
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
  max-width: 300px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.toast.info {
  border-left: 4px solid var(--neon-blue);
}

.toast.error {
  border-left: 4px solid var(--neon-red);
}

.toast.success {
  border-left: 4px solid var(--neon-green);
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  box-shadow: inset 0 0 60px rgba(0,0,0,0.5);
  backdrop-filter: blur(var(--edge-blur-amount));
  -webkit-backdrop-filter: blur(var(--edge-blur-amount));
  mask-image: linear-gradient(to bottom, black 0%, transparent 10%, transparent 90%, black 100%),
              linear-gradient(to right, black 0%, transparent 10%, transparent 90%, black 100%);
  mask-composite: source-in;
  pointer-events: none;
  z-index: 10;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(
    circle at center,
    transparent 40%,
    rgba(0, 0, 0, var(--vignette-strength)) 100%
  );
  pointer-events: none;
  z-index: 200;
}

[data-theme="rose"] body::after {
    background: radial-gradient(
    circle at center,
    transparent 40%,
    rgba(50, 0, 20, var(--vignette-strength)) 100%
  );
}

[data-theme="light"] body::after {
    background: radial-gradient(
    circle at center,
    transparent 40%,
    rgba(0, 0, 0, 0.3) 100%
  );
}

::-webkit-scrollbar { 
  width: 6px; 
  height: 6px; 
}

::-webkit-scrollbar-track { 
  background: transparent; 
}

::-webkit-scrollbar-thumb { 
  background: var(--glass-border); 
  border-radius: 3px; 
}

::-webkit-scrollbar-thumb:hover { 
  background: var(--ink-dim); 
}

.text-green { color: var(--neon-green); }
.text-orange { color: var(--neon-orange); }
.text-red { color: var(--neon-red); }
.text-blue { color: var(--neon-blue); }
.text-rose { color: var(--rose-primary); }

[data-theme="rose"] .text-green { color: var(--retro-blue); }
[data-theme="rose"] .text-orange { color: var(--retro-yellow); }
[data-theme="rose"] .text-red { color: var(--rose-secondary); }
[data-theme="rose"] .text-blue { color: var(--retro-purple); }

.app-header {
  position: fixed; 
  top: 0; 
  left: 0; 
  right: 0; 
  height: var(--header-height);
  display: flex; 
  flex-direction: column; 
  justify-content: center;
  padding: 10px 0; 
  z-index: 9999;
  background: linear-gradient(to bottom, var(--bg-color) 40%, transparent);
  pointer-events: none;
}

.header-top {
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    padding: 0 20px; 
    width: 100%; 
    pointer-events: auto;
    height: 70px;
}

.logo-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
}

.logo-cube {
  width: 32px;
  height: 32px;
  position: relative;
  perspective: 600px;
}

.logo-cube .fab-cube {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transform: rotateX(-25deg) rotateY(-45deg);
  animation: spin 6s linear infinite;
}

.logo-cube .f-face {
  position: absolute;
  width: 16px;
  height: 16px;
  left: 8px;
  top: 8px;
  background: rgba(255, 0, 0, 0.15);
  border: 2px solid var(--accent);
  box-shadow: 0 0 10px var(--accent), inset 0 0 8px var(--accent);
  backface-visibility: visible;
  transition: all 0.3s;
  animation: cycle-colors-logo 10s linear infinite;
}

.logo-text { 
  font-size: 12px;
  font-weight: 900; 
  color: rgba(255, 255, 255, 0.7); 
  text-transform: uppercase;
}

.logo-cube .f-face:nth-child(1) { transform: rotateY(0deg) translateZ(8px); }
.logo-cube .f-face:nth-child(2) { transform: rotateY(90deg) translateZ(8px); }
.logo-cube .f-face:nth-child(3) { transform: rotateY(180deg) translateZ(8px); }
.logo-cube .f-face:nth-child(4) { transform: rotateY(-90deg) translateZ(8px); }
.logo-cube .f-face:nth-child(5) { transform: rotateX(90deg) translateZ(8px); }
.logo-cube .f-face:nth-child(6) { transform: rotateX(-90deg) translateZ(8px); }

@keyframes spin {
  to { transform: rotateX(-25deg) rotateY(315deg); }
}

@keyframes cycle-colors-logo {
  0% {
    background: rgba(255, 0, 0, 0.15);
    border-color: #FF0000;
    box-shadow: 0 0 10px #FF0000, inset 0 0 8px #FF0000;
  }
  20% {
    background: rgba(59, 130, 246, 0.15);
    border-color: #3b82f6;
    box-shadow: 0 0 10px #3b82f6, inset 0 0 8px #3b82f6;
  }
  40% {
    background: rgba(34, 197, 94, 0.15);
    border-color: #22c55e;
    box-shadow: 0 0 10px #22c55e, inset 0 0 8px #22c55e;
  }
  60% {
    background: rgba(249, 115, 22, 0.15);
    border-color: #f97316;
    box-shadow: 0 0 10px #f97316, inset 0 0 8px #f97316;
  }
  80% {
    background: rgba(239, 68, 68, 0.15);
    border-color: #ef4444;
    box-shadow: 0 0 10px #ef4444, inset 0 0 8px #ef4444;
  }
  100% {
    background: rgba(255, 0, 0, 0.15);
    border-color: #FF0000;
    box-shadow: 0 0 10px #FF0000, inset 0 0 8px #FF0000;
  }
}

[data-theme="rose"] .logo-cube .f-face {
  animation: cycle-colors-logo-rose 10s linear infinite;
}

@keyframes cycle-colors-logo-rose {
  0% {
    background: rgba(255, 141, 161, 0.15);
    border-color: var(--rose-primary);
    box-shadow: 0 0 10px var(--rose-primary), inset 0 0 8px var(--rose-primary);
  }
  33% {
    background: rgba(255, 107, 139, 0.15);
    border-color: var(--rose-secondary);
    box-shadow: 0 0 10px var(--rose-secondary), inset 0 0 8px var(--rose-secondary);
  }
  66% {
    background: rgba(0, 212, 255, 0.15);
    border-color: var(--retro-blue);
    box-shadow: 0 0 10px var(--retro-blue), inset 0 0 8px var(--retro-blue);
  }
  100% {
    background: rgba(255, 141, 161, 0.15);
    border-color: var(--rose-primary);
    box-shadow: 0 0 10px var(--rose-primary), inset 0 0 8px var(--rose-primary);
  }
}

.logo:hover .logo-cube .fab-cube {
  animation-play-state: paused;
}

.logo:hover .logo-text {
  transform: scale(1.05);
  filter: drop-shadow(0 0 8px var(--accent));
}

@media (max-width: 768px) {
  .logo-cube {
    width: 28px;
    height: 28px;
  }
  
  .logo-cube .f-face {
    width: 14px;
    height: 14px;
    left: 7px;
    top: 7px;
  }
  
  .logo-cube .f-face:nth-child(1) { transform: rotateY(0deg) translateZ(7px); }
  .logo-cube .f-face:nth-child(2) { transform: rotateY(90deg) translateZ(7px); }
  .logo-cube .f-face:nth-child(3) { transform: rotateY(180deg) translateZ(7px); }
  .logo-cube .f-face:nth-child(4) { transform: rotateY(-90deg) translateZ(7px); }
  .logo-cube .f-face:nth-child(5) { transform: rotateX(90deg) translateZ(7px); }
  .logo-cube .f-face:nth-child(6) { transform: rotateX(-90deg) translateZ(7px); }
}

.header-buttons { 
  display: flex; 
  align-items: center; 
  gap: 8px; 
  margin-left: auto; 
}

.theme-btn {
    background: transparent; 
    border: none; 
    color: var(--ink-dim);
    cursor: pointer; 
    padding: 8px; 
    border-radius: 50%; 
    display: flex; 
    align-items: center;
    transition: all 0.3s ease;
}

.theme-btn:hover { 
  color: var(--ink); 
  background: var(--glass-border); 
  transform: scale(1.1); 
}

.theme-btn:active { 
  background: var(--glass-border); 
  color: var(--ink); 
  transform: scale(0.95); 
}

.category-bar {
  display: flex; 
  gap: 8px; 
  overflow-x: auto; 
  padding: 10px 20px;
  pointer-events: auto; 
  scrollbar-width: none;
  justify-content: flex-start;
  height: 60px;
  align-items: center;
}

.category-bar::-webkit-scrollbar { 
  display: none; 
}

.pill {
  padding: 4px 12px; 
  border-radius: 20px; 
  font-size: 11px; 
  font-weight: 600;
  background: var(--glass-bg); 
  border: 1px solid var(--glass-border);
  color: var(--ink-dim); 
  white-space: nowrap; 
  cursor: pointer; 
  transition: all 0.2s;
  flex-shrink: 0;
}

.pill.active { 
  background: var(--ink); 
  color: var(--bg-color); 
  border-color: var(--ink); 
}

.pill.add-btn { 
  border-style: dashed; 
}

[data-theme="rose"] .pill.active {
  background: linear-gradient(135deg, var(--rose-primary), var(--rose-secondary));
  color: white;
  border-color: var(--rose-primary);
  box-shadow: 0 0 12px rgba(255, 141, 161, 0.5);
}

.kanban-container {
  position: absolute;
  inset: 0;
  top: var(--header-height);
  bottom: var(--nav-height);
  display: flex;
  overflow: hidden;
  z-index: 1;
}

.kanban-column {
  display: flex;
  flex-direction: column;
  min-width: 300px;
  background: rgba(255, 255, 255, 0.01);
  border-right: 1px solid var(--glass-border);
  transition: all 0.3s ease;
  position: relative;
}

.kanban-column:first-child {
  min-width: 400px;
  flex: 1;
}

.kanban-column:last-child {
  border-right: none;
}

.column-header {
  padding: 16px;
  background: var(--glass-bg);
  border-bottom: 1px solid var(--glass-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

.column-title {
  font-weight: 600;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--ink-dim);
}

.column-content {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}

.column-resize {
  position: absolute;
  right: -3px;
  top: 0;
  bottom: 0;
  width: 6px;
  cursor: col-resize;
  background: transparent;
  transition: background 0.2s;
}

.column-resize:hover {
  background: var(--accent);
}

.view-container {
  position: absolute; 
  top: var(--header-height);
  bottom: var(--nav-height);
  width: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  opacity: 0; 
  pointer-events: none;
  transition: opacity 0.3s ease;
  -webkit-overflow-scrolling: touch;
}

.view-container.active { 
  opacity: 1; 
  pointer-events: auto; 
  z-index: 1000;
}

#gridContainer { 
  overflow-y: auto; 
  padding: 16px 16px 120px 16px; 
}

.grid-wrapper {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  padding-bottom: 40px;
}

@media(min-width: 600px) { 
  .grid-wrapper { 
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
  } 
}

.video-card {
  background: var(--card-bg);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
  transition: transform 0.2s, background 0.2s, box-shadow 0.3s ease;
  cursor: pointer;
  z-index: 100;
}

.video-card:hover {
  transform: scale(1.02);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  z-index: 1000;
}

[data-theme="rose"] .video-card:hover {
  box-shadow: 0 8px 24px rgba(255, 141, 161, 0.3);
}

.video-card:active { 
  transform: scale(0.98); 
  background: var(--glass-border); 
}

.video-thumbnail {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%;
  background: linear-gradient(45deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  overflow: hidden;
}

.video-thumbnail img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.video-card:hover .video-thumbnail img {
  transform: scale(1.05);
}

.video-duration {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  font-family: var(--font-mono);
  font-weight: 600;
}

.video-status {
  position: absolute;
  top: 8px;
  left: 8px;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}

.status-unwatched {
  background: var(--neon-blue);
  color: white;
}

.status-in-progress {
  background: var(--neon-orange);
  color: white;
}

.status-completed {
  background: var(--neon-green);
  color: white;
}

.status-saved {
  background: var(--accent);
  color: white;
}

.status-archived {
  background: var(--ink-dim);
  color: white;
}

.video-info {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.video-title {
  font-weight: 600;
  font-size: 14px;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.video-channel {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--ink-dim);
}

.channel-avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--glass-border);
}

.video-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: var(--ink-dim);
  border-top: 1px solid var(--glass-border);
  padding-top: 8px;
}

.video-views {
  font-family: var(--font-mono);
}

.video-actions {
  display: flex;
  gap: 8px;
}

.action-icon {
  width: 28px; 
  height: 28px; 
  display: flex; 
  align-items: center; 
  justify-content: center;
  border-radius: 6px; 
  background: rgba(255,255,255,0.05); 
  cursor: pointer;
  color: var(--ink-dim); 
  transition: 0.2s;
  font-size: 12px; 
  font-weight: 700;
}

.action-icon:hover { 
  background: var(--accent); 
  color: #fff; 
}

[data-theme="rose"] .action-icon:hover {
  background: linear-gradient(135deg, var(--rose-primary), var(--rose-secondary));
  color: white;
}

.scatter-canvas {
  position: absolute; 
  inset: 0; 
  overflow: hidden;
  transform-origin: 0 0; 
  transition: transform 0.3s ease;
}

.scatter-card {
  position: absolute;
  background: var(--card-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 12px;
  cursor: move;
  user-select: none;
  transition: transform 0.2s, box-shadow 0.3s, left 0.3s ease, top 0.3s ease;
  z-index: 100;
  width: 200px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.scatter-card:hover {
  transform: scale(1.02);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  z-index: 1000;
}

.scatter-card.is-dragging {
  transform: scale(1.05);
  box-shadow: 0 12px 32px rgba(0,0,0,0.4);
  z-index: 2000;
  opacity: 0.9;
}

.scatter-thumbnail {
  width: 100%;
  height: 80px;
  border-radius: 8px;
  background: #1a1a1a;
  margin-bottom: 8px;
}

.scatter-controls {
  position: fixed;
  top: 50%;
  right: 20px;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 1000;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 12px;
  backdrop-filter: blur(10px);
}

.scatter-controls button {
  background: transparent;
  border: none;
  color: var(--ink-dim);
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  font-size: 16px;
  width: 36px;
  height: 36px;
}

.scatter-controls button:hover {
  color: var(--ink);
  background: var(--glass-border);
  transform: scale(1.1);
}

.scatter-controls .divider {
  height: 1px;
  background: var(--glass-border);
  margin: 8px 0;
  width: 100%;
}

.list-table {
  width: 100%; 
  border-collapse: collapse; 
  font-size: 14px;
}

.list-table th {
  text-align: left; 
  padding: 12px; 
  background: var(--glass-bg);
  font-weight: 600; 
  text-transform: uppercase; 
  font-size: 12px;
  border-bottom: 2px solid var(--glass-border);
}

.list-table td { 
  padding: 12px; 
  border-bottom: 1px solid var(--glass-border); 
}

.list-table tr:hover { 
  background: var(--glass-bg); 
}

.list-thumbnail { 
  width: 80px; 
  height: 45px; 
  border-radius: 4px; 
  object-fit: cover; 
}

.bottom-nav {
  position: fixed; 
  bottom: 0; 
  left: 0; 
  right: 0; 
  height: var(--nav-height);
  background: linear-gradient(to top, var(--bg-color) 40%, transparent);
  display: flex; 
  justify-content: center; 
  align-items: center; 
  gap: 16px;
  padding: 0 20px; 
  z-index: 9999; 
  pointer-events: none;
}

.bottom-nav-inner {
  display: flex; 
  gap: 12px; 
  align-items: center; 
  pointer-events: auto;
  background: var(--glass-bg); 
  border: 1px solid var(--glass-border);
  border-radius: 24px; 
  padding: 8px 20px; 
  backdrop-filter: blur(16px);
}

.nav-btn {
  background: transparent; 
  border: none; 
  color: var(--ink-dim);
  cursor: pointer; 
  padding: 10px; 
  border-radius: 50%;
  display: flex; 
  align-items: center; 
  justify-content: center;
  transition: all 0.2s; 
  font-size: 18px; 
  width: 44px; 
  height: 44px;
}

.nav-btn.active { 
  color: var(--accent); 
  background: rgba(255, 0, 0, 0.1); 
}

.nav-btn:hover { 
  color: var(--ink); 
  transform: scale(1.1); 
}

.nav-btn:active { 
  transform: scale(0.95); 
}

.detail-panel {
  position: fixed; 
  top: var(--header-height); 
  right: -100%;
  width: 600px; 
  height: calc(100vh - var(--header-height));
  background: var(--card-bg); 
  border: 1px solid var(--glass-border);
  transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
  z-index: 8888; 
  display: none;
  flex-direction: column;
  border-radius: 0;
}

.detail-panel.side-panel {
  right: -600px;
  width: 600px;
  border-left: 1px solid var(--glass-border);
  border-right: none;
  border-top: none;
  border-bottom: none;
}

.detail-panel.side-panel.active { 
  right: 0; 
  display: flex;
}

.detail-panel.full-viewport {
  right: -100%;
  width: 100%;
  top: var(--header-height);
  height: calc(85vh - var(--header-height));
  left: 0;
  margin: 0 auto;
  max-width: 1200px;
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}

.detail-panel.full-viewport.active { 
  right: 0; 
  transform: translateX(-50%);
  left: 50%;
  display: flex;
}

.detail-close {
  position: absolute; 
  top: 16px; 
  right: 16px; 
  z-index: 9999;
  background: var(--glass-bg); 
  border: 1px solid var(--glass-border);
  border-radius: 50%; 
  width: 32px; 
  height: 32px; 
  display: flex;
  align-items: center; 
  justify-content: center; 
  cursor: pointer;
  color: var(--ink-dim); 
  transition: all 0.2s;
}

.detail-close:hover { 
  color: var(--ink); 
  background: var(--glass-border); 
}

.video-mode-toggle {
  position: absolute; 
  top: 16px; 
  left: 16px; 
  z-index: 9999;
  background: var(--glass-bg); 
  border: 1px solid var(--glass-border);
  border-radius: 20px; 
  padding: 6px 12px; 
  display: flex;
  align-items: center; 
  gap: 8px; 
  cursor: pointer;
  color: var(--ink-dim); 
  font-size: 12px; 
  font-weight: 600;
  transition: all 0.2s;
}

.video-mode-toggle:hover { 
  color: var(--ink); 
  background: var(--glass-border); 
  transform: scale(1.05);
}

.detail-content {
  flex: 1; 
  overflow-y: auto; 
  padding: 20px;
  padding-top: 60px;
}

.detail-panel.full-viewport .video-player {
  width: 100%; 
  aspect-ratio: 16/9; 
  background: #000; 
  border-radius: 12px;
  margin-bottom: 20px; 
  display: flex; 
  align-items: center; 
  justify-content: center;
  color: var(--ink-dim); 
  font-size: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.video-player {
  width: 100%; 
  aspect-ratio: 16/9; 
  background: #000; 
  border-radius: 12px;
  margin-bottom: 16px; 
  display: flex; 
  align-items: center; 
  justify-content: center;
  color: var(--ink-dim); 
  font-size: 18px;
}

.search-overlay {
  position: fixed; 
  top: 0;
  right: -100%;
  width: 575px;
  height: 100vh;
  padding: 0 2em 0 2.5em;
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  z-index: 9999;
  transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex; 
  flex-direction: column;
  border-left: 1px solid var(--glass-border);
  box-shadow: -10px 0 30px rgba(0,0,0,0.3);
}

.search-overlay.active { 
  right: 0;
}

.search-container {
  width: 100%;
  height: 100%;
  overflow-y: auto;
  padding: 0;
  display: flex;
  flex-direction: column;
}

.search-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  background: var(--glass-bg);
  border-bottom: 1px solid var(--glass-border);
  position: sticky;
  top: 0;
  z-index: 10;
}

.search-title {
  font-weight: 700;
  font-size: 24px;
  margin: 0;
}

.close-search {
  background: transparent;
  border: none;
  font-size: 28px;
  color: var(--ink-dim);
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.close-search:hover {
  background: var(--glass-border);
  color: var(--ink);
  transform: scale(1.1);
}

.search-input-container {
  padding: 20px;
  background: var(--glass-bg);
  border-bottom: 1px solid var(--glass-border);
  position: relative;
}

.search-input {
  width: 100%;
  padding: 12px 50px 12px 16px;
  font-size: 16px;
  background: var(--card-bg);
  border: 2px solid var(--glass-border);
  border-radius: 12px;
  color: var(--ink);
  font-weight: 500;
  transition: all 0.2s;
}

.search-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
}

.voice-search-btn {
  position: absolute;
  right: 36px;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  color: var(--ink-dim);
  padding: 8px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.2s;
}

.voice-search-btn:hover {
  color: var(--accent);
  transform: translateY(-50%) scale(1.1);
}

.search-results {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.bento-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.bento-item {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.bento-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent), var(--neon-blue), var(--neon-green));
  transform: scaleX(0);
  transition: transform 0.3s;
}

.bento-item:hover::before {
  transform: scaleX(1);
}

.bento-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(0,0,0,0.2);
  border-color: var(--accent);
}

.bento-item.large {
  grid-column: span 2;
}

.bento-item.medium {
  grid-column: span 1;
}

.bento-item.small {
  grid-column: span 1;
}

.discovery-section {
  margin-bottom: 32px;
}

.section-title {
  font-weight: 700;
  font-size: 18px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.discovery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
}

.discovery-item {
  padding: 16px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
}

.discovery-item:hover {
  background: var(--glass-border);
  transform: translateX(4px);
}

.trending-badge {
  background: var(--accent);
  color: #000;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  animation: trending-pulse 2s infinite;
}

@keyframes trending-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.ai-placeholder {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  border-radius: 16px;
  padding: 32px;
  text-align: center;
  margin: 32px 0;
  position: relative;
  overflow: hidden;
}

.ai-placeholder::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: ai-shimmer 3s infinite;
}

@keyframes ai-shimmer {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.filters-section {
  margin: 32px 0;
  padding: 24px;
  background: var(--glass-bg);
  border-radius: 16px;
  border: 1px solid var(--glass-border);
}

.filter-group {
  margin-bottom: 20px;
}

.filter-group:last-child {
  margin-bottom: 0;
}

.filter-group-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--ink-dim);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.filter-pills {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.filter-pill {
  padding: 8px 16px;
  border-radius: 20px;
  background: var(--card-bg);
  border: 1px solid var(--glass-border);
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s;
}

.filter-pill:hover {
  border-color: var(--accent);
  transform: translateY(-2px);
}

.filter-pill.active {
  background: var(--accent);
  color: #000;
  border-color: var(--accent);
}

.filter-toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--glass-border);
}

.filter-toggle:last-child {
  border-bottom: none;
}

.toggle-switch {
  width: 48px;
  height: 24px;
  background: var(--glass-border);
  border-radius: 24px;
  position: relative;
  cursor: pointer;
  transition: background 0.3s;
}

.toggle-slider {
  width: 20px;
  height: 20px;
  background: var(--ink);
  border-radius: 50%;
  position: absolute;
  top: 2px;
  left: 2px;
  transition: all 0.3s;
}

.toggle-switch.active {
  background: var(--accent);
}

.toggle-switch.active .toggle-slider {
  left: 26px;
  background: #000;
}

.context-menu {
  position: fixed; 
  display: none; 
  background: var(--card-bg);
  border: 1px solid var(--glass-border); 
  border-radius: 12px;
  padding: 8px 0; 
  min-width: 180px; 
  z-index: 9999;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

.context-menu.active { 
  display: block; 
}

.ctx-header {
  padding: 8px 16px; 
  font-weight: 600; 
  font-size: 12px;
  text-transform: uppercase; 
  color: var(--ink-dim); 
  border-bottom: 1px solid var(--glass-border);
  margin-bottom: 4px;
}

.ctx-item {
  padding: 10px 16px; 
  cursor: pointer; 
  transition: background 0.2s; 
  font-size: 14px;
}

.ctx-item:hover { 
  background: var(--glass-bg); 
}

.skeleton {
  background: linear-gradient(90deg, var(--glass-bg) 25%, var(--glass-border) 50%, var(--glass-bg) 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s infinite;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.hidden { 
  display: none !important; 
}

.fade-in { 
  animation: fadeIn 0.3s ease; 
}

@keyframes fadeIn { 
  from { opacity: 0; } 
  to { opacity: 1; } 
}

.slide-up { 
  animation: slideUp 0.3s ease; 
}

@keyframes slideUp { 
  from { transform: translateY(20px); opacity: 0; } 
  to { transform: translateY(0); opacity: 1; } 
}

.header-left { 
  display: flex; 
  align-items: center; 
}

.logo-mobile { 
  display: none; 
  font-size: 24px; 
  font-weight: 800; 
}

.header-center { 
  flex: 1; 
  max-width: 600px; 
  margin: 0 20px; 
}

.header-search { 
  display: flex; 
}

.header-search input { 
  flex: 1; 
  background: var(--glass-bg); 
  border: 1px solid var(--glass-border); 
  border-radius: 20px 0 0 20px; 
  padding: 8px 16px; 
  color: var(--ink); 
}

.header-search button { 
  background: var(--glass-bg); 
  border: 1px solid var(--glass-border); 
  border-left: none; 
  border-radius: 0 20px 20px 0; 
  padding: 8px 16px; 
  color: var(--ink-dim); 
  cursor: pointer; 
}

.header-right { 
  display: flex; 
  align-items: center; 
  gap: 8px; 
}

.notifications-btn { 
  position: relative; 
  background: transparent; 
  border: none; 
  color: var(--ink-dim); 
  font-size: 20px; 
  cursor: pointer; 
}

.notification-badge { 
  position: absolute; 
  top: -2px; 
  right: -2px; 
  background: var(--accent); 
  width: 8px; 
  height: 8px; 
  border-radius: 50%; 
}

.profile-dropdown { 
  position: relative; 
}

.profile-btn { 
  background: transparent; 
  border: 1px solid var(--glass-border); 
  border-radius: 50%; 
  width: 32px; 
  height: 32px; 
  color: var(--ink); 
  cursor: pointer; 
}

.profile-menu { 
  display: none; 
  position: absolute; 
  top: 40px; 
  right: 0; 
  background: var(--card-bg); 
  border: 1px solid var(--glass-border); 
  border-radius: 12px; 
  padding: 8px 0; 
  min-width: 160px; 
  box-shadow: 0 8px 24px rgba(0,0,0,0.3); 
}

.profile-menu.active { 
  display: block; 
}

.profile-menu-item { 
  padding: 8px 16px; 
  cursor: pointer; 
  transition: background 0.2s; 
  display: flex; 
  gap: 8px; 
}

.profile-menu-item:hover { 
  background: var(--glass-bg); 
}

.profile-menu-divider { 
  border-top: 1px solid var(--glass-border); 
  margin: 4px 0; 
}

.create-new-btn { 
  background: var(--accent); 
  color: #fff; 
  border: none; 
  border-radius: 20px; 
  padding: 4px 12px; 
  display: flex; 
  gap: 4px; 
  align-items: center; 
  cursor: pointer; 
}

.modal-overlay { 
  position: fixed; 
  inset: 0; 
  background: rgba(0,0,0,0.8); 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  opacity: 0; 
  pointer-events: none; 
  transition: opacity 0.3s; 
  z-index: 9999; 
}

.modal-overlay.active { 
  opacity: 1; 
  pointer-events: auto; 
}

.modal { 
  background: var(--card-bg); 
  border: 1px solid var(--glass-border); 
  border-radius: 16px; 
  padding: 20px; 
  width: 90%; 
  max-width: 400px; 
}

.modal-header { 
  font-weight: 600; 
  margin-bottom: 16px; 
}

.modal-content { 
  display: flex; 
  flex-direction: column; 
  gap: 8px; 
}

.modal-option { 
  display: flex; 
  gap: 12px; 
  padding: 12px; 
  border-radius: 12px; 
  background: var(--glass-bg); 
  cursor: pointer; 
  transition: background 0.2s; 
}

.modal-option:hover { 
  background: var(--glass-border); 
}

.modal-option-icon { 
  font-size: 24px; 
}

.modal-option-text { 
  display: flex; 
  flex-direction: column; 
}

.modal-option-title { 
  font-weight: 600; 
}

.modal-option-desc { 
  font-size: 13px; 
  color: var(--ink-dim); 
}

.modal-close { 
  width: 100%; 
  margin-top: 16px; 
  background: transparent; 
  border: 1px solid var(--glass-border); 
  border-radius: 12px; 
  padding: 12px; 
  color: var(--ink); 
  cursor: pointer; 
}

.sort-bar { display: flex; gap: 8px; padding: 10px; flex-wrap: wrap; }

@media (max-width: 768px) {
  :root {
    --nav-height: 70px;
    --header-height: 130px;
  }
  
  .app-header {
    height: var(--header-height);
    background: linear-gradient(to bottom, var(--bg-color) 70%, transparent);
    padding-top: env(safe-area-inset-top);
  }
  
  .header-top {
    height: 70px;
    padding: 0 16px;
  }
  
  .category-bar {
    height: 60px;
    padding: 12px 16px;
    align-items: center;
    background: linear-gradient(to bottom, var(--bg-color) 20%, transparent);
    padding-left: calc(16px + env(safe-area-inset-left));
    padding-right: calc(16px + env(safe-area-inset-right));
  }
  
  .pill {
    min-height: 36px;
    min-width: 70px;
    padding: 8px 16px;
    font-size: 12px;
    margin: 2px;
  }
  
  .view-container {
    top: var(--header-height) !important;
    height: calc(100vh - var(--header-height) - var(--nav-height));
  }
  
  #gridContainer {
    padding-top: 8px;
  }
  
  .kanban-container {
    top: var(--header-height) !important;
    height: calc(100vh - var(--header-height) - var(--nav-height));
  }
  
  #scatterContainer {
    top: var(--header-height) !important;
  }
  
  .detail-panel {
    top: var(--header-height) !important;
    height: calc(100vh - var(--header-height));
  }
  
  .kanban-column {
    min-width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    transform: translateX(100%);
    transition: transform 0.3s ease;
  }
  
  .kanban-column.active {
    transform: translateX(0);
  }
  
  button, .pill, .nav-btn, .action-icon {
    min-height: 44px;
    min-width: 44px;
  }
  
  .search-overlay {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .bottom-nav {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .scatter-card {
    width: 160px;
    padding: 10px;
  }
  
  .scatter-thumbnail {
    height: 70px;
  }
  
  .scatter-controls {
    right: 10px;
    top: auto;
    bottom: 100px;
    transform: none;
    flex-direction: row;
    flex-wrap: wrap;
    width: auto;
    gap: 6px;
    padding: 10px;
  }
  
  .scatter-controls .divider {
    display: none;
  }
  
  .scatter-controls button {
    width: 40px;
    height: 40px;
    font-size: 18px;
  }
  
  .search-overlay {
    width: 100%;
    right: -100%;
    border-left: none;
    border-radius: 0;
  }
  
  .search-header {
    padding: 16px 20px;
  }
  
  .search-title {
    font-size: 20px;
  }
  
  .search-input-container {
    padding: 20px;
  }
  
  .search-input {
    font-size: 18px;
    padding: 16px 50px 16px 20px;
    min-height: 44px;
  }
  
  .voice-search-btn {
    right: 32px;
    font-size: 18px;
  }
  
  .search-results {
    padding: 20px;
  }
  
  .bento-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .bento-item.large,
  .bento-item.medium,
  .bento-item.small {
    grid-column: span 1;
  }
  
  .discovery-grid {
    grid-template-columns: 1fr;
    gap: 8px;
  }
  
  .discovery-item {
    padding: 12px;
    font-size: 13px;
    min-height: 44px;
  }
  
  .filters-section {
    padding: 20px;
    margin: 20px 0;
  }
  
  .filter-pills {
    gap: 6px;
  }
  
  .filter-pill {
    padding: 6px 12px;
    font-size: 12px;
  }
  
  .close-search {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    background: var(--glass-bg);
    border-radius: 50%;
  }
}

@media (max-width: 480px) {
  :root {
    --header-height: 140px;
  }
  
  .header-top {
    height: 65px;
  }
  
  .category-bar {
    height: 75px;
    flex-wrap: wrap;
    justify-content: flex-start;
    overflow-y: auto;
  }
  
  .pill {
    min-height: 32px;
    min-width: 80px;
    font-size: 10px;
    margin: 2px;
  }
  
  .search-header {
    padding: 12px 16px;
  }
  
  .search-title {
    font-size: 18px;
  }
  
  .search-input-container {
    padding: 16px;
  }
  
  .search-input {
    font-size: 16px;
    padding: 14px 45px 14px 16px;
  }
  
  .voice-search-btn {
    right: 28px;
    font-size: 16px;
  }
  
  .search-results {
    padding: 16px;
  }
  
  .section-title {
    font-size: 16px;
  }
  
  .discovery-item {
    padding: 10px;
    font-size: 12px;
  }
  
  .scatter-card {
    width: 140px;
    padding: 8px;
  }
  
  .scatter-thumbnail {
    height: 60px;
  }
}

@supports (-webkit-touch-callout: none) {
  .view-container {
    height: -webkit-fill-available;
  }
  
  .kanban-container {
    height: -webkit-fill-available;
  }
}

.joystick-container {
  position: fixed;
  bottom: 120px;
  right: 20px;
  z-index: 999;
  display: none;
}

.joystick-container.active {
  display: block;
}

.youtube-joystick-fab {
  width: 60px;
  height: 60px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
  backdrop-filter: blur(10px);
  transition: all 0.2s;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.youtube-joystick-fab.pressed {
  transform: scale(0.95);
  background: var(--glass-border);
  box-shadow: 0 2px 10px rgba(0,0,0,0.4);
}

.youtube-joystick-handle {
  font-size: 24px;
  transition: transform 0.1s;
}

.youtube-direction-indicators {
  position: absolute;
  inset: -20px;
}

.youtube-direction-indicator {
  position: absolute;
  width: 12px;
  height: 12px;
  background: var(--accent);
  border-radius: 50%;
  opacity: 0;
  transition: opacity 0.2s, transform 0.2s;
  box-shadow: 0 0 10px var(--accent);
}

.youtube-direction-indicator.active {
  opacity: 1;
  transform: scale(1.2);
}

.youtube-indicator-up { top: 0; left: 50%; transform: translateX(-50%) scale(0.8); }
.youtube-indicator-right { top: 50%; right: 0; transform: translateY(-50%) scale(0.8); }
.youtube-indicator-down { bottom: 0; left: 50%; transform: translateX(-50%) scale(0.8); }
.youtube-indicator-left { top: 50%; left: 0; transform: translateY(-50%) scale(0.8); }

@media (max-width: 768px) {
  .joystick-container {
    bottom: 100px;
    right: 16px;
  }
  
  .youtube-joystick-fab {
    width: 56px;
    height: 56px;
  }
  
  .youtube-joystick-fab.mobile-active {
    background: rgba(255, 0, 0, 0.1);
    border: 2px solid var(--accent);
  }
}

@media (min-width: 769px) {
  .joystick-container {
    display: none !important;
  }
  
  .joystick-container.active {
    display: block !important;
  }
}
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-top">
      <div class="header-left">
        <div class="logo">
          <div class="logo-wrapper">
            <div class="logo-cube">
              <div class="fab-cube">
                <div class="f-face"></div>
                <div class="f-face"></div>
                <div class="f-face"></div>
                <div class="f-face"></div>
                <div class="f-face"></div>
                <div class="f-face"></div>
              </div>
            </div>
            <div class="logo-text"> ViewCube</div>
          </div>
        </div>
      </div>
    
      <div class="header-center">
        <div class="header-search">
          <input type="text" placeholder="Search videos..." id="headerSearch" 
                 onkeyup="if(event.key === 'Enter') performSearch()">
          <button onclick="performSearch()">üîç</button>
        </div>
      </div>
    
      <div class="header-right">
        <button class="notifications-btn" onclick="toggleNotifications()">
          <span>üîî</span>
          <div class="notification-badge"></div>
        </button>
      
        <div class="profile-dropdown">
          <button class="profile-btn" onclick="toggleProfileMenu()">U</button>
          <div class="profile-menu" id="profileMenu">
            <div class="profile-menu-item" onclick="navigateTo('settings')">‚öôÔ∏è Settings</div>
            <div class="profile-menu-item" onclick="navigateTo('history')">üìö History</div>
            <div class="profile-menu-item" onclick="navigateTo('playlists')">üìã Playlists</div>
            <div class="profile-menu-divider"></div>
            <div class="profile-menu-item" onclick="navigateTo('help')">‚ùì Help</div>
            <div class="profile-menu-item" onclick="navigateTo('signout')">üö™ Sign Out</div>
          </div>
        </div>
      
        <button class="create-new-btn" onclick="openCreateModal()">
          <span>+</span>
          <span>Create New</span>
        </button>
      
        <div class="header-buttons">
            <button class="theme-btn" onclick="cycleTheme()" title="Cycle Theme">
                <span id="themeIcon">üåô</span>
            </button>
            <button class="theme-btn" onclick="toggleView()" title="Toggle View">
                <span>‚äû</span>
            </button>
        </div>
      </div>
    </div>
  
    <div class="category-bar" id="categoryBar">
      <div class="pill active" data-category="all">All</div>
      <div class="pill" data-category="music">Music</div>
      <div class="pill" data-category="gaming">Gaming</div>
      <div class="pill" data-category="education">Education</div>
      <div class="pill" data-category="tech">Technology</div>
      <div class="pill" data-category="entertainment">Entertainment</div>
      <div class="pill add-btn" onclick="addCustomCategory()">+ Add</div>
    </div>
  </header>

  <div id="gridContainer" class="view-container active">
    <div class="grid-wrapper" id="gridWrapper">
    </div>
  </div>

  <div id="kanbanContainer" class="view-container kanban-container">
    <div class="kanban-column" id="feedColumn">
      <div class="column-header">
        <div class="column-title">Feed</div>
      </div>
      <div class="column-content">
      </div>
    </div>
    <div class="kanban-column" id="curatedColumn">
      <div class="column-header">
        <div class="column-title">Curated Queue</div>
      </div>
      <div class="column-content">
      </div>
    </div>
    <div class="kanban-column" id="relatedColumn">
      <div class="column-header">
        <div class="column-title">Related</div>
      </div>
      <div class="column-content">
      </div>
    </div>
    <div class="kanban-column" id="discoverColumn">
      <div class="column-header">
        <div class="column-title">Discover</div>
      </div>
      <div class="column-content">
      </div>
    </div>
  </div>
  
  <div id="scatterContainer" class="view-container">
    <div class="scatter-canvas" id="scatterCanvas">
    </div>
    <div class="scatter-controls" id="scatterControls">
      <button class="theme-btn" onclick="arrangeAsGrid()" title="Arrange as Grid">
        ‚èπ
      </button>
      <button class="theme-btn" onclick="arrangeAsCascade()" title="Arrange as Cascade">
        üé¥
      </button>
      <div style="height: 1px; background: var(--glass-border); margin: 8px 0;"></div>
      <button class="theme-btn" onclick="zoom(0.2)" title="Zoom In">
        +
      </button>
      <button class="theme-btn" onclick="resetView()" title="Reset View">
        ‚Üª
      </button>
      <button class="theme-btn" onclick="zoom(-0.2)" title="Zoom Out">
        -
      </button>
    </div>
  </div>
  
  <div id="historyContainer" class="view-container">
    <div class="sort-bar">
      <div class="pill active" data-sort="lastWatched">Last Watched</div>
      <div class="pill" data-sort="uploadDate">Upload Date</div>
      <div class="pill" data-sort="views">Views</div>
    </div>
    <table class="list-table">
      <thead>
        <tr>
          <th>Thumbnail</th>
          <th>Title</th>
          <th>Channel</th>
          <th>Duration</th>
          <th>Views</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="historyBody">
      </tbody>
    </table>
  </div>
  
  <div id="listContainer" class="view-container">
    <div class="sort-bar">
      <div class="pill active" data-sort="title">Title</div>
      <div class="pill" data-sort="channel">Channel</div>
      <div class="pill" data-sort="duration">Duration</div>
      <div class="pill" data-sort="views">Views</div>
      <div class="pill" data-sort="uploadDate">Upload Date</div>
    </div>
    <table class="list-table">
      <thead>
        <tr>
          <th>Thumbnail</th>
          <th>Title</th>
          <th>Channel</th>
          <th>Duration</th>
          <th>Views</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="listBody">
      </tbody>
    </table>
  </div>
  
  <div class="search-overlay" id="searchOverlay">
    <div class="search-container">
      <div class="search-header">
        <h2 class="search-title">Search</h2>
        <button class="close-search" onclick="closeSearchOverlay()">√ó</button>
      </div>
    
      <div class="search-input-container">
        <input type="text" class="search-input" id="mainSearchInput" 
               placeholder="Search for videos, channels, or topics..." 
               onkeyup="updateSearchSuggestions(this.value)">
        <button class="voice-search-btn" onclick="startVoiceSearch()">üé§</button>
      </div>
    
      <div id="searchResults" style="display: none;">
        <h3 class="section-title">Search Results</h3>
        <div class="bento-grid" id="searchResultsGrid">
        </div>
        
        <div class="ai-placeholder" id="aiSmartSearch">
          <h3>ü§ñ AI Smart Search</h3>
          <p>Coming Soon: Intelligent video discovery powered by AI</p>
          <small>This feature will understand context and provide personalized recommendations</small>
        </div>
        
        <h3 class="section-title">Recommended For You</h3>
        <div class="bento-grid" id="recommendedGrid">
        </div>
      </div>
      
      <div id="discoverySections">
        <div class="discovery-section">
          <h3 class="section-title">Your Search History</h3>
          <div class="discovery-grid">
            <div class="discovery-item" onclick="searchFor('Tech reviews 2024')">
              üì± Tech reviews 2024
            </div>
            <div class="discovery-item" onclick="searchFor('Gaming livestreams')">
              üéÆ Gaming livestreams
            </div>
            <div class="discovery-item" onclick="searchFor('Cooking tutorials')">
              üç≥ Cooking tutorials
            </div>
            <div class="discovery-item" onclick="searchFor('Music playlists')">
              üéµ Music playlists
            </div>
          </div>
        </div>
        
        <div class="discovery-section">
          <h3 class="section-title">Suggested for You</h3>
          <div class="discovery-grid">
            <div class="discovery-item" onclick="searchFor('AI technology trends')">
              ü§ñ AI technology trends
            </div>
            <div class="discovery-item" onclick="searchFor('Workout routines')">
              üí™ Workout routines
            </div>
            <div class="discovery-item" onclick="searchFor('Book recommendations')">
              üìö Book recommendations
            </div>
            <div class="discovery-item" onclick="searchFor('Travel guides')">
              ‚úàÔ∏è Travel guides
            </div>
          </div>
        </div>
        
        <div class="discovery-section">
          <h3 class="section-title">
            Trending Today
            <span class="trending-badge">HOT</span>
          </h3>
          <div class="discovery-grid">
            <div class="discovery-item" onclick="searchFor('New movie trailers')">
              üî• New movie trailers
            </div>
            <div class="discovery-item" onclick="searchFor('Viral challenges')">
              üî• Viral challenges
            </div>
            <div class="discovery-item" onclick="searchFor('Breaking news')">
              üî• Breaking news
            </div>
            <div class="discovery-item" onclick="searchFor('Celebrity interviews')">
              üî• Celebrity interviews
            </div>
          </div>
        </div>
        
        <div class="filters-section">
          <h3 class="section-title">Search Filters</h3>
        
          <div class="filter-group">
            <h4 class="filter-group-title">Upload Date</h4>
            <div class="filter-pills">
              <div class="filter-pill" onclick="toggleFilter(this)">Any time</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Last hour</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Today</div>
              <div class="filter-pill" onclick="toggleFilter(this)">This week</div>
              <div class="filter-pill" onclick="toggleFilter(this)">This month</div>
              <div class="filter-pill" onclick="toggleFilter(this)">This year</div>
            </div>
          </div>
        
          <div class="filter-group">
            <h4 class="filter-group-title">Duration</h4>
            <div class="filter-pills">
              <div class="filter-pill" onclick="toggleFilter(this)">Any duration</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Under 4 minutes</div>
              <div class="filter-pill" onclick="toggleFilter(this)">4-20 minutes</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Over 20 minutes</div>
            </div>
          </div>
        
          <div class="filter-group">
            <h4 class="filter-group-title">Features</h4>
            <div class="filter-pills">
              <div class="filter-pill" onclick="toggleFilter(this)">Live</div>
              <div class="filter-pill" onclick="toggleFilter(this)">4K</div>
              <div class="filter-pill" onclick="toggleFilter(this)">HDR</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Subtitles/CC</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Creative Commons</div>
            </div>
          </div>
        
          <div class="filter-group">
            <h4 class="filter-group-title">Sort By</h4>
            <div class="filter-pills">
              <div class="filter-pill active" onclick="toggleFilter(this)">Relevance</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Upload date</div>
              <div class="filter-pill" onclick="toggleFilter(this)">View count</div>
              <div class="filter-pill" onclick="toggleFilter(this)">Rating</div>
            </div>
          </div>
        
          <div class="filter-group">
            <h4 class="filter-group-title">Content Options</h4>
            <div class="filter-toggle">
              <span>Include closed captions</span>
              <div class="toggle-switch" onclick="toggleSwitch(this)">
                <div class="toggle-slider"></div>
              </div>
            </div>
            <div class="filter-toggle">
              <span>Include playlists</span>
              <div class="toggle-switch" onclick="toggleSwitch(this)">
                <div class="toggle-slider"></div>
              </div>
            </div>
            <div class="filter-toggle">
              <span>Include movies</span>
              <div class="toggle-switch" onclick="toggleSwitch(this)">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="createModal">
    <div class="modal">
      <div class="modal-header">Create New</div>
      <div class="modal-content">
        <div class="modal-option" onclick="createItem('playlist')">
          <div class="modal-option-icon">üìã</div>
          <div class="modal-option-text">
            <div class="modal-option-title">Playlist</div>
            <div class="modal-option-desc">Create a new video playlist</div>
          </div>
        </div>
        <div class="modal-option" onclick="createItem('collection')">
          <div class="modal-option-icon">üìÅ</div>
          <div class="modal-option-text">
            <div class="modal-option-title">Collection</div>
            <div class="modal-option-desc">Organize videos into collections</div>
          </div>
        </div>
        <div class="modal-option" onclick="createItem('upload')">
          <div class="modal-option-icon">‚¨ÜÔ∏è</div>
          <div class="modal-option-text">
            <div class="modal-option-title">Upload Video</div>
            <div class="modal-option-desc">Upload a new video</div>
          </div>
        </div>
        <div class="modal-option" onclick="createItem('live')">
          <div class="modal-option-icon">üî¥</div>
          <div class="modal-option-text">
            <div class="modal-option-title">Go Live</div>
            <div class="modal-option-desc">Start a live stream</div>
          </div>
        </div>
      </div>
      <button class="modal-close" onclick="closeCreateModal()">Cancel</button>
    </div>
  </div>
  
  <div class="bottom-nav">
    <div class="bottom-nav-inner">
      <button class="nav-btn active" data-mode="feed" onclick="switchMode('feed')">üè†</button>
      <button class="nav-btn" data-mode="scatter" onclick="switchMode('scatter')">üïí</button>
      <button class="nav-btn" data-mode="history" onclick="switchMode('history')">üìú</button>
      <button class="nav-btn" data-mode="list" onclick="switchMode('list')">Êï£</button>
      <button class="nav-btn" data-mode="search" onclick="switchMode('search')">üîç</button>
    </div>
  </div>

  <div class="joystick-container" id="joystickContainer">
    <div class="youtube-joystick-fab" id="youtubeJoystickFab">
      <div class="youtube-joystick-handle" id="youtubeJoystickHandle">üéÆ</div>
      <div class="youtube-direction-indicators">
        <div class="youtube-direction-indicator youtube-indicator-up" id="youtubeIndicatorUp"></div>
        <div class="youtube-direction-indicator youtube-indicator-right" id="youtubeIndicatorRight"></div>
        <div class="youtube-direction-indicator youtube-indicator-down" id="youtubeIndicatorDown"></div>
        <div class="youtube-direction-indicator youtube-indicator-left" id="youtubeIndicatorLeft"></div>
      </div>
    </div>
  </div>
  
  <div class="context-menu" id="contextMenu"></div>
  
  <div class="detail-panel side-panel" id="detailPanel">
    <button class="detail-close" onclick="closeDetailPanel()">√ó</button>
    <button class="video-mode-toggle" onclick="toggleVideoMode()">
      <span id="videoModeIcon">‚õ∂</span>
      <span id="videoModeText">Full Screen</span>
    </button>
    <div class="detail-content" id="detailContent"></div>
  </div>

  <script>
let config = {
    currentView: 'feed',
    currentCategory: 'all',
    currentTheme: 'dark',
    searchQuery: ''
};
let videos = [];
let collections = [];
let currentVideo = null;
let scatterZoom = 1;
let isMobile = false;
let touchStartX = 0;
let touchStartY = 0;
let isDragging = false;
let draggedCard = null;
let dragOffset = { x: 0, y: 0 };
let joystickMode = 'auto';
let joystickActive = false;
let joystickStartPosition = { x: 0, y: 0 };
let joystickCurrentPosition = { x: 0, y: 0 };
let videoOverlayMode = 'side-panel';
let resizeTimeout;

function detectMobile() {
    isMobile = window.innerWidth <= 768 || 
               ('ontouchstart' in window) || 
               (navigator.maxTouchPoints > 0);
    
    const joystick = document.getElementById('youtubeJoystickFab');
    if (isMobile && joystick) {
        joystick.classList.remove('active');
    }
}

function formatDuration(seconds) {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    if (hrs > 0) {
        return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function formatViews(views) {
    if (views >= 1000000) {
        return (views / 1000000).toFixed(1) + 'M';
    }
    if (views >= 1000) {
        return (views / 1000).toFixed(1) + 'K';
    }
    return views.toString();
}

function formatDate(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diffMs = now - date;
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) return 'Today';
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
    if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
    return `${Math.floor(diffDays / 365)} years ago`;
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function generateMockVideos() {
    const categories = ['Music', 'Gaming', 'Education', 'News', 'Sports', 'Comedy', 'Science', 'Tech', 'DIY', 'Food'];
    const statuses = ['unwatched', 'in-progress', 'completed', 'saved', 'archived'];
    const mockVideos = [];

    for (let i = 1; i <= 50; i++) {
        const category = categories[Math.floor(Math.random() * categories.length)];
        const status = Math.random() > 0.7 ? statuses[Math.floor(Math.random() * statuses.length)] : 'unwatched';
        const duration = Math.floor(Math.random() * 1800) + 60;
        const views = Math.floor(Math.random() * 10000000) + 1000;
        
        mockVideos.push({
            id: i,
            title: `${category} Video ${i}: Amazing Content Title Here`,
            channel: {
                name: `${category}Channel${Math.floor(Math.random() * 10) + 1}`,
                id: `channel_${Math.floor(Math.random() * 100)}`,
                avatar: `https://picsum.photos/seed/avatar${i}/40/40`,
                verified: Math.random() > 0.7
            },
            thumbnail: `https://picsum.photos/seed/video${i}/320/180`,
            duration: duration,
            uploadDate: Date.now() - (Math.random() * 30 * 24 * 60 * 60 * 1000),
            views: views,
            likes: Math.floor(views * (Math.random() * 0.1 + 0.01)),
            category: category,
            tags: [category.toLowerCase(), 'tutorial', 'learning', 'entertainment'],
            status: status,
            watchProgress: status === 'completed' ? 1 : (status === 'in-progress' ? Math.random() * 0.9 : 0),
            lastWatched: status !== 'unwatched' ? Date.now() - (Math.random() * 7 * 24 * 60 * 60 * 1000) : null,
            savedDate: status === 'saved' ? Date.now() - (Math.random() * 3 * 24 * 60 * 60 * 1000) : null,
            collections: status === 'saved' ? ['Watch Later'] : [],
            scatterPosition: { x: Math.random() * 800 + 100, y: Math.random() * 600 + 100 },
            description: `This is an amazing ${category.toLowerCase()} video that provides incredible value and entertainment. Join us as we explore fascinating topics and learn new things together.`
        });
    }
    
    return mockVideos;
}

function generateMockCollections() {
    return [
        { id: 1, name: 'Watch Tonight', color: '#ff6b6b', videoIds: [], layout: 'grid' },
        { id: 2, name: 'Learning Queue', color: '#4ecdc4', videoIds: [], layout: 'cascade' },
        { id: 3, name: 'Inspiration', color: '#ffe66d', videoIds: [], layout: 'radial' },
        { id: 4, name: 'Favorites', color: '#a8e6cf', videoIds: [], layout: 'grid' }
    ];
}

function updateHeaderHeight() {
    if (isMobile) {
        const headerTop = document.querySelector('.header-top');
        const categoryBar = document.querySelector('.category-bar');
        
        if (headerTop && categoryBar) {
            const headerTopHeight = headerTop.offsetHeight;
            const categoryBarHeight = categoryBar.offsetHeight;
            const totalHeaderHeight = headerTopHeight + categoryBarHeight;
            
            document.documentElement.style.setProperty('--header-height', `${totalHeaderHeight}px`);
            updateViewContainerPositions();
        }
    }
}

function updateViewContainerPositions() {
    const headerHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-height'));
    const navHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--nav-height'));
    
    const viewContainers = document.querySelectorAll('.view-container');
    viewContainers.forEach(container => {
        container.style.top = `${headerHeight}px`;
        container.style.height = `calc(100vh - ${headerHeight + navHeight}px)`;
    });
    
    const kanbanContainer = document.getElementById('kanbanContainer');
    if (kanbanContainer) {
        kanbanContainer.style.top = `${headerHeight}px`;
        kanbanContainer.style.height = `calc(100vh - ${headerHeight + navHeight}px)`;
    }
    
    const detailPanel = document.getElementById('detailPanel');
    if (detailPanel) {
        detailPanel.style.top = `${headerHeight}px`;
        detailPanel.style.height = `calc(100vh - ${headerHeight}px)`;
    }
}

function init() {
    detectMobile();
    videos = generateMockVideos();
    collections = generateMockCollections();
    loadState();
    renderCategories();
    renderCurrentView();
    setupEventListeners();
    setupTouchGestures();
    setupEnhancedJoystick();
    
    if (isMobile) {
        setupMobileJoystick();
        setTimeout(updateHeaderHeight, 100);
    }
    
    window.addEventListener('resize', handleResize);
    
    const categoryBar = document.getElementById('categoryBar');
    if (categoryBar) {
        new ResizeObserver(updateHeaderHeight).observe(categoryBar);
    }
}

function setupEventListeners() {
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT') return;
       
        switch(e.key.toLowerCase()) {
            case 'f': switchMode('feed'); break;
            case 's': switchMode('scatter'); break;
            case 'h': switchMode('history'); break;
            case 'l': switchMode('list'); break;
            case '/': 
                e.preventDefault(); 
                toggleSearchOverlay();
                break;
            case 'escape': 
                closeSearchOverlay();
                closeAllOverlays(); 
                break;
        }
    });
    
    document.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        showContextMenu(e);
    });
    
    document.addEventListener('click', () => {
        document.getElementById('contextMenu').classList.remove('active');
    });
    
    document.addEventListener('click', (e) => {
        const searchOverlay = document.getElementById('searchOverlay');
        const searchBtn = document.querySelector('.nav-btn[data-mode="search"]');
        
        if (searchOverlay.classList.contains('active') && 
            !searchOverlay.contains(e.target) && 
            e.target !== searchBtn && 
            !searchBtn.contains(e.target)) {
            closeSearchOverlay();
        }
    });
    
    if (isMobile) {
        setupMobileTouchListeners();
    }
}

function setupTouchGestures() {
    const views = ['feed', 'scatter', 'history', 'list'];
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    
    document.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        const diffX = touchEndX - touchStartX;
        
        if (Math.abs(diffX) > 50) {
            const currentIndex = views.indexOf(config.currentView);
            let newIndex;
            
            if (diffX > 0) {
                newIndex = currentIndex > 0 ? currentIndex - 1 : views.length - 1;
            } else {
                newIndex = currentIndex < views.length - 1 ? currentIndex + 1 : 0;
            }
            
            switchMode(views[newIndex]);
        }
    }, { passive: true });
}

function setupMobileTouchListeners() {
    let touchStartTime = 0;
    
    document.addEventListener('touchstart', (e) => {
        touchStartTime = Date.now();
        const card = e.target.closest('.video-card');
        
        if (card) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            
            card.touchTimeout = setTimeout(() => {
                const videoId = card.dataset.videoId;
                if (videoId) {
                    showVideoContextMenu(e, parseInt(videoId));
                }
            }, 500);
        }
    }, { passive: true });
    
    document.addEventListener('touchend', (e) => {
        const card = e.target.closest('.video-card');
        
        if (card && card.touchTimeout) {
            clearTimeout(card.touchTimeout);
            
            const touchDuration = Date.now() - touchStartTime;
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const diffX = Math.abs(touchEndX - touchStartX);
            const diffY = Math.abs(touchEndY - touchStartY);
            
            if (touchDuration < 300 && diffX < 10 && diffY < 10) {
                const videoId = card.dataset.videoId;
                if (videoId) {
                    openVideoDetail(parseInt(videoId));
                }
            }
        }
    }, { passive: true });
}

function handleResize() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
        detectMobile();
        updateHeaderHeight();
        
        if (config.currentView === 'scatter') {
            renderScatterView();
        }
        
        renderCurrentView();
        updateJoystickForCurrentView();
    }, 250);
}

function switchMode(mode) {
    if (mode === 'search') {
        toggleSearchOverlay();
        return;
    }
    
    if (config.currentView === 'scatter') {
        cleanupScatterListeners();
    }
    
    config.currentView = mode;
    
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.nav-btn[data-mode="${mode}"]`)?.classList.add('active');
    
    renderCurrentView();
    updateJoystickForCurrentView();
    saveState();
}

function renderCurrentView() {
    document.getElementById('gridContainer').classList.remove('active');
    document.getElementById('scatterContainer').classList.remove('active');
    document.getElementById('listContainer').classList.remove('active');
    document.getElementById('historyContainer').classList.remove('active');
    document.getElementById('kanbanContainer').classList.remove('active');
    
    switch(config.currentView) {
        case 'feed':
            document.getElementById('gridContainer').classList.add('active');
            renderGridView();
            break;
        case 'scatter':
            document.getElementById('scatterContainer').classList.add('active');
            renderScatterView();
            break;
        case 'history':
            document.getElementById('historyContainer').classList.add('active');
            renderHistoryView();
            break;
        case 'list':
            document.getElementById('kanbanContainer').classList.add('active');
            renderKanbanColumns();
            break;
    }
}

function renderCategories() {
    const categories = ['all', ...new Set(videos.map(v => v.category))];
    const categoryBar = document.getElementById('categoryBar');
    
    categoryBar.innerHTML = categories.map(cat => `
        <div class="pill ${config.currentCategory === cat ? 'active' : ''}"
             onclick="selectCategory('${cat}')">
          ${cat === 'all' ? 'All' : cat}
        </div>
    `).join('') + '<div class="pill add-btn" onclick="addCustomCategory()">+ Custom</div>';
    
    if (isMobile) {
        setTimeout(updateHeaderHeight, 50);
    }
}

function selectCategory(category) {
    config.currentCategory = category;
    renderCategories();
    renderCurrentView();
    saveState();
}

function filterVideos() {
    let filtered = videos;
    
    if (config.currentCategory !== 'all') {
        filtered = filtered.filter(v => v.category === config.currentCategory);
    }
    
    if (config.searchQuery) {
        filtered = filtered.filter(v =>
            v.title.toLowerCase().includes(config.searchQuery.toLowerCase()) ||
            v.channel.name.toLowerCase().includes(config.searchQuery.toLowerCase())
        );
    }
    
    return filtered;
}

function renderGridView() {
    const wrapper = document.getElementById('gridWrapper');
    if (!wrapper) return;
    
    const filtered = filterVideos();
    
    wrapper.innerHTML = filtered.map(video => createVideoCard(video)).join('');
}

function createVideoCard(video) {
    const duration = formatDuration(video.duration);
    const views = formatViews(video.views);
    
    return `
        <div class="video-card" 
             data-video-id="${video.id}" 
             role="button"
             tabindex="0"
             aria-label="Video: ${video.title}, Channel: ${video.channel.name}, Duration: ${duration}"
             onkeydown="if(event.key === 'Enter') openVideoDetail(${video.id})"
             oncontextmenu="showVideoContextMenu(event, ${video.id})">
            <div class="video-thumbnail">
                <img src="${video.thumbnail}" alt="${video.title}" loading="lazy">
                <div class="video-duration">${duration}</div>
                <div class="video-status status-${video.status}">${video.status.replace('-', ' ')}</div>
            </div>
            <div class="video-info">
                <div class="video-title">${video.title}</div>
                <div class="video-channel">
                    <div class="channel-avatar">
                        <img src="${video.channel.avatar}" alt="${video.channel.name}" width="24" height="24">
                    </div>
                    <span>${video.channel.name}</span>
                </div>
                <div class="video-meta">
                    <span class="video-views">${views} views</span>
                    <div class="video-actions">
                        <button class="action-icon" onclick="toggleSave(${video.id}); event.stopPropagation();" title="Save">
                            ${video.status === 'saved' ? '‚ô•' : '‚ô°'}
                        </button>
                        <button class="action-icon" onclick="shareVideo(${video.id}); event.stopPropagation();" title="Share">
                            ‚Üó
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function getStatusColor(status) {
    const colors = {
        'unwatched': 'var(--neon-blue)',
        'in-progress': 'var(--neon-orange)',
        'completed': 'var(--neon-green)',
        'saved': 'var(--accent)',
        'archived': 'var(--ink-dim)'
    };
    return colors[status] || 'var(--neon-blue)';
}

function renderScatterView() {
    const canvas = document.getElementById('scatterCanvas');
    if (!canvas) return;
    
    const filtered = filterVideos();
    
    canvas.innerHTML = '';
    
    const videosByCategory = {};
    filtered.forEach(video => {
        if (!videosByCategory[video.category]) {
            videosByCategory[video.category] = [];
        }
        videosByCategory[video.category].push(video);
    });
    
    const viewportWidth = canvas.clientWidth;
    const viewportHeight = canvas.clientHeight;
    const isMobileView = isMobile || window.innerWidth <= 768;
    
    const maxColumns = isMobileView ? 2 : 4;
    const categories = Object.keys(videosByCategory);
    const columns = Math.min(categories.length, maxColumns);
    
    const cardWidth = isMobileView ? 160 : 200;
    const cardHeight = isMobileView ? 130 : 160;
    const columnSpacing = isMobileView ? 20 : 40;
    const rowSpacing = isMobileView ? 15 : 25;
    
    const columnWidth = cardWidth;
    const totalWidth = columns * columnWidth + (columns - 1) * columnSpacing;
    const startX = (viewportWidth - totalWidth) / 2;
    
    let columnIndex = 0;
    
    for (const [category, categoryVideos] of Object.entries(videosByCategory)) {
        if (columnIndex >= columns) break;
        
        const columnX = startX + columnIndex * (columnWidth + columnSpacing);
        let rowY = 50;
        
        categoryVideos.forEach((video, index) => {
            const card = document.createElement('div');
            card.className = 'scatter-card';
            card.dataset.videoId = video.id;
            card.dataset.category = video.category;
            card.dataset.column = columnIndex;
            card.dataset.row = index;
            
            const cascadeOffset = isMobileView ? 15 : 20;
            const cascadeX = columnX + (index % 3) * 3;
            const cascadeY = rowY + index * cascadeOffset;
            
            card.style.left = `${cascadeX}px`;
            card.style.top = `${cascadeY}px`;
            
            video.scatterPosition = { x: cascadeX, y: cascadeY };
            
            card.innerHTML = `
                <div class="scatter-thumbnail">
                    <img src="${video.thumbnail}" alt="${video.title}" 
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                    <div style="position: absolute; bottom: 4px; right: 4px; 
                                background: rgba(0,0,0,0.8); color: white; 
                                padding: 2px 4px; border-radius: 4px; font-size: 10px;
                                font-family: var(--font-mono);">
                        ${formatDuration(video.duration)}
                    </div>
                </div>
                <div class="video-title" style="font-size: 12px; font-weight: 600; 
                      margin-top: 4px; line-height: 1.3; height: 32px; overflow: hidden;">
                    ${video.title.substring(0, 40)}${video.title.length > 40 ? '...' : ''}
                </div>
                <div class="video-channel" style="font-size: 11px; color: var(--ink-dim); 
                      margin-top: 2px;">
                    ${video.channel.name}
                </div>
                <div style="position: absolute; top: 8px; left: 8px; 
                      background: ${getStatusColor(video.status)}; 
                      color: white; padding: 2px 6px; border-radius: 10px; 
                      font-size: 9px; font-weight: 600;">
                    ${video.status.charAt(0).toUpperCase() + video.status.slice(1).replace('-', ' ')}
                </div>
            `;
            
            card.addEventListener('mousedown', startDragging);
            card.addEventListener('dblclick', () => openVideoDetail(video.id));
            card.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showVideoContextMenu(e, video.id);
            });
            
            card.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startTouchDragging(e, card);
            }, { passive: false });
            
            card.addEventListener('touchend', () => {
                stopDragging();
            }, { passive: true });
            
            canvas.appendChild(card);
            rowY += cardHeight / 2;
        });
        
        const columnLabel = document.createElement('div');
        columnLabel.className = 'scatter-column-label';
        columnLabel.style.position = 'absolute';
        columnLabel.style.left = `${columnX}px`;
        columnLabel.style.top = '20px';
        columnLabel.style.fontSize = '12px';
        columnLabel.style.fontWeight = '600';
        columnLabel.style.color = 'var(--ink-dim)';
        columnLabel.style.textTransform = 'uppercase';
        columnLabel.style.letterSpacing = '1px';
        columnLabel.textContent = category;
        canvas.appendChild(columnLabel);
        
        columnIndex++;
    }
    
    canvas.style.transform = `scale(${scatterZoom})`;
}

function cleanupScatterListeners() {
    const canvas = document.getElementById('scatterCanvas');
    if (canvas) {
        canvas.innerHTML = '';
    }
    stopDragging();
}

function arrangeAsGrid() {
    const canvas = document.getElementById('scatterCanvas');
    const cards = canvas.querySelectorAll('.scatter-card');
    const viewportWidth = canvas.clientWidth;
    const viewportHeight = canvas.clientHeight;
    
    const isMobileView = isMobile || window.innerWidth <= 768;
    const columns = isMobileView ? 2 : 4;
    const cardWidth = isMobileView ? 160 : 200;
    const cardHeight = isMobileView ? 130 : 160;
    const horizontalPadding = isMobileView ? 20 : 30;
    const verticalPadding = isMobileView ? 20 : 30;
    
    const rows = Math.ceil(cards.length / columns);
    const gridWidth = columns * cardWidth + (columns - 1) * horizontalPadding;
    const gridHeight = rows * cardHeight + (rows - 1) * verticalPadding;
    
    const startX = (viewportWidth - gridWidth) / 2;
    const startY = (viewportHeight - gridHeight) / 2;
    
    cards.forEach((card, index) => {
        const row = Math.floor(index / columns);
        const col = index % columns;
        
        const x = startX + col * (cardWidth + horizontalPadding);
        const y = startY + row * (cardHeight + verticalPadding);
        
        card.style.left = `${x}px`;
        card.style.top = `${y}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition = { x, y };
        }
    });
    
    document.querySelectorAll('.scatter-column-label').forEach(label => label.remove());
    
    saveState();
    showToast('Arranged as responsive grid');
}

function arrangeAsCascade() {
    renderScatterView();
    showToast('Arranged as columnar cascade');
}

function zoom(factor) {
    scatterZoom = Math.max(0.2, Math.min(3, scatterZoom + factor));
    const canvas = document.getElementById('scatterCanvas');
    if (canvas) {
        canvas.style.transform = `scale(${scatterZoom})`;
        showToast(`Zoom: ${Math.round(scatterZoom * 100)}%`);
    }
}

function resetView() {
    scatterZoom = 1;
    const canvas = document.getElementById('scatterCanvas');
    if (canvas) {
        canvas.style.transform = 'scale(1)';
    }
    showToast('View reset');
}

function renderHistoryView() {
    const tbody = document.getElementById('historyBody');
    if (!tbody) return;
    
    const historyVideos = videos.filter(v => v.lastWatched).sort((a, b) => b.lastWatched - a.lastWatched);
    
    tbody.innerHTML = historyVideos.map(video => `
        <tr onclick="openVideoDetail(${video.id})">
            <td><img src="${video.thumbnail}" alt="${video.title}" class="list-thumbnail"></td>
            <td>${video.title}</td>
            <td>${video.channel.name}</td>
            <td>${formatDuration(video.duration)}</td>
            <td>${formatViews(video.views)}</td>
            <td>${formatDate(video.lastWatched)}</td>
        </tr>
    `).join('');
}

function renderKanbanColumns() {
    const feedColumn = document.querySelector('#feedColumn .column-content');
    const gridVideos = filterVideos();
    if (feedColumn) {
        feedColumn.innerHTML = `
            <div class="grid-wrapper">
                ${gridVideos.slice(0, 5).map(video => createVideoCard(video)).join('')}
            </div>
        `;
    }
    
    const curatedColumn = document.querySelector('#curatedColumn .column-content');
    const savedVideos = videos.filter(v => v.status === 'saved');
    if (curatedColumn) {
        curatedColumn.innerHTML = savedVideos.slice(0, 5).map(video => createVideoCard(video)).join('');
    }
    
    const relatedColumn = document.querySelector('#relatedColumn .column-content');
    const relatedVideos = videos.slice(10, 15);
    if (relatedColumn) {
        relatedColumn.innerHTML = relatedVideos.map(video => createVideoCard(video)).join('');
    }
    
    const discoverColumn = document.querySelector('#discoverColumn .column-content');
    const discoverVideos = videos.slice(15, 20);
    if (discoverColumn) {
        discoverColumn.innerHTML = discoverVideos.map(video => createVideoCard(video)).join('');
    }
}

function openVideoDetail(videoId) {
    const video = videos.find(v => v.id === videoId);
    if (!video) return;
    
    currentVideo = video;
    const panel = document.getElementById('detailPanel');
    const content = document.getElementById('detailContent');
    
    content.innerHTML = `
        <div class="video-player">
            üìπ Video Player Placeholder<br>
            <small>${video.title}</small>
        </div>
        <h2 style="margin-bottom: 8px;">${video.title}</h2>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div class="channel-avatar">
                <img src="${video.channel.avatar}" alt="${video.channel.name}" width="40" height="40" style="border-radius: 50%;">
            </div>
            <div>
                <div style="font-weight: 600;">${video.channel.name}</div>
                <div style="font-size: 13px; color: var(--ink-dim);">${formatViews(video.views)} views ‚Ä¢ ${formatDate(video.uploadDate)}</div>
            </div>
        </div>
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
            <button class="action-icon" style="padding: 8px 16px; width: auto;">üëç Like</button>
            <button class="action-icon" style="padding: 8px 16px; width: auto;">üëé Dislike</button>
            <button class="action-icon" style="padding: 8px 16px; width: auto;" onclick="shareVideo(${video.id})">
                ‚Üó Share
            </button>
            <button class="action-icon" style="padding: 8px 16px; width: auto;" onclick="toggleSave(${video.id})">
                ${video.status === 'saved' ? '‚ô• Saved' : '‚ô° Save'}
            </button>
        </div>
        <div style="padding-top: 16px; border-top: 1px solid var(--glass-border);">
            <h3 style="margin-bottom: 8px;">Description</h3>
            <p style="color: var(--ink-dim); line-height: 1.6;">${video.description}</p>
        </div>
        <div style="margin-top: 24px;">
            <h3>Comments</h3>
            <div style="color: var(--ink-dim);">Comments section would go here...</div>
        </div>
    `;
    
    const modeIcon = document.getElementById('videoModeIcon');
    const modeText = document.getElementById('videoModeText');
    
    if (videoOverlayMode === 'side-panel') {
        modeIcon.textContent = '‚õ∂';
        modeText.textContent = 'Full Screen';
    } else {
        modeIcon.textContent = '‚õ∂';
        modeText.textContent = 'Side Panel';
    }
    
    panel.classList.add('active');
}

function closeDetailPanel() {
    document.getElementById('detailPanel').classList.remove('active');
    currentVideo = null;
}

function toggleVideoMode() {
    const panel = document.getElementById('detailPanel');
    const modeIcon = document.getElementById('videoModeIcon');
    const modeText = document.getElementById('videoModeText');
    
    if (videoOverlayMode === 'side-panel') {
        videoOverlayMode = 'full-viewport';
        panel.classList.remove('side-panel');
        panel.classList.add('full-viewport');
        modeIcon.textContent = '‚õ∂';
        modeText.textContent = 'Side Panel';
        showToast('Switched to full viewport mode');
    } else {
        videoOverlayMode = 'side-panel';
        panel.classList.remove('full-viewport');
        panel.classList.add('side-panel');
        modeIcon.textContent = '‚õ∂';
        modeText.textContent = 'Full Screen';
        showToast('Switched to side panel mode');
    }
    
    if (panel.classList.contains('active')) {
        panel.classList.remove('active');
        setTimeout(() => panel.classList.add('active'), 50);
    }
    
    saveState();
}

function toggleSearchOverlay() {
    const searchOverlay = document.getElementById('searchOverlay');
    const isActive = searchOverlay.classList.toggle('active');
    
    if (isActive) {
        document.body.classList.add('search-active');
        document.getElementById('mainSearchInput').focus();
        document.getElementById('discoverySections').style.display = 'block';
        document.getElementById('searchResults').style.display = 'none';
    } else {
        document.body.classList.remove('search-active');
        document.getElementById('mainSearchInput').value = '';
        config.searchQuery = '';
        document.getElementById('searchResults').style.display = 'none';
        document.getElementById('discoverySections').style.display = 'block';
    }
}

function closeSearchOverlay() {
    const overlay = document.getElementById('searchOverlay');
    overlay.classList.remove('active');
    document.getElementById('mainSearchInput').value = '';
    config.searchQuery = '';
    document.body.classList.remove('search-active');
    document.getElementById('searchResults').style.display = 'none';
    document.getElementById('discoverySections').style.display = 'block';
}

function performSearch() {
    const input = document.getElementById('headerSearch');
    const searchValue = input ? input.value : '';
    
    if (searchValue.trim()) {
        config.searchQuery = searchValue;
        
        toggleSearchOverlay();
        showSearchResults(searchValue);
        
        if (input) input.value = '';
    }
}

function showSearchResults(query) {
    const resultsGrid = document.getElementById('searchResultsGrid');
    const recommendedGrid = document.getElementById('recommendedGrid');
    const discoverySections = document.getElementById('discoverySections');
    const searchResults = document.getElementById('searchResults');
    
    if (!query.trim()) {
        discoverySections.style.display = 'block';
        searchResults.style.display = 'none';
        return;
    }
    
    const searchResultsVideos = videos.filter(v =>
        v.title.toLowerCase().includes(query.toLowerCase()) ||
        v.channel.name.toLowerCase().includes(query.toLowerCase()) ||
        v.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))
    ).slice(0, 12);
    
    const recommendedVideos = videos
        .filter(v => !searchResultsVideos.some(r => r.id === v.id))
        .slice(0, 8);
    
    resultsGrid.innerHTML = searchResultsVideos.map((video, index) => {
        const size = index % 4 === 0 ? 'large' : (index % 3 === 0 ? 'medium' : 'small');
        return `
            <div class="bento-item ${size}" onclick="openVideoDetail(${video.id})">
                <div style="display: flex; gap: 12px; height: 100%;">
                    <img src="${video.thumbnail}" alt="${video.title}" 
                         style="width: ${size === 'large' ? '120px' : '80px'}; 
                                height: ${size === 'large' ? '80px' : '60px'};
                                border-radius: 8px; object-fit: cover;">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 4px; font-size: ${size === 'large' ? '16px' : '14px'}">
                            ${video.title.substring(0, size === 'large' ? 60 : 40)}...
                        </div>
                        <div style="font-size: 12px; color: var(--ink-dim);">
                            ${video.channel.name} ‚Ä¢ ${formatViews(video.views)} views
                        </div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    recommendedGrid.innerHTML = recommendedVideos.map((video, index) => {
        const size = index % 4 === 0 ? 'large' : 'small';
        return `
            <div class="bento-item ${size}" onclick="openVideoDetail(${video.id})">
                <div style="font-weight: 600; margin-bottom: 8px;">${video.title.substring(0, 50)}...</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${video.channel.avatar}" alt="${video.channel.name}" 
                         style="width: 24px; height: 24px; border-radius: 50%;">
                    <span style="font-size: 12px; color: var(--ink-dim);">${video.channel.name}</span>
                </div>
            </div>
        `;
    }).join('');
    
    discoverySections.style.display = 'none';
    searchResults.style.display = 'block';
    
    document.querySelector('.search-container').scrollTop = 0;
}

function updateSearchSuggestions(query) {
    const suggestions = document.getElementById('searchSuggestions');
    if (!suggestions) return;
    
    if (query.length > 2) {
        suggestions.style.display = 'flex';
    } else {
        suggestions.style.display = 'none';
    }
    
    if (query.length > 0) {
        showSearchResults(query);
    } else {
        document.getElementById('discoverySections').style.display = 'block';
        document.getElementById('searchResults').style.display = 'none';
    }
}

function searchFor(term) {
    document.getElementById('mainSearchInput').value = term;
    updateSearchSuggestions(term);
    showSearchResults(term);
}

function startVoiceSearch() {
    showToast('Voice search activated - say your query', 'info');
}

function showContextMenu(event) {
    event.preventDefault();
    const menu = document.getElementById('contextMenu');
    
    if (event.target.closest('.video-card') || event.target.closest('.scatter-card')) {
        return;
    } else if (event.target.closest('#scatterCanvas')) {
        showScatterContextMenu(event);
    } else {
        menu.innerHTML = `
            <div class="ctx-header">Actions</div>
            <div class="ctx-item" onclick="toggleSearchOverlay()">üîç Search Videos</div>
            <div class="ctx-item" onclick="switchMode('feed')">üè† Feed View</div>
            <div class="ctx-item" onclick="switchMode('scatter')">üïí Scatter View</div>
            <div class="ctx-item" onclick="switchMode('history')">üìú History</div>
            <div class="ctx-item" onclick="switchMode('list')">Êï£ Kanban View</div>
        `;
    }
    
    menu.style.left = `${event.clientX}px`;
    menu.style.top = `${event.clientY}px`;
    menu.classList.add('active');
}

function showVideoContextMenu(event, videoId) {
    event.preventDefault();
    event.stopPropagation();
    
    const video = videos.find(v => v.id === videoId);
    const menu = document.getElementById('contextMenu');
    
    menu.innerHTML = `
        <div class="ctx-header">${video.channel.name}</div>
        <div class="ctx-item" onclick="openVideoDetail(${videoId})">‚ñ∂ Play Now</div>
        <div class="ctx-item" onclick="toggleSave(${videoId})">${video.status === 'saved' ? '‚ô• Unsave' : '‚ô° Save Video'}</div>
        <div class="ctx-item" onclick="shareVideo(${videoId})">‚Üó Share</div>
        <div class="ctx-item text-blue" onclick="changeVideoStatus(${videoId}, 'in-progress')">‚èØ Mark Watching</div>
        <div class="ctx-item text-green" onclick="changeVideoStatus(${videoId}, 'completed')">‚úì Mark Complete</div>
        <div class="ctx-item text-red" onclick="removeVideo(${videoId})">üóë Remove</div>
    `;
    
    menu.style.left = `${event.clientX}px`;
    menu.style.top = `${event.clientY}px`;
    menu.classList.add('active');
}

function showScatterContextMenu(event) {
    const menu = document.getElementById('contextMenu');
    
    menu.innerHTML = `
        <div class="ctx-header">Canvas Actions</div>
        <div class="ctx-item" onclick="collectNodes()">üì¶ Collect (Grid)</div>
        <div class="ctx-item" onclick="cascadeNodes()">üé¥ Cascade (Stack)</div>
        <div class="ctx-item" onclick="sortScatterByStatus()">üè∑ Sort by Status</div>
        <div class="ctx-item" onclick="sortScatterByCategory()">üìÇ Sort by Category</div>
        <div class="ctx-item" onclick="resetScatterView()">üîÑ Reset View</div>
    `;
    
    menu.style.left = `${event.clientX}px`;
    menu.style.top = `${event.clientY}px`;
    menu.classList.add('active');
}

function toggleSave(videoId) {
    const video = videos.find(v => v.id === videoId);
    if (!video) return;
    
    if (video.status === 'saved') {
        video.status = 'unwatched';
        video.collections = [];
    } else {
        video.status = 'saved';
        video.collections = ['Watch Later'];
    }
    
    renderCurrentView();
    saveState();
    showToast(video.status === 'saved' ? 'Video saved!' : 'Video unsaved');
}

function shareVideo(videoId) {
    const video = videos.find(v => v.id === videoId);
    if (!video) return;
    
    const url = `https://youtube.com/watch?v=${videoId}`;
    navigator.clipboard.writeText(url).then(() => {
        showToast('Link copied to clipboard!');
    }).catch(() => {
        showToast('Failed to copy link', 'error');
    });
}

function changeVideoStatus(videoId, status) {
    const video = videos.find(v => v.id === videoId);
    if (!video) return;
    
    video.status = status;
    if (status === 'in-progress' || status === 'completed') {
        video.lastWatched = Date.now();
    }
    renderCurrentView();
    saveState();
    showToast(`Status changed to ${status.replace('-', ' ')}`);
}

function removeVideo(videoId) {
    if (confirm('Remove this video?')) {
        videos = videos.filter(v => v.id !== videoId);
        renderCurrentView();
        saveState();
        showToast('Video removed');
    }
}

function startDragging(e) {
    if (config.currentView !== 'scatter') return;
    
    isDragging = true;
    draggedCard = e.currentTarget;
    draggedCard.classList.add('is-dragging');
    
    const rect = draggedCard.getBoundingClientRect();
    dragOffset.x = e.clientX - rect.left;
    dragOffset.y = e.clientY - rect.top;
    
    draggedCard.style.zIndex = '2000';
    
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDragging);
}

function startTouchDragging(e, card) {
    if (config.currentView !== 'scatter') return;
    
    isDragging = true;
    draggedCard = card;
    draggedCard.classList.add('is-dragging');
    
    const touch = e.touches[0];
    const rect = draggedCard.getBoundingClientRect();
    dragOffset.x = touch.clientX - rect.left;
    dragOffset.y = touch.clientY - rect.top;
    
    draggedCard.style.zIndex = '2000';
    
    document.addEventListener('touchmove', touchDrag, { passive: false });
    document.addEventListener('touchend', stopDragging, { passive: true });
}

function drag(e) {
    if (!isDragging || !draggedCard) return;
    
    const canvas = document.getElementById('scatterCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    
    const x = (e.clientX - canvasRect.left - dragOffset.x) / scatterZoom;
    const y = (e.clientY - canvasRect.top - dragOffset.y) / scatterZoom;
    
    draggedCard.style.left = `${x}px`;
    draggedCard.style.top = `${y}px`;
}

function touchDrag(e) {
    if (!isDragging || !draggedCard) return;
    
    e.preventDefault();
    
    const canvas = document.getElementById('scatterCanvas');
    const canvasRect = canvas.getBoundingClientRect();
    const touch = e.touches[0];
    
    const x = (touch.clientX - canvasRect.left - dragOffset.x) / scatterZoom;
    const y = (touch.clientY - canvasRect.top - dragOffset.y) / scatterZoom;
    
    draggedCard.style.left = `${x}px`;
    draggedCard.style.top = `${y}px`;
}

function stopDragging() {
    if (draggedCard) {
        draggedCard.classList.remove('is-dragging');
        draggedCard.style.zIndex = '';
        
        if (config.currentView === 'scatter') {
            snapToNearestColumn(draggedCard);
        }
        
        const videoId = parseInt(draggedCard.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition.x = parseFloat(draggedCard.style.left);
            video.scatterPosition.y = parseFloat(draggedCard.style.top);
        }
    }
    
    isDragging = false;
    draggedCard = null;
    
    document.removeEventListener('mousemove', drag);
    document.removeEventListener('mouseup', stopDragging);
    document.removeEventListener('touchmove', touchDrag);
    document.removeEventListener('touchend', stopDragging);
    
    saveState();
}

function snapToNearestColumn(card) {
    const canvas = document.getElementById('scatterCanvas');
    const cards = canvas.querySelectorAll('.scatter-card');
    const cardX = parseFloat(card.style.left);
    
    const columnPositions = [];
    cards.forEach(otherCard => {
        if (otherCard !== card) {
            const otherX = parseFloat(otherCard.style.left);
            const existingColumn = columnPositions.find(col => Math.abs(col - otherX) < 50);
            if (!existingColumn) {
                columnPositions.push(otherX);
            }
        }
    });
    
    if (columnPositions.length > 0) {
        let nearestColumn = columnPositions[0];
        let minDistance = Math.abs(cardX - nearestColumn);
        
        columnPositions.forEach(col => {
            const distance = Math.abs(cardX - col);
            if (distance < minDistance) {
                minDistance = distance;
                nearestColumn = col;
            }
        });
        
        if (minDistance < 100) {
            card.style.left = `${nearestColumn}px`;
            card.style.transition = 'left 0.3s ease';
            setTimeout(() => {
                card.style.transition = '';
            }, 300);
        }
    }
}

function collectNodes() {
    const canvas = document.getElementById('scatterCanvas');
    const cards = canvas.querySelectorAll('.scatter-card');
    
    cards.forEach((card, index) => {
        const row = Math.floor(index / 5);
        const col = index % 5;
        card.style.left = `${50 + col * 220}px`;
        card.style.top = `${100 + row * 200}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition = { x: 50 + col * 220, y: 100 + row * 200 };
        }
    });
    
    saveState();
    showToast('Videos collected in grid');
}

function cascadeNodes() {
    const canvas = document.getElementById('scatterCanvas');
    const cards = canvas.querySelectorAll('.scatter-card');
    
    cards.forEach((card, index) => {
        card.style.left = `${100 + index * 10}px`;
        card.style.top = `${100 + index * 10}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition = { x: 100 + index * 10, y: 100 + index * 10 };
        }
    });
    
    saveState();
    showToast('Videos cascaded');
}

function sortScatterByStatus() {
    const canvas = document.getElementById('scatterCanvas');
    const cards = Array.from(canvas.querySelectorAll('.scatter-card'));
    
    cards.sort((a, b) => {
        const videoA = videos.find(v => v.id === parseInt(a.dataset.videoId));
        const videoB = videos.find(v => v.id === parseInt(b.dataset.videoId));
        return videoA.status.localeCompare(videoB.status);
    });
    
    cards.forEach((card, index) => {
        const row = Math.floor(index / 5);
        const col = index % 5;
        card.style.left = `${50 + col * 220}px`;
        card.style.top = `${100 + row * 200}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition = { x: 50 + col * 220, y: 100 + row * 200 };
        }
    });
    
    saveState();
    showToast('Sorted by status');
}

function sortScatterByCategory() {
    const canvas = document.getElementById('scatterCanvas');
    const cards = Array.from(canvas.querySelectorAll('.scatter-card'));
    
    cards.sort((a, b) => {
        const videoA = videos.find(v => v.id === parseInt(a.dataset.videoId));
        const videoB = videos.find(v => v.id === parseInt(b.dataset.videoId));
        return videoA.category.localeCompare(videoB.category);
    });
    
    cards.forEach((card, index) => {
        const row = Math.floor(index / 5);
        const col = index % 5;
        card.style.left = `${50 + col * 220}px`;
        card.style.top = `${100 + row * 200}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition = { x: 50 + col * 220, y: 100 + row * 200 };
        }
    });
    
    saveState();
    showToast('Sorted by category');
}

function resetScatterView() {
    scatterZoom = 1;
    const canvas = document.getElementById('scatterCanvas');
    if (canvas) {
        canvas.style.transform = 'scale(1)';
    }
    showToast('Scatter view reset');
}

function cycleTheme() {
    const themes = ['dark', 'light', 'rose', 'theater'];
    const currentIndex = themes.indexOf(config.currentTheme);
    const nextIndex = (currentIndex + 1) % themes.length;
    config.currentTheme = themes[nextIndex];
    
    document.body.setAttribute('data-theme', config.currentTheme);
    
    const themeIcons = {
        'dark': 'üåô',
        'light': '‚òÄÔ∏è',
        'rose': 'üåπ',
        'theater': 'üé≠'
    };
    
    document.getElementById('themeIcon').textContent = themeIcons[config.currentTheme] || 'üåô';
    updateJoystickAppearance();
    saveState();
}

function updateJoystickAppearance() {
    const joystick = document.getElementById('youtubeJoystickFab');
    if (!joystick) return;
    
    switch(config.currentTheme) {
        case 'light':
            joystick.style.background = 'rgba(255, 255, 255, 0.9)';
            joystick.style.borderColor = 'rgba(0, 0, 0, 0.2)';
            break;
        case 'rose':
            joystick.style.background = 'rgba(255, 141, 161, 0.1)';
            joystick.style.borderColor = 'var(--rose-primary)';
            break;
        case 'theater':
            joystick.style.background = 'rgba(0, 0, 0, 0.9)';
            joystick.style.borderColor = 'var(--accent)';
            break;
        default:
            joystick.style.background = 'var(--glass-bg)';
            joystick.style.borderColor = 'var(--glass-border)';
    }
}

function toggleView() {
    if (config.currentView === 'feed') {
        switchMode('list');
    } else if (config.currentView === 'list') {
        switchMode('feed');
    }
}

function openCreateModal() {
    document.getElementById('createModal').classList.add('active');
}

function closeCreateModal() {
    document.getElementById('createModal').classList.remove('active');
}

function createItem(type) {
    closeCreateModal();
    showToast(`Creating ${type}...`, 'info');
}

function toggleProfileMenu() {
    document.getElementById('profileMenu').classList.toggle('active');
}

function toggleNotifications() {
    showToast('No new notifications', 'info');
}

function navigateTo(page) {
    showToast(`Navigating to ${page}...`, 'info');
    document.getElementById('profileMenu').classList.remove('active');
}

function toggleFilter(element) {
    element.parentElement.querySelectorAll('.filter-pill').forEach(pill => {
        pill.classList.remove('active');
    });
    element.classList.add('active');
}

function toggleSwitch(element) {
    element.classList.toggle('active');
}

function saveState() {
    const state = {
        config: config,
        videos: videos,
        collections: collections,
        scatterZoom: scatterZoom,
        videoOverlayMode: videoOverlayMode,
        joystickMode: joystickMode
    };
    localStorage.setItem('youtubeReimagined', JSON.stringify(state));
}

function loadState() {
    const saved = localStorage.getItem('youtubeReimagined');
    if (saved) {
        try {
            const state = JSON.parse(saved);
            config = state.config || config;
            videos = state.videos || videos;
            collections = state.collections || collections;
            scatterZoom = state.scatterZoom || 1;
            videoOverlayMode = state.videoOverlayMode || 'side-panel';
            joystickMode = state.joystickMode || 'auto';
            
            document.body.setAttribute('data-theme', config.currentTheme);
        } catch (e) {
            console.error('Failed to load state:', e);
        }
    }
}

function closeAllOverlays() {
    document.getElementById('searchOverlay').classList.remove('active');
    document.getElementById('createModal').classList.remove('active');
    document.getElementById('detailPanel').classList.remove('active');
    document.getElementById('contextMenu').classList.remove('active');
    document.getElementById('profileMenu').classList.remove('active');
}

function addCustomCategory() {
    const category = prompt('Enter new category name:');
    if (category && category.trim()) {
        showToast(`Category "${category}" added!`, 'info');
    }
}

function updateJoystickForCurrentView() {
    const container = document.getElementById('joystickContainer');
    const joystick = document.getElementById('youtubeJoystickFab');
    
    if (!container || !joystick) return;
    
    if (isMobile) {
        if (config.currentView === 'scatter' || config.currentView === 'list') {
            container.classList.add('active');
            joystick.classList.add('mobile-active');
        } else {
            container.classList.remove('active');
        }
    } else {
        if (config.currentView === 'scatter') {
            container.classList.add('active');
        } else {
            container.classList.remove('active');
        }
    }
}

function performJoystickNavigation(deltaX, deltaY) {
    if (joystickMode !== 'auto') return;
    
    const threshold = 20;
    const currentView = config.currentView;
    
    switch (currentView) {
        case 'scatter':
            performScatterJoystickNavigation(deltaX, deltaY, threshold);
            break;
        case 'list':
            performKanbanJoystickNavigation(deltaX, deltaY, threshold);
            break;
        default:
            performDefaultNavigation(deltaX, deltaY, threshold);
    }
}

function performScatterJoystickNavigation(deltaX, deltaY, threshold) {
    const canvas = document.getElementById('scatterCanvas');
    if (!canvas) return;
    
    const moveX = deltaX / 8;
    const moveY = deltaY / 8;
    
    const cards = canvas.querySelectorAll('.scatter-card');
    let moved = false;
    
    cards.forEach(card => {
        const currentX = parseFloat(card.style.left) || 0;
        const currentY = parseFloat(card.style.top) || 0;
        
        let newX = currentX + moveX;
        let newY = currentY + moveY;
        
        const viewportWidth = canvas.clientWidth / scatterZoom;
        const viewportHeight = canvas.clientHeight / scatterZoom;
        const cardWidth = 200;
        const cardHeight = 160;
        
        newX = Math.max(-cardWidth, Math.min(newX, viewportWidth));
        newY = Math.max(-cardHeight, Math.min(newY, viewportHeight));
        
        card.style.left = `${newX}px`;
        card.style.top = `${newY}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
            video.scatterPosition.x = newX;
            video.scatterPosition.y = newY;
        }
        
        moved = true;
    });
    
    const labels = document.querySelectorAll('.scatter-column-label');
    labels.forEach(label => {
        const currentX = parseFloat(label.style.left) || 0;
        const currentY = parseFloat(label.style.top) || 0;
        label.style.left = `${currentX + moveX}px`;
        label.style.top = `${currentY + moveY}px`;
    });
    
    if (moved) {
        saveState();
    }
}

function performKanbanJoystickNavigation(deltaX, deltaY, threshold) {
    const container = document.getElementById('kanbanContainer');
    if (!container) return;
    
    const columns = container.querySelectorAll('.kanban-column');
    let activeColumnIndex = 0;
    
    columns.forEach((col, index) => {
        if (col.classList.contains('active')) {
            activeColumnIndex = index;
        }
    });
    
    if (Math.abs(deltaX) > threshold) {
        let newIndex = activeColumnIndex;
        
        if (deltaX > threshold && activeColumnIndex < columns.length - 1) {
            newIndex = activeColumnIndex + 1;
        } else if (deltaX < -threshold && activeColumnIndex > 0) {
            newIndex = activeColumnIndex - 1;
        }
        
        if (newIndex !== activeColumnIndex) {
            switchToKanbanColumn(newIndex);
        }
    }
    
    const activeColumn = columns[activeColumnIndex];
    if (activeColumn && Math.abs(deltaY) > threshold) {
        const content = activeColumn.querySelector('.column-content');
        if (content) {
            const scrollAmount = deltaY > 0 ? 100 : -100;
            content.scrollTop += scrollAmount;
        }
    }
}

function switchToKanbanColumn(index) {
    const columns = document.querySelectorAll('.kanban-column');
    columns.forEach(col => col.classList.remove('active'));
    
    if (columns[index]) {
        columns[index].classList.add('active');
        
        const columnTitle = columns[index].querySelector('.column-title').textContent;
        showToast(`Switched to: ${columnTitle}`);
        
        if (isMobile) {
            columns[index].scrollIntoView({ 
                behavior: 'smooth', 
                inline: 'start',
                block: 'nearest'
            });
        }
    }
}

function performDefaultNavigation(deltaX, deltaY, threshold) {
    const activeView = document.querySelector('.view-container.active');
    if (!activeView) return;
    
    const scrollAmount = 50;
    
    if (deltaY > threshold) {
        activeView.scrollTop += scrollAmount;
    } else if (deltaY < -threshold) {
        activeView.scrollTop -= scrollAmount;
    }
}

function setupEnhancedJoystick() {
    const container = document.getElementById('joystickContainer');
    const joystick = document.getElementById('youtubeJoystickFab');
    const handle = document.getElementById('youtubeJoystickHandle');
    
    if (!joystick || !container) return;
    
    handle.addEventListener('mousedown', startJoystickDrag);
    handle.addEventListener('touchstart', startJoystickDrag, { passive: false });
    
    updateJoystickForCurrentView();
}

function startJoystickDrag(e) {
    if (joystickMode === 'disabled') return;
    
    e.preventDefault();
    joystickActive = true;
    
    const joystick = document.getElementById('youtubeJoystickFab');
    joystick.classList.add('pressed');
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    
    joystickStartPosition = { x: clientX, y: clientY };
    
    document.addEventListener('mousemove', handleJoystickDrag);
    document.addEventListener('mouseup', endJoystickDrag);
    document.addEventListener('touchmove', handleJoystickDrag, { passive: false });
    document.addEventListener('touchend', endJoystickDrag);
}

function handleJoystickDrag(e) {
    if (!joystickActive) return;
    
    e.preventDefault();
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
    
    const deltaX = clientX - joystickStartPosition.x;
    const deltaY = clientY - joystickStartPosition.y;
    
    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
    const maxDistance = 30;
    
    if (distance > maxDistance) {
        const angle = Math.atan2(deltaY, deltaX);
        joystickCurrentPosition = {
            x: Math.cos(angle) * maxDistance,
            y: Math.sin(angle) * maxDistance
        };
    } else {
        joystickCurrentPosition = { x: deltaX, y: deltaY };
    }
    
    const handle = document.getElementById('youtubeJoystickHandle');
    handle.style.transform = `translate(${joystickCurrentPosition.x}px, ${joystickCurrentPosition.y}px)`;
    
    updateDirectionalIndicators(deltaX, deltaY);
    performJoystickNavigation(deltaX, deltaY);
}

function endJoystickDrag() {
    joystickActive = false;
    
    const joystick = document.getElementById('youtubeJoystickFab');
    joystick.classList.remove('pressed');
    
    const handle = document.getElementById('youtubeJoystickHandle');
    handle.style.transform = 'translate(0, 0)';
    
    document.querySelectorAll('.youtube-direction-indicator').forEach(indicator => {
        indicator.classList.remove('active');
    });
    
    document.removeEventListener('mousemove', handleJoystickDrag);
    document.removeEventListener('mouseup', endJoystickDrag);
    document.removeEventListener('touchmove', handleJoystickDrag);
    document.removeEventListener('touchend', endJoystickDrag);
}

function updateDirectionalIndicators(deltaX, deltaY) {
    const indicators = {
        up: document.getElementById('youtubeIndicatorUp'),
        right: document.getElementById('youtubeIndicatorRight'),
        down: document.getElementById('youtubeIndicatorDown'),
        left: document.getElementById('youtubeIndicatorLeft')
    };
    
    Object.values(indicators).forEach(indicator => {
        indicator.classList.remove('active');
    });
    
    const threshold = 10;
    
    if (deltaY < -threshold) indicators.up.classList.add('active');
    if (deltaX > threshold) indicators.right.classList.add('active');
    if (deltaY > threshold) indicators.down.classList.add('active');
    if (deltaX < -threshold) indicators.left.classList.add('active');
}

function setupMobileJoystick() {
    if (!isMobile) return;
    
    const joystick = document.getElementById('youtubeJoystickFab');
    if (!joystick) return;
    
    const provideHapticFeedback = () => {
        if ('vibrate' in navigator) {
            navigator.vibrate(10);
        }
    };
    
    joystick.addEventListener('touchstart', (e) => {
        provideHapticFeedback();
    }, { passive: true });
    
    let touchStartTime = 0;
    let touchStartX = 0;
    let touchStartY = 0;
    
    document.addEventListener('touchstart', (e) => {
        touchStartTime = Date.now();
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
    }, { passive: true });
    
    document.addEventListener('touchend', (e) => {
        const touchDuration = Date.now() - touchStartTime;
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const diffX = touchEndX - touchStartX;
        
        if (touchDuration < 300 && Math.abs(diffX) > 50) {
            if (config.currentView === 'list') {
                const columns = document.querySelectorAll('.kanban-column');
                const currentIndex = Array.from(columns).findIndex(col => col.classList.contains('active'));
                let newIndex = currentIndex;
                
                if (diffX > 0 && currentIndex > 0) {
                    newIndex = currentIndex - 1;
                } else if (diffX < 0 && currentIndex < columns.length - 1) {
                    newIndex = currentIndex + 1;
                }
                
                if (newIndex !== currentIndex) {
                    switchToKanbanColumn(newIndex);
                    provideHapticFeedback();
                }
            }
        }
    }, { passive: true });
}

function applyMobileHeaderFix() {
    if (isMobile) {
        updateViewContainerPositions();
        
        setTimeout(() => {
            updateViewContainerPositions();
            
            const headerElements = document.querySelectorAll('.app-header, .category-bar');
            headerElements.forEach(el => {
                el.addEventListener('touchmove', (e) => {
                    e.stopPropagation();
                }, { passive: false });
            });
        }, 500);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    init();
    setupEnhancedJoystick();
    
    setTimeout(() => {
        updateJoystickForCurrentView();
        updateJoystickAppearance();
        applyMobileHeaderFix();
    }, 500);
    
    const originalSwitchMode = switchMode;
    switchMode = function(mode) {
        originalSwitchMode.call(this, mode);
        setTimeout(() => {
            updateJoystickForCurrentView();
            applyMobileHeaderFix();
        }, 100);
    };
    
    window.addEventListener('load', applyMobileHeaderFix);
});
  </script>
</body>
</html>
