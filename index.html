<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <link rel="icon" href="/favicon.ico" sizes="any">

<title>intoview.pro</title>
<style>
  :root{
    /* Base */
    --bg:#000;
    --maxw:320px;
    --pad:clamp(12px,4vw,28px);
    --svg-w:min(92vw, 240px);
    --facet-ease:.18s ease;
    --halo-pad:12;

    /* Isometric grid (with master opacity) */
    --grid-gap: 4px;                 /* distance between thin lines */
    --grid-alpha: .1;                /* master knob: 0 → none, 1 → strong */
    --grid-thin: rgb(255 255 255 / calc(var(--grid-alpha) * .10));
    --grid-bold: rgb(255 255 255 / calc(var(--grid-alpha) * .24));

    /* Interactive highlight cells */
    --iso-cell:  calc(var(--grid-gap) * 4); /* rhombus size (defaults to bold step) */
    --iso-highlight-fill: 255 255 255;      /* RGB (no slash alpha) */
    --iso-highlight-alpha: .25;             /* max fill opacity */
    --iso-stroke-alpha: .55;                /* edge stroke opacity at start */
    --iso-fade-ms: 900;                     /* fade duration per pulse */

    /* NEW: distance-based blur controls (keeps your sizing) */
    --iso-blur-min: 0px;   /* blur at center */
    --iso-blur-max: 12px;  /* blur at far edge */
    --iso-blur-curve: 1.35;/* >1 = faster growth with distance */
  }

  html,body{height:100%}

  body{
    margin:0;
    display:grid;
    place-items:center;
    -webkit-tap-highlight-color:transparent;

    /* solid base */
    background-color:var(--bg);

    /* 30° isometric grid drawn as layered background images */
    background-image:
      /* thin lines at 30°, 90°, 150° */
      repeating-linear-gradient(30deg,  var(--grid-thin) 0 1px, transparent 1px var(--grid-gap)),
      repeating-linear-gradient(90deg,  var(--grid-thin) 0 1px, transparent 1px var(--grid-gap)),
      repeating-linear-gradient(150deg, var(--grid-thin) 0 1px, transparent 1px var(--grid-gap)),
      /* bold guide every 4 steps */
      repeating-linear-gradient(30deg,
        transparent 0 calc(var(--grid-gap)*4 - 1px),
        var(--grid-bold) calc(var(--grid-gap)*4 - 1px) calc(var(--grid-gap)*4)
      ),
      repeating-linear-gradient(90deg,
        transparent 0 calc(var(--grid-gap)*4 - 1px),
        var(--grid-bold) calc(var(--grid-gap)*4 - 1px) calc(var(--grid-gap)*4)
      ),
      repeating-linear-gradient(150deg,
        transparent 0 calc(var(--grid-gap)*4 - 1px),
        var(--grid-bold) calc(var(--grid-gap)*4 - 1px) calc(var(--grid-gap)*4)
      );

    /* keep the pattern pinned to the viewport */
    background-attachment: fixed, fixed, fixed, fixed, fixed, fixed;
  }

  /* Highlight canvas under content */
  .iso-canvas{
    position: fixed;
    inset: 0;
    z-index: 0;            /* your .wrap is z-index:1, so this sits behind */
    pointer-events: none;  /* never blocks interactions */
  }

  .wrap{
    width:min(var(--maxw), 100vw);
    max-width:100%;
    padding:var(--pad);
    display:grid;
    place-items:center;
    position:relative;
    z-index:1;             /* above the highlight canvas */
  }

  svg{
    width:var(--svg-w);
    height:auto;
    display:block;
  }

  /* Interactivity — cube facets */
  .cube{
    cursor:pointer;
    outline:none;
    pointer-events:bounding-box;       /* easier taps */
    touch-action:manipulation;
    -webkit-user-select:none; user-select:none;
    will-change:filter, transform;
  }
  .cube *{ transition:fill var(--facet-ease); }
  .cube:focus-visible{ outline:2px dashed #bbb; outline-offset:4px; border-radius:6px; }

  .brighten .facet-dark{ fill:#8c8c8c !important; }
  .brighten .facet-top { fill:#ffffff !important; }
  .brighten .facet-side{ fill:#f5f5f5 !important; }

  @media (prefers-reduced-motion:reduce){
    .cube *{ transition:none !important; }
  }

  /* Small devices */
  @media (max-width:320px){
    :root{ --svg-w:72vw; }
  }
  @media (max-width:420px){
    :root{
      --grid-gap:22px;
      --iso-cell: calc(var(--grid-gap) * 4);
    }
  }
</style>
</head>
<body>

  <!-- highlight canvas (under content) -->
  <canvas id="isoCanvas" class="iso-canvas" aria-hidden="true"></canvas>

  <div class="wrap">
    <!-- SVG stays unchanged -->
    <svg width="370" height="289" viewBox="0 0 370 289" fill="none" xmlns="http://www.w3.org/2000/svg" aria-labelledby="title desc" role="img">
      <title id="title">Isometric cubes logo</title>
      <desc id="desc">Three cubes at different depths. Tap a cube to hear a tone. Focus or hover to highlight.</desc>

      <!-- REAR CUBE — farthest one -->
      <g id="rearCube" class="cube" tabindex="0" role="button" aria-label="Rear cube, note Do (C4)"
         filter="url(#filter0_f_2651_53188)"
         style="transform-box:fill-box; transform-origin:center; transform:translate(1.86px,-2.59px) scale(0.66);">
        <rect x="100" y="36" width="100" height="108" fill="transparent" />
        <path class="facet-dark" d="M186.873 109.92L148.438 131.822V87.5893L186.873 65.9023V109.92Z" fill="#767676"/>
        <path class="facet-top"  d="M148.221 44L110 66.1164L148.435 88.0182L186.871 65.9017L148.221 44Z" fill="white"/>
        <path class="facet-side" d="M110.215 109.921L148.435 131.822V88.0189L110 66.1172L110.215 109.921Z" fill="#EDEDED"/>
      </g>

      <!-- MIDDLE CUBE — mid distance -->
      <g id="middleCube" class="cube" tabindex="0" role="button" aria-label="Middle cube, note Re (D4)"
         filter="url(#filter1_f_2651_53188)"
         style="transform-box:fill-box; transform-origin:center; transform:scale(0.84);">
        <rect x="140" y="18" width="96" height="100" fill="transparent" />
        <path class="facet-dark" d="M224.873 87.9205L186.438 109.822V65.5893L224.873 43.9023V87.9205Z" fill="#767676"/>
        <path class="facet-top"  d="M186.221 22L148 44.1164L186.435 66.0182L224.871 43.9017L186.221 22Z" fill="white"/>
        <path class="facet-side" d="M148.215 87.9206L186.435 109.822V66.0189L148 44.1172L148.215 87.9206Z" fill="#EDEDED"/>
      </g>

      <!-- FRONT CUBE — nearest, sharp -->
      <g id="frontCube" class="cube" tabindex="0" role="button" aria-label="Front cube, note Mi (E4)">
        <rect x="182" y="0" width="86" height="96" fill="transparent" />
        <path class="facet-dark" d="M262.74 65.9205L224.305 87.8222V43.5893L262.74 21.9023V65.9205Z" fill="#767676"/>
        <path class="facet-top"  d="M224.088 0L185.867 22.1164L224.303 44.0182L262.738 21.9017L224.088 0Z" fill="white"/>
        <path class="facet-side" d="M186.082 65.9206L224.303 87.8223V44.0189L185.867 22.1172L186.082 65.9206Z" fill="#EDEDED"/>
      </g>

      <!-- baseline lettering + soft blur -->
      <path d="M24.282 264.04V232.296H29.498V264.04H24.282ZM15.258 265V260.36H38.522V265H15.258ZM15.258 236.936V232.296H27.162V236.936H15.258ZM26.874 226.12C25.9567 226.12 25.178 225.8 24.538 225.16C23.898 224.52 23.578 223.731 23.578 222.792C23.578 221.832 23.898 221.032 24.538 220.392C25.178 219.731 25.9567 219.4 26.874 219.4C27.8553 219.4 28.6553 219.731 29.274 220.392C29.8927 221.032 30.202 221.832 30.202 222.792C30.202 223.731 29.8927 224.52 29.274 225.16C28.6553 225.8 27.8553 226.12 26.874 226.12ZM57.5115 265V232.296H62.7275V238.408L61.8955 237.288C62.4075 236.093 63.1328 235.069 64.0715 234.216C65.0102 233.363 66.1195 232.701 67.3995 232.232C68.6795 231.763 70.0982 231.528 71.6555 231.528C74.2582 231.528 76.4555 232.029 78.2475 233.032C80.0608 234.035 81.4262 235.635 82.3435 237.832C83.2822 240.008 83.7515 242.867 83.7515 246.408V265H78.5675V245.416C78.5675 242.067 77.8208 239.709 76.3275 238.344C74.8555 236.979 73.0315 236.296 70.8555 236.296C69.2768 236.296 67.8688 236.573 66.6315 237.128C65.4155 237.683 64.4555 238.611 63.7515 239.912C63.0688 241.213 62.7275 243.005 62.7275 245.288V265H57.5115ZM118.133 265.768C115.189 265.768 113.077 265.032 111.797 263.56C110.538 262.088 109.909 260.125 109.909 257.672V236.936H102.389V232.296H109.909V221.352L115.125 218.792V232.296H126.101V236.936H115.125V255.88C115.125 256.883 115.232 257.768 115.445 258.536C115.68 259.283 116.138 259.88 116.821 260.328C117.504 260.755 118.517 260.968 119.861 260.968C121.418 260.968 122.656 260.765 123.573 260.36C124.49 259.955 125.28 259.549 125.941 259.144L125.333 264.296C124.48 264.744 123.509 265.096 122.421 265.352C121.354 265.629 119.925 265.768 118.133 265.768ZM159.715 265.768C156.664 265.768 153.997 265.096 151.715 263.752C149.432 262.408 147.651 260.467 146.371 257.928C145.112 255.368 144.483 252.285 144.483 248.68C144.483 245.117 145.112 242.056 146.371 239.496C147.651 236.936 149.432 234.973 151.715 233.608C153.997 232.221 156.664 231.528 159.715 231.528C162.787 231.528 165.464 232.2 167.747 233.544C170.051 234.888 171.832 236.84 173.091 239.4C174.349 241.96 174.979 245.032 174.979 248.616C174.979 252.179 174.349 255.24 173.091 257.8C171.832 260.36 170.051 262.333 167.747 263.72C165.464 265.085 162.787 265.768 159.715 265.768ZM159.715 260.968C162.872 260.968 165.304 259.869 167.011 257.672C168.739 255.475 169.603 252.456 169.603 248.616C169.603 244.797 168.771 241.789 167.107 239.592C165.443 237.395 162.979 236.296 159.715 236.296C156.493 236.296 154.04 237.373 152.355 239.528C150.669 241.661 149.827 244.712 149.827 248.68C149.827 252.477 150.669 255.475 152.355 257.672C154.04 259.869 156.493 260.968 159.715 260.968ZM202.224 265L189.744 232.296H195.152L203.344 254.344C203.515 254.835 203.696 255.347 203.888 255.88C204.08 256.413 204.261 257 204.432 257.64C204.603 257 204.784 256.413 204.976 255.88C205.168 255.347 205.36 254.835 205.552 254.344L213.436 232.296H218.864L206.384 265H202.224ZM247.07 264.04V232.296H252.286V264.04H247.07ZM238.046 265V260.36H261.31V265H238.046ZM238.046 236.936V232.296H249.95V236.936H238.046ZM249.662 226.12C248.744 226.12 247.966 225.8 247.326 225.16C246.686 224.52 246.366 223.731 246.366 222.792C246.366 221.832 246.686 221.032 247.326 220.392C247.966 219.731 248.744 219.4 249.662 219.4C250.643 219.4 251.443 219.731 252.062 220.392C252.68 221.032 252.99 221.832 252.99 222.792C252.99 223.731 252.68 224.52 252.062 225.16C251.443 225.8 250.643 226.12 249.662 226.12ZM294.059 265.768C290.923 265.768 288.235 265 285.995 263.464C283.776 261.928 282.08 259.859 280.907 257.256C279.734 254.653 279.147 251.773 279.147 248.616C279.147 245.011 279.766 241.939 281.003 239.4C282.24 236.84 283.968 234.888 286.187 233.544C288.427 232.2 291.051 231.528 294.059 231.528C296.512 231.528 298.763 232.083 300.811 233.192C302.88 234.301 304.534 236.019 305.771 238.344C307.008 240.648 307.627 243.613 307.627 247.24C307.627 247.645 307.616 248.147 307.595 248.744C307.595 249.32 307.552 249.981 307.467 250.728H283.243V246.12H302.411C302.368 243.517 301.899 241.501 301.003 240.072C300.128 238.621 299.051 237.608 297.771 237.032C296.491 236.456 295.254 236.168 294.059 236.168C290.731 236.168 288.288 237.224 286.731 239.336C285.174 241.427 284.395 244.232 284.395 247.752C284.395 251.848 285.259 255.08 286.987 257.448C288.715 259.816 291.126 261 294.219 261C295.52 261 296.811 260.797 298.091 260.392C299.371 259.965 300.63 259.261 301.867 258.28L304.811 261.704C303.446 262.877 301.835 263.848 299.979 264.616C298.144 265.384 296.171 265.768 294.059 265.768ZM328.056 265L319.928 232.296H325.048L330.072 254.056C330.158 254.419 330.243 254.835 330.328 255.304C330.414 255.752 330.488 256.211 330.552 256.68C330.659 256.104 330.744 255.613 330.808 255.208C330.894 254.781 330.99 254.344 331.096 253.896L335.864 232.296H340.056L344.856 253.96C344.963 254.387 345.07 254.856 345.176 255.368C345.283 255.859 345.379 256.381 345.464 256.936C345.528 256.403 345.603 255.901 345.688 255.432C345.795 254.941 345.902 254.451 346.008 253.96L350.84 232.296H355.992L347.832 265H343.288L338.552 244.2C338.467 243.773 338.36 243.261 338.232 242.664C338.126 242.067 338.019 241.48 337.912 240.904C337.806 241.523 337.688 242.12 337.56 242.696C337.454 243.251 337.358 243.72 337.272 244.104L332.664 265H328.056Z" fill="url(#paint0_linear_2651_53188)"/>
      <g filter="url(#filter2_f_2651_53188)">
        <path d="M18.758 264.36V232.296H24.678V264.36H18.758ZM9.73401 265V259.752H33.702V265H9.73401ZM9.73401 237.544V232.296H22.278V237.544H9.73401ZM21.702 226.664C20.678 226.664 19.814 226.312 19.11 225.608C18.406 224.883 18.054 224.008 18.054 222.984C18.054 221.939 18.406 221.064 19.11 220.36C19.814 219.635 20.678 219.272 21.702 219.272C22.7687 219.272 23.6433 219.635 24.326 220.36C25.03 221.064 25.382 221.939 25.382 222.984C25.382 224.008 25.03 224.883 24.326 225.608C23.6433 226.312 22.7687 226.664 21.702 226.664ZM53.3955 265V232.296H59.3155V238.952L58.4515 237.48C58.7928 236.371 59.4222 235.368 60.3395 234.472C61.2782 233.576 62.4302 232.861 63.7955 232.328C65.1822 231.795 66.7075 231.528 68.3715 231.528C70.8462 231.528 72.9902 232.008 74.8035 232.968C76.6168 233.907 78.0142 235.443 78.9955 237.576C79.9768 239.688 80.4675 242.483 80.4675 245.96V265H74.5475V245.8C74.5475 242.557 73.8328 240.285 72.4035 238.984C70.9742 237.683 69.2248 237.032 67.1555 237.032C65.6835 237.032 64.3502 237.299 63.1555 237.832C61.9822 238.344 61.0435 239.229 60.3395 240.488C59.6568 241.747 59.3155 243.475 59.3155 245.672V265H53.3955ZM115.713 265.768C112.62 265.768 110.401 265.021 109.057 263.528C107.713 262.013 107.041 259.976 107.041 257.416V237.544H99.745V232.296H107.041V221.672L112.961 218.792V232.296H124.001V237.544H112.961V255.752C112.961 256.669 113.089 257.48 113.345 258.184C113.601 258.888 114.07 259.432 114.753 259.816C115.436 260.2 116.406 260.392 117.665 260.392C119.073 260.392 120.225 260.211 121.121 259.848C122.038 259.485 122.86 259.091 123.585 258.664L122.881 264.296C122.006 264.744 121.014 265.096 119.905 265.352C118.817 265.629 117.42 265.768 115.713 265.768ZM158.575 265.768C155.46 265.768 152.751 265.085 150.447 263.72C148.143 262.355 146.351 260.403 145.071 257.864C143.812 255.304 143.183 252.243 143.183 248.68C143.183 245.139 143.812 242.088 145.071 239.528C146.351 236.968 148.143 234.995 150.447 233.608C152.751 232.221 155.46 231.528 158.575 231.528C161.711 231.528 164.431 232.211 166.735 233.576C169.039 234.941 170.82 236.904 172.079 239.464C173.337 242.024 173.967 245.085 173.967 248.648C173.967 252.189 173.337 255.24 172.079 257.8C170.82 260.36 169.039 262.333 166.735 263.72C164.431 265.085 161.711 265.768 158.575 265.768ZM158.575 260.232C161.583 260.232 163.887 259.197 165.487 257.128C167.108 255.037 167.919 252.211 167.919 248.648C167.919 245.085 167.129 242.259 165.551 240.168C163.993 238.077 161.668 237.032 158.575 237.032C155.545 237.032 153.231 238.056 151.631 240.104C150.031 242.152 149.231 245.011 149.231 248.68C149.231 252.221 150.031 255.037 151.631 257.128C153.231 259.197 155.545 260.232 158.575 260.232ZM202.224 265L189.744 232.296H195.152L203.344 253.896C203.676 254.387 203.857 254.909 204.028 255.464C204.199 255.997 204.369 256.605 204.54 257.288C204.711 256.605 204.881 255.997 205.052 255.464C205.244 254.909 205.425 254.387 205.596 253.896L213.436 232.296H219.58L207.004 265H202.224ZM247.07 264.04V232.296H252.286V264.04H247.07ZM238.046 265V260.36H261.31V265H238.046ZM238.046 236.936V232.296H249.95V236.936H238.046ZM249.662 226.12C248.744 226.12 247.966 225.8 247.326 225.16C246.686 224.52 246.366 223.731 246.366 222.792C246.366 221.832 246.686 221.032 247.326 220.392C247.966 219.731 248.744 219.4 249.662 219.4C250.643 219.4 251.443 219.731 252.062 220.392C252.68 221.032 252.99 221.832 252.99 222.792C252.99 223.731 252.68 224.52 252.062 225.16C251.443 225.8 250.643 226.12 249.662 226.12ZM294.059 265.768C290.923 265.768 288.235 265 285.995 263.464C283.776 261.928 282.08 259.859 280.907 257.256C279.734 254.653 279.147 251.773 279.147 248.616C279.147 245.011 279.766 241.939 281.003 239.4C282.24 236.84 283.968 234.888 286.187 233.544C288.427 232.2 291.051 231.528 294.059 231.528C296.512 231.528 298.763 232.083 300.811 233.192C302.88 234.301 304.534 236.019 305.771 238.344C307.008 240.648 307.627 243.613 307.627 247.24C307.627 247.645 307.616 248.147 307.595 248.744C307.595 249.32 307.552 249.981 307.467 250.728H283.243V246.12H302.411C302.368 243.517 301.899 241.501 301.003 240.072C300.128 238.621 299.051 237.608 297.771 237.032C296.491 236.456 295.254 236.168 294.059 236.168C290.731 236.168 288.288 237.224 286.731 239.336C285.174 241.427 284.395 244.232 284.395 247.752C284.395 251.848 285.259 255.08 286.987 257.448C288.715 259.816 291.126 261 294.219 261C295.52 261 296.811 260.797 298.091 260.392C299.371 259.965 300.63 259.261 301.867 258.28L304.811 261.704C303.446 262.877 301.835 263.848 299.979 264.616C298.144 265.384 296.171 265.768 294.059 265.768ZM328.056 265L319.928 232.296H325.048L330.072 254.056C330.158 254.419 330.243 254.835 330.328 255.304C330.414 255.752 330.488 256.211 330.552 256.68C330.659 256.104 330.744 255.613 330.808 255.208C330.894 254.781 330.99 254.344 331.096 253.896L335.864 232.296H340.056L344.856 253.96C344.963 254.387 345.07 254.856 345.176 255.368C345.283 255.859 345.379 256.381 345.464 256.936C345.528 256.403 345.603 255.901 345.688 255.432C345.795 254.941 345.902 254.451 346.008 253.96L350.84 232.296H355.992L347.832 265H343.288L338.552 244.2C338.467 243.773 338.36 243.261 338.232 242.664C338.126 242.067 338.019 241.48 337.912 240.904C337.806 241.523 337.688 242.12 337.56 242.696C337.454 243.251 337.358 243.72 337.272 244.104L332.664 265H328.056Z" fill="url(#paint1_linear_2651_53188)"/>
      </g>

      <defs>
        <filter id="filter0_f_2651_53188" x="104" y="36" width="92.875" height="103.824" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feFlood flood-opacity="0" result="BackgroundImageFix"/>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
          <feGaussianBlur stdDeviation="6" result="effect1_foregroundBlur_2651_53188"/>
        </filter>
        <filter id="filter1_f_2651_53188" x="144" y="18" width="84.875" height="95.8242" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feFlood flood-opacity="0" result="BackgroundImageFix"/>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
          <feGaussianBlur stdDeviation="2" result="effect1_foregroundBlur_2651_53188"/>
        </filter>
        <filter id="filter2_f_2651_53188" x="0.734375" y="209.793" width="368.461" height="64.9766" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feFlood flood-opacity="0" result="BackgroundImageFix"/>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
          <feGaussianBlur stdDeviation="4.5" result="effect1_foregroundBlur_2651_53188"/>
        </filter>
        <linearGradient id="paint0_linear_2651_53188" x1="6" y1="248.5" x2="358" y2="248.5" gradientUnits="userSpaceOnUse">
          <stop offset="0.293269" stop-color="#767676" stop-opacity="0"/>
          <stop offset="1" stop-color="#767676"/>
        </linearGradient>
        <linearGradient id="paint1_linear_2651_53188" x1="1" y1="248.5" x2="362" y2="248.5" gradientUnits="userSpaceOnUse">
          <stop stop-color="#767676"/>
          <stop offset="1" stop-color="#767676" stop-opacity="0.1"/>
        </linearGradient>
      </defs>
    </svg>
  </div>

<script>
  // --- Lazy Audio Context (avoids autoplay issues) ---
  let ctxAudio = null;
  function ensureAudio(){
    if(!ctxAudio){
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      ctxAudio = new AudioCtx();
    }
    if(ctxAudio.state === 'suspended') ctxAudio.resume();
  }
  function ping(freq = 440, dur = 0.22, vol = 0.12){
    ensureAudio();
    const t0 = ctxAudio.currentTime;
    const osc = ctxAudio.createOscillator();
    const gain = ctxAudio.createGain();
    osc.type = 'sine';
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(0, t0);
    gain.gain.linearRampToValueAtTime(vol, t0 + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
    osc.connect(gain).connect(ctxAudio.destination);
    osc.start(t0);
    osc.stop(t0 + dur + 0.02);
  }
  function buzz(ms=8){ if(navigator.vibrate) navigator.vibrate(ms); }

  const cubes = [
    { el: document.getElementById('rearCube'),   freq: 261.63 }, // C4
    { el: document.getElementById('middleCube'), freq: 293.66 }, // D4
    { el: document.getElementById('frontCube'),  freq: 329.63 }, // E4
  ];
  function attachCubeHandlers(el, freq){
    el.addEventListener('mouseenter', () => el.classList.add('brighten'));
    el.addEventListener('mouseleave', () => el.classList.remove('brighten'));
    el.addEventListener('focus',      () => el.classList.add('brighten'));
    el.addEventListener('blur',       () => el.classList.remove('brighten'));
    el.addEventListener('pointerdown', (e) => {
      el.setPointerCapture?.(e.pointerId);
      el.classList.add('brighten');
      ping(freq); buzz(); e.preventDefault();
    }, { passive:false });
    el.addEventListener('pointerup',   (e) => { el.releasePointerCapture?.(e.pointerId); el.classList.remove('brighten'); });
    el.addEventListener('pointercancel', () => el.classList.remove('brighten'));
    el.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' '){ ping(freq); buzz(); e.preventDefault(); }
    });
  }
  cubes.forEach(({el, freq}) => attachCubeHandlers(el, freq));

  // --- Iso highlight canvas with distance-based blur (keeps your sizing) ---
  (function isoHighlights(){
    const canvas = document.getElementById('isoCanvas');
    const ctx = canvas.getContext('2d');

    // Helpers to read CSS custom properties each resize (respect media queries)
    function css() { return getComputedStyle(document.documentElement); }
    function num(val, fb){ const n = parseFloat(val); return Number.isFinite(n) ? n : fb; }
    function toPx(len){ const m = String(len).trim().match(/^([0-9.]+)\s*px$/i); return m ? parseFloat(m[1]) : 0; }

    // Vars (initialized + refreshed on resize)
    let GRID, CELL, FILL_RGB, FILL_ALPHA, STROKE_ALPHA, FADE_MS, BLUR_MIN, BLUR_MAX, BLUR_CURVE;

    // Basis vectors for 30° isometric
    const cos30 = Math.sqrt(3) / 2; // ~0.8660
    const sin30 = 0.5;
    let v1 = {x:0,y:0}, v2 = {x:0,y:0};
    let det, inv; // inverse transform

    // Viewport center/radius for blur normalization
    let view = {w:innerWidth, h:innerHeight, cx:innerWidth/2, cy:innerHeight/2, R:Math.hypot(innerWidth, innerHeight)/2};

    function readVars(){
      const s = css();
      GRID         = num(s.getPropertyValue('--grid-gap'), 4);
      CELL         = num(s.getPropertyValue('--iso-cell'), GRID*4);
      FILL_RGB     = (s.getPropertyValue('--iso-highlight-fill').trim() || '255 255 255');
      FILL_ALPHA   = num(s.getPropertyValue('--iso-highlight-alpha'), .25);
      STROKE_ALPHA = num(s.getPropertyValue('--iso-stroke-alpha'), .55);
      FADE_MS      = num(s.getPropertyValue('--iso-fade-ms'), 900);
      BLUR_MIN     = s.getPropertyValue('--iso-blur-min').trim() || '0px';
      BLUR_MAX     = s.getPropertyValue('--iso-blur-max').trim() || '12px';
      BLUR_CURVE   = num(s.getPropertyValue('--iso-blur-curve'), 1.35);

      v1 = { x:  cos30 * CELL, y: sin30 * CELL };   // 30°
      v2 = { x: -cos30 * CELL, y: sin30 * CELL };   // 150°
      det = v1.x * v2.y - v2.x * v1.y;
      inv = { a:  v2.y / det,  b: -v2.x / det, c: -v1.y / det, d:  v1.x / det };
    }

    function resize(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width  = Math.floor(innerWidth * dpr);
      canvas.height = Math.floor(innerHeight * dpr);
      canvas.style.width  = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      readVars();
      view = { w: innerWidth, h: innerHeight, cx: innerWidth/2, cy: innerHeight/2, R: Math.hypot(innerWidth, innerHeight)/2 };
    }
    addEventListener('resize', resize, { passive:true });
    resize();

    // Pulses storage
    const pulses = []; // {I,J,born}

    // Map (x,y) to nearest lattice cell indices
    function snapToLattice(x,y){
      const i = inv.a * x + inv.b * y;
      const j = inv.c * x + inv.d * y;
      return { I: Math.round(i), J: Math.round(j) };
    }

    // Build rhombus polygon (and center)
    function cellPolyAndCenter(I,J){
      const ox = I * v1.x + J * v2.x;
      const oy = I * v1.y + J * v2.y;
      const p0 = {x: ox,                   y: oy};
      const p1 = {x: ox + v1.x,            y: oy + v1.y};
      const p2 = {x: ox + v1.x + v2.x,     y: oy + v1.y + v2.y};
      const p3 = {x: ox + v2.x,            y: oy + v2.y};
      const cx = (p0.x + p1.x + p2.x + p3.x) / 4;
      const cy = (p0.y + p1.y + p2.y + p3.y) / 4;
      return { pts:[p0,p1,p2,p3], cx, cy };
    }

    function drawPoly(points){
      ctx.beginPath();
      ctx.moveTo(points[0].x, points[0].y);
      for(let k=1;k<points.length;k++) ctx.lineTo(points[k].x, points[k].y);
      ctx.closePath();
    }

    // Spawn pulses on cursor travel between cells
    let lastKey = '';
    addEventListener('pointermove', (e)=>{
      const {I,J} = snapToLattice(e.clientX, e.clientY);
      const key = I + ',' + J;
      if(key !== lastKey){
        lastKey = key;
        pulses.push({ I, J, born: performance.now() });
        if(!animating) start();
      }
    }, { passive:true });
    addEventListener('pointerleave', ()=>{ lastKey = ''; });

    // Also pulse on cube keyboard “click”
    ['rearCube','middleCube','frontCube'].forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener('keydown', (e)=>{
        if(e.key==='Enter' || e.key===' '){
          const r = el.getBoundingClientRect();
          const cx = r.left + r.width/2;
          const cy = r.top  + r.height/2;
          const {I,J} = snapToLattice(cx, cy);
          pulses.push({ I, J, born: performance.now() });
          if(!animating) start();
        }
      });
    });

    // Render loop
    let animating = false;
    function start(){ animating = true; requestAnimationFrame(tick); }
    function stop(){ animating = false; }
    const easeOutQuad = u => 1 - (1-u)*(1-u);
    const clamp01 = x => x<0?0:x>1?1:x;

    function tick(now){
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let alive = 0;
      for(let i=0;i<pulses.length;i++){
        const p = pulses[i];
        const age = now - p.born;
        if(age >= FADE_MS) continue;
        alive++;

        const u = age / FADE_MS;          // 0 → 1
        const invAge = 1 - u;
        const fillA = easeOutQuad(invAge) * FILL_ALPHA;
        const strokeA = invAge * STROKE_ALPHA;

        const { pts, cx, cy } = cellPolyAndCenter(p.I, p.J);

        // Distance-based blur: farther from viewport center → more blur
        const dist = Math.hypot(cx - view.cx, cy - view.cy);
        const dNorm = clamp01(dist / view.R);
        const t = Math.pow(dNorm, BLUR_CURVE > 0 ? BLUR_CURVE : 1);
        const blurPx = toPx(BLUR_MIN) + (toPx(BLUR_MAX) - toPx(BLUR_MIN)) * t;

        ctx.filter = `blur(${blurPx}px)`;

        // fill
        ctx.fillStyle = `rgb(${FILL_RGB} / ${fillA})`;
        drawPoly(pts);
        ctx.fill();

        // stroke
        ctx.lineWidth = 1;
        ctx.strokeStyle = `rgb(${FILL_RGB} / ${strokeA})`;
        ctx.stroke();

        ctx.filter = 'none';
      }

      // prune finished
      if(alive !== pulses.length){
        const cutoff = now - FADE_MS;
        for(let i=pulses.length-1;i>=0;i--) if(pulses[i].born <= cutoff) pulses.splice(i,1);
      }

      if(alive > 0){ requestAnimationFrame(tick); } else { stop(); }
    }
  })();
</script>
</body>
</html>
