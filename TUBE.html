<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=no,viewport-fit=cover" />
  <title>YouTube Reimagined: Kanban Browser</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #050505;
      --card-bg: #111111;
      --ink: #ffffff;
      --ink-dim: #888888;
      --accent: #FF0000; /* YouTube Red */
     
      --neon-green: #22c55e;
      --neon-orange: #f97316;
      --neon-red: #ef4444;
      --neon-blue: #3b82f6;
      --youtube-red: #FF0000;
     
      --glass-bg: rgba(20, 20, 20, 0.85);
      --glass-border: rgba(255, 255, 255, 0.1);
      --glass-blur: 16px;
     
      --nav-height: 80px;
      --header-height: 100px;
      --font-mono: 'JetBrains Mono', monospace;
      --font-sans: 'Inter', sans-serif;
     
      /* Cinematic effects */
      --edge-blur-amount: 4px;
      --vignette-strength: 0.6;
      --vignette-size: 20%;
    }

    /* Light Theme - Work Friendly */
    [data-theme="light"] {
      --bg-color: #ffffff;
      --card-bg: #ffffff;
      --ink: #000000;
      --ink-dim: #666666;
      --accent: #FF0000;
      --glass-bg: rgba(0, 0, 0, 0.03);
      --glass-border: rgba(0, 0, 0, 0.15);
      --neon-green: #006400;
      --neon-orange: #ff6600;
      --neon-red: #cc0000;
      --neon-blue: #0066cc;
      --vignette-strength: 0;
      --edge-blur-amount: 0px;
    }

    /* Rose Theme - Creator Premium */
    [data-theme="rose"] {
      --bg-color: #0a0a0a;
      --card-bg: #1a1a1a;
      --ink: #ffffff;
      --ink-dim: #cccccc;
      --accent: #ff8da1;
      --rose-primary: #ff8da1;
      --rose-secondary: #ff6b8b;
      --retro-blue: #00d4ff;
      --retro-yellow: #ffeb3b;
      --retro-purple: #e91e63;
      --glass-bg: rgba(255, 141, 161, 0.05);
      --glass-border: rgba(255, 141, 161, 0.2);
    }

    /* Theater Theme - Maximum Focus */
    [data-theme="theater"] {
      --bg-color: #000000;
      --card-bg: #0a0a0a;
      --ink: #e0e0e0;
      --ink-dim: #666666;
      --accent: #ff0000;
      --glass-bg: rgba(0, 0, 0, 0.9);
      --glass-border: rgba(255, 0, 0, 0.2);
      --vignette-strength: 0.8;
      --neon-green: #00ff00;
      --neon-orange: #ff8800;
      --neon-red: #ff0000;
      --neon-blue: #0088ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-color);
      color: var(--ink);
      overflow: hidden;
      position: relative;
      min-height: 100vh;
    }

    /* --- Cinematic Visual Effects --- */
    body { position: relative; }
    
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      box-shadow: inset 0 0 60px rgba(0,0,0,0.5);
      backdrop-filter: blur(var(--edge-blur-amount));
      -webkit-backdrop-filter: blur(var(--edge-blur-amount));
      mask-image: linear-gradient(to bottom, black 0%, transparent 10%, transparent 90%, black 100%),
                  linear-gradient(to right, black 0%, transparent 10%, transparent 90%, black 100%);
      mask-composite: source-in;
      pointer-events: none;
      z-index: 10;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(
        circle at center,
        transparent 40%,
        rgba(0, 0, 0, var(--vignette-strength)) 100%
      );
      pointer-events: none;
      z-index: 200;
    }
    
    /* Theme specific effects */
    [data-theme="nerd"] body::before,
    [data-theme="nerd"] body::after {
      display: none;
    }
    
    [data-theme="rose"] body::after {
        background: radial-gradient(
        circle at center,
        transparent 40%,
        rgba(50, 0, 20, var(--vignette-strength)) 100%
      );
    }

    [data-theme="light"] body::after {
        background: radial-gradient(
        circle at center,
        transparent 40%,
        rgba(0, 0, 0, 0.3) 100%
      );
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--ink-dim); }

    /* Typography & Utilities */
    .text-green { color: var(--neon-green); }
    .text-orange { color: var(--neon-orange); }
    .text-red { color: var(--neon-red); }
    .text-blue { color: var(--neon-blue); }
    .text-rose { color: var(--rose-primary); }
   
    /* Rose theme specific utilities */
    [data-theme="rose"] .text-green { color: var(--retro-blue); }
    [data-theme="rose"] .text-orange { color: var(--retro-yellow); }
    [data-theme="rose"] .text-red { color: var(--rose-secondary); }
    [data-theme="rose"] .text-blue { color: var(--retro-purple); }

    /* --- Layout Structure --- */
    .app-header {
      position: fixed; top: 0; left: 0; right: 0; height: var(--header-height);
      display: flex; flex-direction: column; justify-content: center;
      padding: 10px 0; z-index: 9999;
      background: linear-gradient(to bottom, var(--bg-color) 40%, transparent);
      pointer-events: none;
    }
    .header-top {
        display: flex; justify-content: space-between; align-items: center;
        padding: 0 20px; width: 100%; pointer-events: auto;
    }
   
    /* Logo Styling */
    .logo {
        display: flex; align-items: center; height: 32px; z-index: 1000;
    }
    .logo-text {
        font-size: 24px;
        font-weight: 800;
        color: var(--ink);
        text-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        transition: filter 0.3s ease, transform 0.3s ease;
    }
    .logo:hover .logo-text {
        transform: scale(1.05);
        filter: drop-shadow(0 0 8px var(--accent));
    }
    .header-buttons { display: flex; align-items: center; gap: 8px; margin-left: auto; }
    .theme-btn {
        background: transparent; border: none; color: var(--ink-dim);
        cursor: pointer; padding: 8px; border-radius: 50%; display: flex; align-items: center;
        transition: all 0.3s ease;
    }
    .theme-btn:hover { color: var(--ink); background: var(--glass-border); transform: scale(1.1); }
    .theme-btn:active { background: var(--glass-border); color: var(--ink); transform: scale(0.95); }
   
    /* --- Category Filter Bar --- */
    .category-bar {
      display: flex; gap: 8px; overflow-x: auto; padding: 10px 20px;
      pointer-events: auto; scrollbar-width: none;
      justify-content: flex-start;
    }
    .category-bar::-webkit-scrollbar { display: none; }
   
    .pill {
      padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;
      background: var(--glass-bg); border: 1px solid var(--glass-border);
      color: var(--ink-dim); white-space: nowrap; cursor: pointer; transition: all 0.2s;
      flex-shrink: 0;
    }
    .pill.active { background: var(--ink); color: var(--bg-color); border-color: var(--ink); }
    .pill.add-btn { border-style: dashed; }
   
    [data-theme="rose"] .pill.active {
      background: linear-gradient(135deg, var(--rose-primary), var(--rose-secondary));
      color: white;
      border-color: var(--rose-primary);
      box-shadow: 0 0 12px rgba(255, 141, 161, 0.5);
    }

    /* --- Kanban Column System --- */
    .kanban-container {
      position: absolute;
      inset: 0;
      top: var(--header-height);
      bottom: var(--nav-height);
      display: flex;
      overflow: hidden;
      z-index: 1;
    }

    .kanban-column {
      display: flex;
      flex-direction: column;
      min-width: 300px;
      background: rgba(255, 255, 255, 0.01);
      border-right: 1px solid var(--glass-border);
      transition: all 0.3s ease;
      position: relative;
    }

    .kanban-column:first-child {
      min-width: 400px;
      flex: 1;
    }

    .kanban-column:last-child {
      border-right: none;
    }

    .column-header {
      padding: 16px;
      background: var(--glass-bg);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .column-title {
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--ink-dim);
    }

    .column-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .column-resize {
      position: absolute;
      right: -3px;
      top: 0;
      bottom: 0;
      width: 6px;
      cursor: col-resize;
      background: transparent;
      transition: background 0.2s;
    }

    .column-resize:hover {
      background: var(--accent);
    }

    /* --- View Containers --- */
    .view-container {
      position: absolute; inset: 0;
      top: var(--header-height); bottom: var(--nav-height);
      overflow: hidden; opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .view-container.active { opacity: 1; pointer-events: auto;  z-index: 1000;}
   
    /* --- Grid View --- */
    #gridContainer { overflow-y: auto; padding: 10px 16px 120px 16px; }
    .grid-wrapper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding-bottom: 40px;
    }
    @media(min-width: 600px) { .grid-wrapper { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); } }
    
    /* --- Video Card --- */
    .video-card {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, background 0.2s, box-shadow 0.3s ease;
      cursor: pointer;
      z-index: 100;
    }
    .video-card:hover {
      transform: scale(1.02);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }
    [data-theme="rose"] .video-card:hover {
      box-shadow: 0 8px 24px rgba(255, 141, 161, 0.3);
    }
    .video-card:active { transform: scale(0.98); background: var(--glass-border); }

    .video-thumbnail {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      background: #1a1a1a;
      overflow: hidden;
    }

    .video-thumbnail img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .video-card:hover .video-thumbnail img {
      transform: scale(1.05);
    }

    .video-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-family: var(--font-mono);
      font-weight: 600;
    }

    .video-status {
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-unwatched {
      background: var(--neon-blue);
      color: white;
    }

    .status-in-progress {
      background: var(--neon-orange);
      color: white;
    }

    .status-completed {
      background: var(--neon-green);
      color: white;
    }

    .status-saved {
      background: var(--accent);
      color: white;
    }

    .status-archived {
      background: var(--ink-dim);
      color: white;
    }

    .video-info {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .video-title {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .video-channel {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--ink-dim);
    }

    .channel-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--glass-border);
    }

    .video-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: var(--ink-dim);
      border-top: 1px solid var(--glass-border);
      padding-top: 8px;
    }

    .video-views {
      font-family: var(--font-mono);
    }

    .video-actions {
      display: flex;
      gap: 8px;
    }
    .action-icon {
      width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
      border-radius: 6px; background: rgba(255,255,255,0.05); cursor: pointer;
      color: var(--ink-dim); transition: 0.2s;
      font-size: 12px; font-weight: 700;
    }
    .action-icon:hover { background: var(--accent); color: #fff; }
   
    [data-theme="rose"] .action-icon:hover {
      background: linear-gradient(135deg, var(--rose-primary), var(--rose-secondary));
      color: white;
    }

    /* --- Scatter View --- */
    .scatter-canvas {
      position: absolute; inset: 0; overflow: hidden; 
      transform-origin: 0 0; transition: transform 0.3s ease;
    }
    .scatter-card {
      position: absolute; background: var(--card-bg); border: 1px solid var(--glass-border);
      border-radius: 12px; padding: 12px; cursor: move; user-select: none;
      transition: transform 0.2s, box-shadow 0.3s; z-index: 100;
      width: 200px;
    }
    .scatter-card:hover { transform: scale(1.02); box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 1000; }
    .scatter-card.is-dragging { transform: scale(1.05); box-shadow: 0 12px 32px rgba(0,0,0,0.4); z-index: 2000; opacity: 0.9; }
    .scatter-thumbnail {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      background: #1a1a1a;
      margin-bottom: 8px;
    }

    /* --- List View --- */
    .list-table {
      width: 100%; border-collapse: collapse; font-size: 14px;
    }
    .list-table th { 
      text-align: left; padding: 12px; background: var(--glass-bg); 
      font-weight: 600; text-transform: uppercase; font-size: 12px;
      border-bottom: 2px solid var(--glass-border);
    }
    .list-table td { padding: 12px; border-bottom: 1px solid var(--glass-border); }
    .list-table tr:hover { background: var(--glass-bg); }
    .list-thumbnail { width: 80px; height: 45px; border-radius: 4px; object-fit: cover; }

    /* --- Bottom Navigation --- */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0; height: var(--nav-height);
      background: linear-gradient(to top, var(--bg-color) 40%, transparent);
      display: flex; justify-content: center; align-items: center; gap: 16px;
      padding: 0 20px; z-index: 9999; pointer-events: none;
    }
    .bottom-nav-inner {
      display: flex; gap: 12px; align-items: center; pointer-events: auto;
      background: var(--glass-bg); border: 1px solid var(--glass-border);
      border-radius: 24px; padding: 8px 20px; backdrop-filter: blur(16px);
    }
    .nav-btn {
      background: transparent; border: none; color: var(--ink-dim);
      cursor: pointer; padding: 10px; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s; font-size: 18px; width: 44px; height: 44px;
    }
    .nav-btn.active { color: var(--accent); background: rgba(255, 0, 0, 0.1); }
    .nav-btn:hover { color: var(--ink); transform: scale(1.1); }
    .nav-btn:active { transform: scale(0.95); }

    /* --- Video Detail Panel --- */
    .detail-panel {
      position: fixed; top: var(--header-height); right: -600px;
      width: 600px; height: calc(100vh - var(--header-height));
      background: var(--card-bg); border-left: 1px solid var(--glass-border);
      transition: right 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      z-index: 8888; display: flex; flex-direction: column;
    }
    .detail-panel.active { right: 0; }
    .detail-close {
      position: absolute; top: 16px; right: 16px; z-index: 9999;
      background: var(--glass-bg); border: 1px solid var(--glass-border);
      border-radius: 50%; width: 32px; height: 32px; display: flex;
      align-items: center; justify-content: center; cursor: pointer;
      color: var(--ink-dim); transition: all 0.2s;
    }
    .detail-close:hover { color: var(--ink); background: var(--glass-border); }
    .detail-content {
      flex: 1; overflow-y: auto; padding: 20px;
    }
    .video-player {
      width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px;
      margin-bottom: 16px; display: flex; align-items: center; justify-content: center;
      color: var(--ink-dim); font-size: 18px;
    }

    /* --- Search Overlay --- */
    .search-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px);
      z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s;
      display: flex; flex-direction: column; align-items: center; padding-top: 120px;
    }
    .search-overlay.active { opacity: 1; pointer-events: auto; }
    .search-input {
      width: 90%; max-width: 600px; padding: 20px; font-size: 24px; background: var(--glass-bg);
      border: 2px solid var(--glass-border); border-radius: 16px; color: var(--ink);
      margin-bottom: 20px; font-weight: 600;
    }
    .search-results {
      width: 90%; max-width: 800px; max-height: 60vh; overflow-y: auto;
    }

    /* --- Context Menu --- */
    .context-menu {
      position: fixed; display: none; background: var(--card-bg);
      border: 1px solid var(--glass-border); border-radius: 12px;
      padding: 8px 0; min-width: 180px; z-index: 9999;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
    .context-menu.active { display: block; }
    .ctx-header {
      padding: 8px 16px; font-weight: 600; font-size: 12px;
      text-transform: uppercase; color: var(--ink-dim); border-bottom: 1px solid var(--glass-border);
      margin-bottom: 4px;
    }
    .ctx-item {
      padding: 10px 16px; cursor: pointer; transition: background 0.2s; font-size: 14px;
    }
    .ctx-item:hover { background: var(--glass-bg); }

    /* --- Responsive Design --- */
    @media(max-width: 768px) {
      .kanban-column {
        min-width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }
      .kanban-column.active {
        transform: translateX(0);
      }
      .detail-panel {
        width: 100%;
        right: -100%;
      }
    }

    /* --- Loading States --- */
    .skeleton {
      background: linear-gradient(90deg, var(--glass-bg) 25%, var(--glass-border) 50%, var(--glass-bg) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* --- Utility Classes --- */
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .slide-up { animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* --- Mini Map for Scatter View --- */
    .mini-map {
      position: fixed; bottom: 20px; right: 20px; width: 120px; height: 80px;
      background: var(--glass-bg); border: 1px solid var(--glass-border);
      border-radius: 8px; z-index: 201; opacity: 0.7; transition: opacity 0.2s;
    }
    .mini-map:hover { opacity: 1; }

    /* --- Collection Zones --- */
    .collection-zone {
      position: absolute; border: 2px dashed var(--glass-border);
      border-radius: 16px; background: rgba(255,255,255,0.02);
      display: flex; align-items: center; justify-content: center;
      color: var(--ink-dim); font-weight: 600; text-transform: uppercase;
      font-size: 14px; letter-spacing: 1px;
    }
    .collection-zone.active {
      border-color: var(--accent);
      background: rgba(255,0,0,0.05);
    }

    /* --- Toast Notifications --- */
    .toast {
      position: fixed; top: 120px; left: 50%; transform: translateX(-50%) translateY(-5px);
      background: var(--accent); color: #000; padding: 10px 20px; border-radius: 20px;
      font-weight: 700; font-size: 12px; opacity: 0; pointer-events: none; transition: all 0.3s; z-index: 9999;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    [data-theme="rose"] .toast {
      background: linear-gradient(135deg, var(--rose-primary), var(--rose-secondary));
      color: white;
    }
  </style>

</head>
<body data-theme="dark">
  <!-- Header -->
  <header class="app-header">
    <div class="header-top">
      <div class="logo">
        <div class="logo-text">YouTube</div>
      </div>
      <div class="header-buttons">
        <button class="theme-btn" onclick="toggleTheme()" title="Toggle Theme">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
      </div>
    </div>
    <div class="category-bar" id="categoryBar">
      <!-- Category pills will be generated here -->
    </div>
  </header>

  <!-- Kanban Container -->
  <div class="kanban-container hidden" id="kanbanContainer">
    <div class="kanban-column">
      <div class="column-header">
        <div class="column-title">Feed</div>
      </div>
      <div class="column-content" id="feedColumn">
        <!-- Grid view content -->
      </div>
    </div>
    <div class="kanban-column">
      <div class="column-header">
        <div class="column-title">Curated Queue</div>
      </div>
      <div class="column-content" id="curatedColumn">
        <!-- Saved/curated videos -->
      </div>
    </div>
    <div class="kanban-column">
      <div class="column-header">
        <div class="column-title">Related</div>
      </div>
      <div class="column-content" id="relatedColumn">
        <!-- Related videos -->
      </div>
    </div>
    <div class="kanban-column">
      <div class="column-header">
        <div class="column-title">Discover</div>
      </div>
      <div class="column-content" id="discoverColumn">
        <!-- Category discovery -->
      </div>
    </div>
  </div>

  <!-- Grid View Container -->
  <div class="view-container active" id="gridContainer">
    <div class="grid-wrapper" id="gridWrapper">
      <!-- Video cards will be generated here -->
    </div>
  </div>

  <!-- Scatter View Container -->
  <div class="view-container" id="scatterContainer">
    <div class="scatter-canvas" id="scatterCanvas">
      <!-- Scatter cards will be positioned here -->
    </div>
    <div class="mini-map" id="miniMap"></div>
  </div>

  <!-- List View Container -->
  <div class="view-container" id="listContainer">
    <div style="padding: 16px; display: flex; justify-content: space-between; align-items: center;">
      <h2 style="font-size: 18px; font-weight: 600;">Watch History</h2>
      <button class="action-icon" style="padding: 8px 16px; width: auto;" onclick="exportWatchHistory()" title="Export History">
        üì• Export CSV
      </button>
    </div>
    <table class="list-table" id="listTable">
      <thead>
        <tr>
          <th>Thumbnail</th>
          <th>Title</th>
          <th>Channel</th>
          <th>Category</th>
          <th>Status</th>
          <th>Duration</th>
          <th>Views</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="listBody">
        <!-- List rows will be generated here -->
      </tbody>
    </table>
  </div>

  <!-- Video Detail Panel -->
  <div class="detail-panel" id="detailPanel">
    <div class="detail-close" onclick="closeDetailPanel()">‚úï</div>
    <div class="detail-content" id="detailContent">
      <!-- Video details will be loaded here -->
    </div>
  </div>

  <!-- Search Overlay -->
  <div class="search-overlay" id="searchOverlay">
    <input type="text" class="search-input" id="searchInput" placeholder="Search videos..." onkeyup="handleSearch(event)">
    <div class="search-results" id="searchResults"></div>
  </div>

  <!-- Context Menu -->
  <div class="context-menu" id="contextMenu"></div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="bottom-nav-inner">
      <button class="nav-btn active" onclick="switchView('grid')" title="Grid View">üé¨</button>
      <button class="nav-btn" onclick="switchView('scatter')" title="Curated Canvas">‚≠ê</button>
      <button class="nav-btn" onclick="switchView('list')" title="Watch History">üìã</button>
      <button class="nav-btn" onclick="openSearch()" title="Search">üîç</button>
      <button class="nav-btn" onclick="toggleKanban()" title="Kanban Mode">‚ò∞</button>
    </div>
  </nav>

  <script>
    // ====== GLOBAL STATE ======
    let config = {
      currentView: 'grid',
      currentCategory: 'all',
      currentTheme: 'dark',
      kanbanMode: false,
      searchQuery: ''
    };

    let videos = [];
    let collections = [];
    let currentVideo = null;

    // ====== MOCK DATA ======
    function generateMockVideos() {
      const categories = ['Music', 'Gaming', 'Education', 'News', 'Sports', 'Comedy', 'Science', 'Tech', 'DIY', 'Food'];
      const statuses = ['unwatched', 'in-progress', 'completed', 'saved', 'archived'];
      const mockVideos = [];

      for (let i = 1; i <= 50; i++) {
        const category = categories[Math.floor(Math.random() * categories.length)];
        const status = Math.random() > 0.7 ? statuses[Math.floor(Math.random() * statuses.length)] : 'unwatched';
        const duration = Math.floor(Math.random() * 1800) + 60; // 1-30 minutes
        const views = Math.floor(Math.random() * 10000000) + 1000;
        
        mockVideos.push({
          id: i,
          title: `${category} Video ${i}: Amazing Content Title Here`,
          channel: {
            name: `${category}Channel${Math.floor(Math.random() * 10) + 1}`,
            id: `channel_${Math.floor(Math.random() * 100)}`,
            avatar: `https://picsum.photos/seed/avatar${i}/40/40`,
            verified: Math.random() > 0.7
          },
          thumbnail: `https://picsum.photos/seed/video${i}/320/180`,
          duration: duration,
          uploadDate: Date.now() - (Math.random() * 30 * 24 * 60 * 60 * 1000), // Last 30 days
          views: views,
          likes: Math.floor(views * (Math.random() * 0.1 + 0.01)),
          category: category,
          tags: [category.toLowerCase(), 'tutorial', 'learning', 'entertainment'],
          status: status,
          watchProgress: status === 'completed' ? 1 : (status === 'in-progress' ? Math.random() * 0.9 : 0),
          lastWatched: status !== 'unwatched' ? Date.now() - (Math.random() * 7 * 24 * 60 * 60 * 1000) : null,
          savedDate: status === 'saved' ? Date.now() - (Math.random() * 3 * 24 * 60 * 60 * 1000) : null,
          collections: status === 'saved' ? ['Watch Later'] : [],
          scatterPosition: { x: Math.random() * 800 + 100, y: Math.random() * 600 + 100 },
          description: `This is an amazing ${category.toLowerCase()} video that provides incredible value and entertainment. Join us as we explore fascinating topics and learn new things together.`
        });
      }
      
      return mockVideos;
    }

    function generateMockCollections() {
      return [
        { id: 1, name: 'Watch Tonight', color: '#ff6b6b', videoIds: [], layout: 'grid' },
        { id: 2, name: 'Learning Queue', color: '#4ecdc4', videoIds: [], layout: 'cascade' },
        { id: 3, name: 'Inspiration', color: '#ffe66d', videoIds: [], layout: 'radial' },
        { id: 4, name: 'Favorites', color: '#a8e6cf', videoIds: [], layout: 'grid' }
      ];
    }

    // ====== INITIALIZATION ======
    function init() {
      videos = generateMockVideos();
      collections = generateMockCollections();
      loadState();
      renderCategories();
      renderCurrentView();
      setupEventListeners();
    }

    function setupEventListeners() {
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT') return;
        
        switch(e.key.toLowerCase()) {
          case 'g': switchView('grid'); break;
          case 's': switchView('scatter'); break;
          case 'h': switchView('list'); break;
          case '/': e.preventDefault(); openSearch(); break;
          case 'escape': closeAllOverlays(); break;
        }
      });

      // Context menu
      document.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        showContextMenu(e);
      });

      document.addEventListener('click', () => {
        document.getElementById('contextMenu').classList.remove('active');
      });

      // Search overlay escape
      document.getElementById('searchOverlay').addEventListener('click', (e) => {
        if (e.target.id === 'searchOverlay') {
          closeSearch();
        }
      });
    }

    // ====== VIEW MANAGEMENT ======
    function switchView(view) {
      config.currentView = view;
      
      // Update navigation
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Hide kanban mode when switching views
      if (config.kanbanMode) {
        toggleKanban();
      }
      
      renderCurrentView();
      saveState();
    }

    function renderCurrentView() {
      // Hide all views
      document.getElementById('gridContainer').classList.remove('active');
      document.getElementById('scatterContainer').classList.remove('active');
      document.getElementById('listContainer').classList.remove('active');
      document.getElementById('kanbanContainer').classList.add('hidden');
      
      // Show current view
      switch(config.currentView) {
        case 'grid':
          document.getElementById('gridContainer').classList.add('active');
          renderGridView();
          break;
        case 'scatter':
          document.getElementById('scatterContainer').classList.add('active');
          renderScatterView();
          break;
        case 'list':
          document.getElementById('listContainer').classList.add('active');
          renderListView();
          break;
      }
    }

    // ====== CATEGORY FILTERING ======
    function renderCategories() {
      const categories = ['all', ...new Set(videos.map(v => v.category))];
      const categoryBar = document.getElementById('categoryBar');
      
      categoryBar.innerHTML = categories.map(cat => `
        <div class="pill ${config.currentCategory === cat ? 'active' : ''}" 
             onclick="selectCategory('${cat}')">
          ${cat === 'all' ? 'All' : cat}
        </div>
      `).join('') + '<div class="pill add-btn" onclick="addCustomCategory()">+ Custom</div>';
    }

    function selectCategory(category) {
      config.currentCategory = category;
      renderCategories();
      renderCurrentView();
      saveState();
    }

    function filterVideos() {
      let filtered = videos;
      
      if (config.currentCategory !== 'all') {
        filtered = filtered.filter(v => v.category === config.currentCategory);
      }
      
      if (config.searchQuery) {
        filtered = filtered.filter(v => 
          v.title.toLowerCase().includes(config.searchQuery.toLowerCase()) ||
          v.channel.name.toLowerCase().includes(config.searchQuery.toLowerCase())
        );
      }
      
      return filtered;
    }

    // ====== GRID VIEW ======
    function renderGridView() {
      const wrapper = document.getElementById('gridWrapper');
      const filtered = filterVideos();
      
      wrapper.innerHTML = filtered.map(video => createVideoCard(video)).join('');
    }

    function createVideoCard(video) {
      const duration = formatDuration(video.duration);
      const views = formatViews(video.views);
      
      return `
        <div class="video-card" onclick="openVideoDetail(${video.id})" oncontextmenu="showVideoContextMenu(event, ${video.id})">
          <div class="video-thumbnail">
            <img src="${video.thumbnail}" alt="${video.title}" loading="lazy">
            <div class="video-duration">${duration}</div>
            <div class="video-status status-${video.status}">${video.status.replace('-', ' ')}</div>
          </div>
          <div class="video-info">
            <div class="video-title">${video.title}</div>
            <div class="video-channel">
              <div class="channel-avatar">
                <img src="${video.channel.avatar}" alt="${video.channel.name}" width="24" height="24">
              </div>
              <span>${video.channel.name}</span>
            </div>
            <div class="video-meta">
              <span class="video-views">${views} views</span>
              <div class="video-actions">
                <button class="action-icon" onclick="event.stopPropagation(); toggleSave(${video.id})" title="Save">
                  ${video.status === 'saved' ? '‚ô•' : '‚ô°'}
                </button>
                <button class="action-icon" onclick="event.stopPropagation(); shareVideo(${video.id})" title="Share">
                  ‚Üó
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ====== SCATTER VIEW ======
    function renderScatterView() {
      const canvas = document.getElementById('scatterCanvas');
      const filtered = filterVideos();
      
      canvas.innerHTML = '';
      
      // Add collection zones
      collections.forEach((collection, index) => {
        const zone = document.createElement('div');
        zone.className = 'collection-zone';
        zone.style.left = `${index * 250 + 50}px`;
        zone.style.top = '50px';
        zone.style.width = '200px';
        zone.style.height = '150px';
        zone.textContent = collection.name;
        zone.style.borderColor = collection.color;
        zone.dataset.collectionId = collection.id;
        canvas.appendChild(zone);
      });
      
      // Add video cards
      filtered.forEach(video => {
        const card = createScatterCard(video);
        canvas.appendChild(card);
      });
    }

    function createScatterCard(video) {
      const card = document.createElement('div');
      card.className = 'scatter-card';
      card.style.left = `${video.scatterPosition.x}px`;
      card.style.top = `${video.scatterPosition.y}px`;
      card.dataset.videoId = video.id;
      
      card.innerHTML = `
        <div class="scatter-thumbnail">
          <img src="${video.thumbnail}" alt="${video.title}" width="200" height="80" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
        </div>
        <div class="video-title" style="font-size: 12px; font-weight: 600;">${video.title.substring(0, 30)}...</div>
        <div class="video-channel" style="font-size: 11px; color: var(--ink-dim);">${video.channel.name}</div>
        <div class="video-duration" style="font-size: 11px; font-family: var(--font-mono); color: var(--ink-dim);">${formatDuration(video.duration)}</div>
      `;
      
      card.addEventListener('mousedown', startDragging);
      card.addEventListener('dblclick', () => openVideoDetail(video.id));
      
      return card;
    }

    // ====== LIST VIEW ======
    function renderListView() {
      const tbody = document.getElementById('listBody');
      const filtered = filterVideos();
      
      tbody.innerHTML = filtered.map(video => `
        <tr onclick="openVideoDetail(${video.id})">
          <td><img src="${video.thumbnail}" alt="${video.title}" class="list-thumbnail"></td>
          <td>${video.title}</td>
          <td>${video.channel.name}</td>
          <td>${video.category}</td>
          <td><span class="video-status status-${video.status}">${video.status.replace('-', ' ')}</span></td>
          <td>${formatDuration(video.duration)}</td>
          <td>${formatViews(video.views)}</td>
          <td>
            <button class="action-icon" onclick="event.stopPropagation(); toggleSave(${video.id})">
              ${video.status === 'saved' ? '‚ô•' : '‚ô°'}
            </button>
          </td>
        </tr>
      `).join('');
    }

    // ====== KANBAN MODE ======
    function toggleKanban() {
      config.kanbanMode = !config.kanbanMode;
      
      if (config.kanbanMode) {
        document.getElementById('kanbanContainer').classList.remove('hidden');
        document.querySelectorAll('.view-container').forEach(container => {
          container.classList.remove('active');
        });
        renderKanbanColumns();
      } else {
        document.getElementById('kanbanContainer').classList.add('hidden');
        renderCurrentView();
      }
      
      saveState();
    }

    function renderKanbanColumns() {
      // Feed column
      const feedColumn = document.getElementById('feedColumn');
      const gridVideos = filterVideos();
      feedColumn.innerHTML = `
        <div class="grid-wrapper">
          ${gridVideos.map(video => createVideoCard(video)).join('')}
        </div>
      `;
      
      // Curated column
      const curatedColumn = document.getElementById('curatedColumn');
      const savedVideos = videos.filter(v => v.status === 'saved');
      curatedColumn.innerHTML = savedVideos.map(video => createVideoCard(video)).join('');
      
      // Related column (mock data)
      const relatedColumn = document.getElementById('relatedColumn');
      const relatedVideos = videos.slice(0, 10);
      relatedColumn.innerHTML = relatedVideos.map(video => createVideoCard(video)).join('');
      
      // Discover column (mock data)
      const discoverColumn = document.getElementById('discoverColumn');
      const discoverVideos = videos.slice(10, 20);
      discoverColumn.innerHTML = discoverVideos.map(video => createVideoCard(video)).join('');
    }

    // ====== VIDEO DETAIL PANEL ======
    function openVideoDetail(videoId) {
      const video = videos.find(v => v.id === videoId);
      if (!video) return;
      
      currentVideo = video;
      const panel = document.getElementById('detailPanel');
      const content = document.getElementById('detailContent');
      
      content.innerHTML = `
        <div class="video-player">
          üìπ Video Player Placeholder<br>
          <small>${video.title}</small>
        </div>
        <h2 style="margin-bottom: 8px;">${video.title}</h2>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
          <div class="channel-avatar">
            <img src="${video.channel.avatar}" alt="${video.channel.name}" width="40" height="40" style="border-radius: 50%;">
          </div>
          <div>
            <div style="font-weight: 600;">${video.channel.name}</div>
            <div style="font-size: 13px; color: var(--ink-dim);">${formatViews(video.views)} views ‚Ä¢ ${formatDate(video.uploadDate)}</div>
          </div>
        </div>
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <button class="action-icon" style="padding: 8px 16px; width: auto;">üëç Like</button>
          <button class="action-icon" style="padding: 8px 16px; width: auto;">üëé Dislike</button>
          <button class="action-icon" style="padding: 8px 16px; width: auto;">‚Üó Share</button>
          <button class="action-icon" style="padding: 8px 16px; width: auto;" onclick="toggleSave(${video.id})">
            ${video.status === 'saved' ? '‚ô• Saved' : '‚ô° Save'}
          </button>
        </div>
        <div style="padding-top: 16px; border-top: 1px solid var(--glass-border);">
          <h3 style="margin-bottom: 8px;">Description</h3>
          <p style="color: var(--ink-dim); line-height: 1.6;">${video.description}</p>
        </div>
        <div style="margin-top: 24px;">
          <h3>Comments</h3>
          <div style="color: var(--ink-dim);">Comments section would go here...</div>
        </div>
      `;
      
      panel.classList.add('active');
    }

    function closeDetailPanel() {
      document.getElementById('detailPanel').classList.remove('active');
      currentVideo = null;
    }

    // ====== SEARCH ======
    function openSearch() {
      const overlay = document.getElementById('searchOverlay');
      overlay.classList.add('active');
      document.getElementById('searchInput').focus();
    }

    function closeSearch() {
      const overlay = document.getElementById('searchOverlay');
      overlay.classList.remove('active');
      document.getElementById('searchInput').value = '';
      config.searchQuery = '';
      renderCurrentView();
    }

    function handleSearch(event) {
      if (event.key === 'Escape') {
        closeSearch();
        return;
      }
      
      config.searchQuery = event.target.value;
      
      if (config.searchQuery) {
        const results = filterVideos();
        const resultsDiv = document.getElementById('searchResults');
        
        resultsDiv.innerHTML = results.map(video => `
          <div class="video-card" style="margin-bottom: 16px;" onclick="openVideoDetail(${video.id})">
            <div class="video-thumbnail">
              <img src="${video.thumbnail}" alt="${video.title}" loading="lazy">
              <div class="video-duration">${formatDuration(video.duration)}</div>
            </div>
            <div class="video-info">
              <div class="video-title">${video.title}</div>
              <div class="video-channel">${video.channel.name}</div>
              <div class="video-meta">
                <span class="video-views">${formatViews(video.views)} views</span>
              </div>
            </div>
          </div>
        `).join('');
      }
    }

    // ====== CONTEXT MENUS ======
    function showContextMenu(event) {
      event.preventDefault();
      const menu = document.getElementById('contextMenu');
      
      // Show different menus based on what was clicked
      if (event.target.closest('.video-card') || event.target.closest('.scatter-card')) {
        // Video context menu handled elsewhere
        return;
      } else if (event.target.closest('#scatterCanvas')) {
        showScatterContextMenu(event);
      } else {
        // Background context menu
        menu.innerHTML = `
          <div class="ctx-header">Actions</div>
          <div class="ctx-item" onclick="openSearch()">üîç Search Videos</div>
          <div class="ctx-item" onclick="toggleKanban()">‚ò∞ Toggle Kanban</div>
          <div class="ctx-item" onclick="switchView('grid')">üé¨ Grid View</div>
          <div class="ctx-item" onclick="switchView('scatter')">‚≠ê Scatter View</div>
          <div class="ctx-item" onclick="switchView('list')">üìã List View</div>
        `;
      }
      
      menu.style.left = `${event.clientX}px`;
      menu.style.top = `${event.clientY}px`;
      menu.classList.add('active');
    }

    function showVideoContextMenu(event, videoId) {
      event.preventDefault();
      event.stopPropagation();
      
      const video = videos.find(v => v.id === videoId);
      const menu = document.getElementById('contextMenu');
      
      menu.innerHTML = `
        <div class="ctx-header">${video.channel.name}</div>
        <div class="ctx-item" onclick="openVideoDetail(${videoId})">‚ñ∂ Play Now</div>
        <div class="ctx-item" onclick="toggleSave(${videoId})">${video.status === 'saved' ? '‚ô• Unsave' : '‚ô° Save Video'}</div>
        <div class="ctx-item" onclick="shareVideo(${videoId})">‚Üó Share</div>
        <div class="ctx-item text-blue" onclick="changeVideoStatus(${videoId}, 'in-progress')">‚èØ Mark Watching</div>
        <div class="ctx-item text-green" onclick="changeVideoStatus(${videoId}, 'completed')">‚úì Mark Complete</div>
        <div class="ctx-item text-red" onclick="removeVideo(${videoId})">üóë Remove</div>
      `;
      
      menu.style.left = `${event.clientX}px`;
      menu.style.top = `${event.clientY}px`;
      menu.classList.add('active');
    }

    function showScatterContextMenu(event) {
      const menu = document.getElementById('contextMenu');
      
      menu.innerHTML = `
        <div class="ctx-header">Canvas Actions</div>
        <div class="ctx-item" onclick="collectNodes()">üì¶ Collect (Grid)</div>
        <div class="ctx-item" onclick="cascadeNodes()">üé¥ Cascade (Stack)</div>
        <div class="ctx-item" onclick="sortScatterByStatus()">üè∑ Sort by Status</div>
        <div class="ctx-item" onclick="sortScatterByCategory()">üìÇ Sort by Category</div>
        <div class="ctx-item" onclick="resetScatterView()">üîÑ Reset View</div>
      `;
      
      menu.style.left = `${event.clientX}px`;
      menu.style.top = `${event.clientY}px`;
      menu.classList.add('active');
    }

    // ====== VIDEO ACTIONS ======
    function toggleSave(videoId) {
      const video = videos.find(v => v.id === videoId);
      if (!video) return;
      
      if (video.status === 'saved') {
        video.status = 'unwatched';
        video.collections = [];
      } else {
        video.status = 'saved';
        video.collections = ['Watch Later'];
      }
      
      renderCurrentView();
      saveState();
      showToast(video.status === 'saved' ? 'Video saved!' : 'Video unsaved');
    }

    function shareVideo(videoId) {
      const video = videos.find(v => v.id === videoId);
      if (!video) return;
      
      // Copy to clipboard simulation
      const url = `https://youtube.com/watch?v=${videoId}`;
      navigator.clipboard.writeText(url);
      showToast('Link copied to clipboard!');
    }

    function changeVideoStatus(videoId, status) {
      const video = videos.find(v => v.id === videoId);
      if (!video) return;
      
      video.status = status;
      renderCurrentView();
      saveState();
      showToast(`Status changed to ${status.replace('-', ' ')}`);
    }

    function removeVideo(videoId) {
      if (confirm('Remove this video?')) {
        videos = videos.filter(v => v.id !== videoId);
        renderCurrentView();
        saveState();
        showToast('Video removed');
      }
    }

    // ====== DRAG AND DROP ======
    let isDragging = false;
    let draggedCard = null;
    let dragOffset = { x: 0, y: 0 };

    function startDragging(e) {
      if (e.target.closest('.video-card') || config.currentView !== 'scatter') return;
      
      isDragging = true;
      draggedCard = e.currentTarget;
      draggedCard.classList.add('is-dragging');
      
      const rect = draggedCard.getBoundingClientRect();
      dragOffset.x = e.clientX - rect.left;
      dragOffset.y = e.clientY - rect.top;
      
      draggedCard.style.zIndex = '2000';
      
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDragging);
    }

    function drag(e) {
      if (!isDragging || !draggedCard) return;
      
      const canvas = document.getElementById('scatterCanvas');
      const canvasRect = canvas.getBoundingClientRect();
      
      const x = (e.clientX - canvasRect.left - dragOffset.x) / (canvas.style.transform.match(/scale\(([\d.]+)\)/)?.[1] || 1);
      const y = (e.clientY - canvasRect.top - dragOffset.y) / (canvas.style.transform.match(/scale\(([\d.]+)\)/)?.[1] || 1);
      
      draggedCard.style.left = `${x}px`;
      draggedCard.style.top = `${y}px`;
    }

    function stopDragging() {
      if (draggedCard) {
        draggedCard.classList.remove('is-dragging');
        draggedCard.style.zIndex = '';
        
        // Update video position
        const videoId = parseInt(draggedCard.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
          video.scatterPosition.x = parseFloat(draggedCard.style.left);
          video.scatterPosition.y = parseFloat(draggedCard.style.top);
        }
      }
      
      isDragging = false;
      draggedCard = null;
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', stopDragging);
      
      saveState();
    }

    // ====== SCATTER ACTIONS ======
    function collectNodes() {
      const canvas = document.getElementById('scatterCanvas');
      const cards = canvas.querySelectorAll('.scatter-card');
      
      cards.forEach((card, index) => {
        const row = Math.floor(index / 5);
        const col = index % 5;
        card.style.left = `${50 + col * 220}px`;
        card.style.top = `${100 + row * 200}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
          video.scatterPosition = { x: 50 + col * 220, y: 100 + row * 200 };
        }
      });
      
      saveState();
      showToast('Videos collected in grid');
    }

    function cascadeNodes() {
      const canvas = document.getElementById('scatterCanvas');
      const cards = canvas.querySelectorAll('.scatter-card');
      
      cards.forEach((card, index) => {
        card.style.left = `${100 + index * 10}px`;
        card.style.top = `${100 + index * 10}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
          video.scatterPosition = { x: 100 + index * 10, y: 100 + index * 10 };
        }
      });
      
      saveState();
      showToast('Videos cascaded');
    }

    function sortScatterByStatus() {
      const canvas = document.getElementById('scatterCanvas');
      const cards = Array.from(canvas.querySelectorAll('.scatter-card'));
      
      cards.sort((a, b) => {
        const videoA = videos.find(v => v.id === parseInt(a.dataset.videoId));
        const videoB = videos.find(v => v.id === parseInt(b.dataset.videoId));
        return videoA.status.localeCompare(videoB.status);
      });
      
      cards.forEach((card, index) => {
        const row = Math.floor(index / 5);
        const col = index % 5;
        card.style.left = `${50 + col * 220}px`;
        card.style.top = `${100 + row * 200}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
          video.scatterPosition = { x: 50 + col * 220, y: 100 + row * 200 };
        }
      });
      
      saveState();
      showToast('Sorted by status');
    }

    function sortScatterByCategory() {
      const canvas = document.getElementById('scatterCanvas');
      const cards = Array.from(canvas.querySelectorAll('.scatter-card'));
      
      cards.sort((a, b) => {
        const videoA = videos.find(v => v.id === parseInt(a.dataset.videoId));
        const videoB = videos.find(v => v.id === parseInt(b.dataset.videoId));
        return videoA.category.localeCompare(videoB.category);
      });
      
      cards.forEach((card, index) => {
        const row = Math.floor(index / 5);
        const col = index % 5;
        card.style.left = `${50 + col * 220}px`;
        card.style.top = `${100 + row * 200}px`;
        
        const videoId = parseInt(card.dataset.videoId);
        const video = videos.find(v => v.id === videoId);
        if (video) {
          video.scatterPosition = { x: 50 + col * 220, y: 100 + row * 200 };
        }
      });
      
      saveState();
      showToast('Sorted by category');
    }

    function resetScatterView() {
      videos.forEach(video => {
        video.scatterPosition = { 
          x: Math.random() * 800 + 100, 
          y: Math.random() * 600 + 100 
        };
      });
      renderScatterView();
      saveState();
      showToast('Scatter view reset');
    }

    // ====== THEME MANAGEMENT ======
    function toggleTheme() {
      const themes = ['dark', 'light'];
      const currentIndex = themes.indexOf(config.currentTheme);
      config.currentTheme = themes[(currentIndex + 1) % themes.length];
      
      document.body.dataset.theme = config.currentTheme;
      saveState();
    }

    // ====== UTILITY FUNCTIONS ======
    function formatDuration(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      
      if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      } else {
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
      }
    }

    function formatViews(views) {
      if (views >= 1000000) {
        return `${(views / 1000000).toFixed(1)}M`;
      } else if (views >= 1000) {
        return `${(views / 1000).toFixed(1)}K`;
      } else {
        return views.toString();
      }
    }

    function formatDate(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      
      if (days === 0) return 'Today';
      if (days === 1) return 'Yesterday';
      if (days < 7) return `${days} days ago`;
      if (days < 30) return `${Math.floor(days / 7)} weeks ago`;
      if (days < 365) return `${Math.floor(days / 30)} months ago`;
      return `${Math.floor(days / 365)} years ago`;
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast show';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    function closeAllOverlays() {
      closeSearch();
      closeDetailPanel();
      document.getElementById('contextMenu').classList.remove('active');
    }

    // ====== STATE MANAGEMENT ======
    function saveState() {
      const state = {
        config: config,
        videos: videos,
        collections: collections
      };
      localStorage.setItem('youtubeReimagined', JSON.stringify(state));
    }

    function loadState() {
      const saved = localStorage.getItem('youtubeReimagined');
      if (saved) {
        const state = JSON.parse(saved);
        config = { ...config, ...state.config };
        videos = state.videos || videos;
        collections = state.collections || collections;
        
        document.body.dataset.theme = config.currentTheme;
      }
    }

    // ====== ADDITIONAL FUNCTIONS ======
    function addCustomCategory() {
      const name = prompt('Enter custom category name:');
      if (name && name.trim()) {
        // This would normally add to the category system
        showToast(`Custom category "${name}" added`);
      }
    }

    function exportWatchHistory() {
      const filtered = filterVideos();
      const csvContent = [
        ['Title', 'Channel', 'Category', 'Status', 'Duration', 'Views', 'Upload Date', 'Last Watched'].join(','),
        ...filtered.map(video => [
          `"${video.title.replace(/"/g, '""')}"`,
          `"${video.channel.name}"`,
          video.category,
          video.status,
          formatDuration(video.duration),
          video.views,
          new Date(video.uploadDate).toLocaleDateString(),
          video.lastWatched ? new Date(video.lastWatched).toLocaleDateString() : 'Never'
        ].join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `youtube-watch-history-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('Watch history exported!');
    }

    // ====== INITIALIZATION ======
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
