<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>intoview • notes — MVP</title>
<link rel="icon" href="data:," />
<style>
/* ----------------------------------------------------
   intoview • notes — single-file MVP (full-fidelity UI)
   Brand tenets implemented:
   • 8pt grid, quiet BW UI, 1px device hairlines
   • Card with top (title/GPS) + bottom (caption/timestamp)
   • Fixed export formats: 1:1 or 4:3, baked chrome
   • Short, decisive inputs (40/100 caps) + counters
   • Tilt‑shift background band behind focused card
   • Optional GPS (redactable) per note
   ---------------------------------------------------- */
:root{
  /* spacing scale (8pt grid) */
  --space-0: 0px;  --space-1: 4px;  --space-2: 8px;  --space-3: 12px;
  --space-4: 16px; --space-5: 20px; --space-6: 24px; --space-7: 28px;
  --space-8: 32px; --space-9: 36px; --space-10: 40px;

  /* colors */
  --bg: #0E0E10;          /* Surface 0 */
  --panel: #151518;       /* Surface 1 */
  --sheet: #1A1A1F;       /* Surface 2 */
  --fg: #EAEAEA;          /* Text */
  --muted: #A8A8A8;       /* Secondary text */
  --hair: #FFFFFF20;      /* hairlines */
  --accent: #59D2C8;      /* subtle accent (rare) */

  /* type */
  --font-ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "JetBrains Mono", "Liberation Mono", monospace;

  /* component metrics */
  --chrome-px: 1px;         /* hairline */
  --card-max: 720px;        /* desktop card max */
  --card-min: 280px;        /* small device safe */
  --tilt-sigma: 10px;       /* subtle */
  --tilt-darken: 0.12;      /* 12% vignette under card */

  /* export */
  --export-padding: 12px;   /* inside frame paddings */
}

html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--fg); font-family:var(--font-ui);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* Layout */
.app{
  display:grid; grid-template-columns: 1fr minmax(var(--card-min), var(--card-max)) 1fr;
  grid-template-rows:auto 1fr auto; min-height:100dvh;
}
.header{ grid-column: 1/-1; display:flex; align-items:center; gap:var(--space-4);
  padding: env(safe-area-inset-top) var(--space-6) var(--space-4); }
.logo{ display:flex; align-items:center; gap:var(--space-3); opacity:0.95; }
.logo svg{ width:28px; height:28px; }
.logo .word{ letter-spacing:.02em; font-weight:600; }

.main{
  grid-column: 2; display:grid; grid-template-columns:1fr; gap:var(--space-6);
  padding: var(--space-2) 0 var(--space-8);
}

.helper{ color:var(--muted); font-size:14px; line-height:1.4; opacity:.9; }
.helper em{ font-style:normal; color:var(--fg); opacity:.9 }

/* Card shell */
.card-wrap{ position:relative; isolation:isolate; }
.tilt-bg{ position:absolute; inset:-6vh -6vw; background:#000; z-index:0; opacity:.9; }
.tilt-bg::before{
  content:""; position:absolute; inset:0; background-size:cover; background-position:center;
  filter:blur(var(--tilt-sigma)) saturate(.6) brightness(.9) contrast(.95) grayscale(100%);
}
/* darken behind card */
.tilt-bg::after{ content:""; position:absolute; inset:0; background:radial-gradient(120% 40% at 50% 55%, rgb(0 0 0 / var(--tilt-darken)) 0%, rgb(0 0 0 / var(--tilt-darken)) 55%, transparent 70%); }

.card{ position:relative; z-index:1; background:#000; box-shadow: 0 2px 8px rgb(0 0 0 / .25);
  border:var(--chrome-px) solid #fff; }

.card .top, .card .bottom{
  display:flex; align-items:center; justify-content:space-between;
  padding: 8px; /* exact chrome spacing */
  font-size:12px; line-height:16px; font-family:var(--font-mono);
  color:#e6e6e6; letter-spacing:0; background:#000;
}
.card .bar-hair{ height:var(--chrome-px); background:#fff; opacity:.6; }
.card .img{ position:relative; aspect-ratio: 4/3; background:#111; display:grid; place-items:center; }
.card.square .img{ aspect-ratio:1/1; }
.card .img img{ width:100%; height:100%; object-fit:cover; filter:grayscale(1) contrast(1.07) brightness(.97); }
.card .img .empty{
  display:grid; place-items:center; gap:var(--space-3); color:var(--muted); font-size:14px;
}
.camera-ico{ width:40px; height:40px; stroke:#fff; opacity:.9 }

/* Controls panel */
.panel{ background:var(--panel); border:var(--chrome-px) solid var(--hair);
  padding:var(--space-6); display:grid; gap:var(--space-6); border-radius:8px; }
.inputs{ display:grid; gap:var(--space-4); }
label{ font-size:12px; color:var(--muted); margin-bottom:4px; display:block; }
input[type="text"], textarea, select{
  width:100%; background:#0F0F12; color:var(--fg); border:var(--chrome-px) solid var(--hair);
  border-radius:6px; padding:10px 12px; font-size:14px; outline:none;
}
textarea{ resize:vertical; min-height:84px; max-height:40vh; }
.counter{ text-align:right; font-size:11px; color:var(--muted); }
.row{ display:flex; align-items:center; gap:var(--space-4); flex-wrap:wrap; }
.row .grow{ flex:1 1 auto }
.switch{ display:flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); }
.switch input{ width:18px; height:18px; }

.buttons{ display:flex; gap:var(--space-4); flex-wrap:wrap; }
button{
  appearance:none; border:var(--chrome-px) solid #fff; background:#000; color:#fff; padding:10px 14px;
  font-size:13px; letter-spacing:.01em; border-radius:8px; cursor:pointer; transition:transform .06s ease, opacity .2s;
}
button.secondary{ border-color:var(--hair); color:var(--fg); opacity:.85 }
button:active{ transform:translateY(1px) }

/* Footer */
.footer{ grid-column:1/-1; color:var(--muted); font-size:12px; padding: var(--space-6); opacity:.8 }
.footer a{ color:var(--muted) }

/* Responsive */
@media (max-width: 980px){ .app{ grid-template-columns: 1fr minmax(0, 720px) 1fr; } }
@media (max-width: 720px){
  .header{ padding: env(safe-area-inset-top) var(--space-4) var(--space-2); }
  .main{ padding: var(--space-2) var(--space-4) var(--space-8); }
  .panel{ padding:var(--space-5) }
}

/* Accessibility helpers */
.visually-hidden{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>
</head>
<body>
  <div class="app" id="app">
    <header class="header">
      <div class="logo" aria-label="intoview">
        <!-- minimal cubes mark -->
        <svg viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M11 7l6 3v6l-6-3V7z" fill="#D9D9D9"/>
          <path d="M5 10l6-3v6l-6 3v-6z" fill="#BDBDBD"/>
          <path d="M11 13l6-3v6l-6 3v-6z" fill="#9F9F9F"/>
        </svg>
        <div class="word">intoview</div>
      </div>
    </header>

    <main class="main">
      <p class="helper">moments. movement. mindfulness. <em>write a note, not a novel.</em></p>

      <section class="card-wrap">
        <div class="tilt-bg" id="tiltBg"></div>
        <article class="card square" id="card">
          <div class="top">
            <div><span id="titleOut">[ title ]</span></div>
            <div id="gpsOut" aria-live="polite"></div>
          </div>
          <div class="bar-hair"></div>
          <div class="img" id="imgSlot">
            <div class="empty" id="emptyState">
              <svg class="camera-ico" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 8h4l2-3h6l2 3h4v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8z" stroke="currentColor" />
                <circle cx="12" cy="13" r="4" stroke="currentColor" />
                <path d="M16.5 6.5h3" stroke="currentColor" />
              </svg>
              <div>Upload or take a photo</div>
            </div>
            <img id="photo" alt="preview" hidden />
          </div>
          <div class="bar-hair"></div>
          <div class="bottom">
            <div id="captionOut" class="caption">[ short caption goes here ]</div>
            <div id="tsOut" class="ts"></div>
          </div>
        </article>
      </section>

      <section class="panel" aria-label="controls">
        <div class="inputs">
          <div>
            <label for="title">Title (max 40)</label>
            <input id="title" type="text" maxlength="40" placeholder="e.g., Walks with Wolfie, NYC" />
            <div class="counter"><span id="titleCount">0</span>/40</div>
          </div>
          <div>
            <label for="caption">Caption (max 100)</label>
            <textarea id="caption" maxlength="100" placeholder="I can go … with the flow. I can go."></textarea>
            <div class="counter"><span id="capCount">0</span>/100</div>
          </div>
          <div class="row">
            <div class="grow">
              <label for="aspect">Output Aspect</label>
              <select id="aspect">
                <option value="1">Square — 1:1</option>
                <option value="4/3" selected>Classic — 4:3</option>
              </select>
            </div>
            <div class="switch"><input id="gpsToggle" type="checkbox"/> include GPS</div>
            <div class="switch"><input id="monoToggle" type="checkbox" checked/> mono type bars</div>
          </div>
          <div class="row">
            <input id="file" type="file" accept="image/*" class="grow" />
            <button class="secondary" id="cameraBtn" type="button">Open camera</button>
            <button id="clearBtn" type="button">Clear</button>
          </div>
        </div>
        <div class="buttons">
          <button id="export13" type="button">Export card — 1:1 PNG</button>
          <button id="export43" type="button" class="secondary">Export card — 4:3 PNG</button>
        </div>
      </section>
    </main>

    <footer class="footer">Not a novel way to take note. © intoview</footer>
  </div>

  <canvas id="work" class="visually-hidden"></canvas>

<script>
(()=>{
  /* ---------- DOM ---------- */
  const d = document;
  const imgEl = d.getElementById('photo');
  const emptyState = d.getElementById('emptyState');
  const tiltBg = d.getElementById('tiltBg');
  const titleIn = d.getElementById('title');
  const captionIn = d.getElementById('caption');
  const titleOut = d.getElementById('titleOut');
  const captionOut = d.getElementById('captionOut');
  const gpsOut = d.getElementById('gpsOut');
  const tsOut = d.getElementById('tsOut');
  const fileIn = d.getElementById('file');
  const cameraBtn = d.getElementById('cameraBtn');
  const clearBtn  = d.getElementById('clearBtn');
  const aspectSel = d.getElementById('aspect');
  const gpsToggle = d.getElementById('gpsToggle');
  const monoToggle= d.getElementById('monoToggle');
  const titleCount= d.getElementById('titleCount');
  const capCount  = d.getElementById('capCount');
  const card      = d.getElementById('card');

  /* ---------- Utilities ---------- */
  const fmtTime = (date=new Date())=>{
    // 12h with seconds; could be toggled to 24h if desired
    return date.toLocaleString([], { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });
  };
  const clamp = (n,min,max)=> Math.min(max, Math.max(min,n));
  const objUrl = (file)=> URL.createObjectURL(file);

  /* ---------- State ---------- */
  let photoURL = '';
  let gpsText = '';
  const setBG = (url)=>{
    tiltBg.style.setProperty('--tilt-img', `url(${url})`);
    tiltBg.style.background = 'transparent';
    tiltBg.style.setProperty('background-image','none');
    tiltBg.querySelector('::before');
  };
  // CSS var for background image via style tag injection
  const setTiltImg = (url)=>{
    tiltBg.style.setProperty('--tilt-img-url', `url("${url}")`);
    tiltBg.style.setProperty('--tilt-img','');
    tiltBg.style.setProperty('background','transparent');
    tiltBg.style.setProperty('mask','none');
    tiltBg.style.setProperty('-webkit-mask','none');
    tiltBg.style.setProperty('contain','layout paint');
    tiltBg.style.setProperty('will-change','transform');
    tiltBg.style.setProperty('pointer-events','none');
    tiltBg.style.setProperty('display','block');
    tiltBg.style.setProperty('z-index','0');
    tiltBg.style.setProperty('position','absolute');
    tiltBg.style.setProperty('inset','-6vh -6vw');
    // set via style attribute on ::before
    tiltBg.style.setProperty('--bg-url', `url(${url})`);
    tiltBg.querySelector?.('::before');
  };

  // Patch ::before background since inline styles cannot set it directly
  const styleEl = d.createElement('style');
  styleEl.textContent = `.tilt-bg::before{ background-image: var(--bg-url) !important; }`;
  d.head.appendChild(styleEl);

  /* ---------- I/O bindings ---------- */
  titleIn.addEventListener('input', ()=>{
    titleOut.textContent = titleIn.value.trim() || '[ title ]';
    titleCount.textContent = titleIn.value.length;
  });
  captionIn.addEventListener('input', ()=>{
    captionOut.textContent = captionIn.value.trim() || '[ short caption goes here ]';
    capCount.textContent = captionIn.value.length;
  });
  aspectSel.addEventListener('change', ()=>{
    const ar = aspectSel.value;
    card.classList.toggle('square', ar==='1');
  });

  gpsToggle.addEventListener('change', async ()=>{
    if(!gpsToggle.checked){ gpsText=''; gpsOut.textContent=''; return; }
    if(!('geolocation' in navigator)){ gpsOut.textContent='[gps unavailable]'; return; }
    try{
      const pos = await new Promise((res,rej)=> navigator.geolocation.getCurrentPosition(res,rej, { enableHighAccuracy:false, timeout:8000 }));
      const { latitude, longitude } = pos.coords;
      // Approximate (4 decimals) per privacy
      const lat = latitude.toFixed(4), lon = longitude.toFixed(4);
      gpsText = `[ ${lat}° N ${lon}° W ]`;
      gpsOut.textContent = gpsText;
    }catch(e){ gpsOut.textContent='[gps denied]'; }
  });

  monoToggle.addEventListener('change', ()=>{
    const f = monoToggle.checked ? 'var(--font-mono)' : 'var(--font-ui)';
    card.querySelectorAll('.top,.bottom').forEach(el=> el.style.fontFamily = `\${f}`);
  });

  fileIn.addEventListener('change', ()=>{
    const f = fileIn.files?.[0]; if(!f) return;
    photoURL = objUrl(f);
    imgEl.src = photoURL; imgEl.hidden=false; emptyState.hidden=true;
    setTiltImg(photoURL);
    tsOut.textContent = fmtTime(new Date());
  });

  cameraBtn.addEventListener('click', async ()=>{
    // Fallback to file input on platforms without getUserMedia for still capture
    if(!navigator.mediaDevices?.getUserMedia){ fileIn.click(); return; }
    try{
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode:'environment' }, audio:false });
      // Build a quick capture UI in a dialog
      const dlg = d.createElement('dialog');
      dlg.style.cssText = 'border:none;padding:0;background:#000;color:#fff;border-radius:12px;max-width:min(92vw,720px)';
      dlg.innerHTML = `
        <video id="v" autoplay playsinline style="width:100%;height:auto;display:block;filter:grayscale(1) contrast(1.07) brightness(.97)"></video>
        <div style="display:flex;gap:12px;justify-content:space-between;padding:12px;border-top:1px solid #ffffff22">
          <button id="snap">Shutter</button>
          <button id="cancel" class="secondary">Cancel</button>
        </div>`;
      d.body.appendChild(dlg); dlg.showModal();
      const v = dlg.querySelector('#v'); v.srcObject = stream;
      const stop = ()=> stream.getTracks().forEach(t=>t.stop());
      dlg.querySelector('#cancel').onclick = ()=>{ stop(); dlg.close(); dlg.remove(); };
      dlg.querySelector('#snap').onclick = ()=>{
        const c = d.createElement('canvas');
        const r = v.videoWidth / v.videoHeight; // capture full frame
        c.width = v.videoWidth; c.height = v.videoHeight; const cx = c.getContext('2d');
        cx.drawImage(v,0,0,c.width,c.height);
        c.toBlob(b=>{
          if(!b){ stop(); dlg.close(); dlg.remove(); return; }
          const file = new File([b], 'capture.png', { type:'image/png' });
          photoURL = objUrl(file);
          imgEl.src = photoURL; imgEl.hidden=false; emptyState.hidden=true;
          setTiltImg(photoURL);
          tsOut.textContent = fmtTime(new Date());
          stop(); dlg.close(); dlg.remove();
        }, 'image/png', 0.92);
      };
    }catch(e){ fileIn.click(); }
  });

  clearBtn.addEventListener('click', ()=>{
    imgEl.hidden=true; emptyState.hidden=false; imgEl.removeAttribute('src'); photoURL='';
    titleIn.value=''; captionIn.value=''; titleOut.textContent='[ title ]'; captionOut.textContent='[ short caption goes here ]';
    titleCount.textContent='0'; capCount.textContent='0'; gpsOut.textContent=''; tsOut.textContent='';
  });

  /* ---------- Export pipeline (canvas) ---------- */
  const exportCard = async (aspect='1')=>{
    if(!photoURL){ alert('Add a photo first.'); return; }

    const img = await loadImage(photoURL);
    const pad = 16; // inner chrome spacing in px (visual match to UI)

    // Choose target dimensions; render large for crisp result
    const W = 2048; // width
    const H = (aspect==='1') ? 2048 : Math.round(W * 3/4); // 1:1 or 4:3

    const c = d.getElementById('work'); c.width = W; c.height = H; const cx = c.getContext('2d');
    cx.fillStyle = '#000'; cx.fillRect(0,0,W,H);

    // 1px hairline at export scale
    const hair = Math.max(1, Math.round(W/1024));

    // Bars
    cx.fillStyle = '#000';
    cx.fillRect(0,0,W,24+pad);   // top area
    cx.fillRect(0,H-(24+pad),W,24+pad); // bottom area

    // White border
    cx.strokeStyle = '#fff'; cx.lineWidth = hair; cx.strokeRect(hair/2, hair/2, W-hair, H-hair);

    // Draw image (fit to inner area between bars)
    const topBarH = 24 + pad;
    const botBarH = 24 + pad;
    const innerX = hair; const innerY = topBarH + hair;
    const innerW = W - hair*2; const innerH = H - (topBarH + botBarH) - hair*2;

    // cover strategy
    const imgR = img.width / img.height;
    const boxR = innerW / innerH;
    let dw = innerW, dh = innerH, dx = innerX, dy = innerY;
    if(imgR > boxR){ dh = innerH; dw = dh * imgR; dx = innerX + (innerW-dw)/2; }
    else { dw = innerW; dh = dw / imgR; dy = innerY + (innerH-dh)/2; }

    // BW curve (simple S-curve)
    cx.save();
    cx.drawImage(img, dx, dy, dw, dh);
    const imgData = cx.getImageData(dx,dy,dw,dh);
    const data = imgData.data;
    for(let i=0;i<data.length;i+=4){
      const r=data[i], g=data[i+1], b=data[i+2];
      // luminance
      let y = 0.2126*r + 0.7152*g + 0.0722*b;
      // filmic-ish contrast curve
      y = y/255; y = Math.pow(y, 0.9); y = (y-0.5)*1.1 + 0.5; y = clamp(Math.round(y*255),0,255);
      data[i]=data[i+1]=data[i+2]=y;
    }
    cx.putImageData(imgData, dx, dy);
    cx.restore();

    // Hairlines above/below image
    cx.globalAlpha = .6; cx.fillStyle = '#fff';
    cx.fillRect(0, topBarH, W, hair);
    cx.fillRect(0, H - botBarH - hair, W, hair);
    cx.globalAlpha = 1;

    // Text bars
    cx.fillStyle = '#e6e6e6';
    cx.font = `12px ${monoToggle.checked ? 'JetBrainsMono, SFMono-Regular, monospace' : 'Inter, system-ui, sans-serif'}`;
    cx.textBaseline = 'middle';

    // Top left: title
    const title = (titleIn.value.trim() || '[ title ]').toUpperCase();
    cx.fillText(title, pad, (topBarH/2));

    // Top right: GPS (optional)
    const gps = gpsToggle.checked && gpsText ? gpsText : '';
    if(gps){ rightText(cx, gps, W-pad, topBarH/2); }

    // Bottom left: caption
    const cap = captionIn.value.trim() || '[ short caption goes here ]';
    cx.fillText(cap, pad, H - (botBarH/2));

    // Bottom right: timestamp
    const ts = tsOut.textContent || fmtTime(new Date());
    rightText(cx, ts, W-pad, H - (botBarH/2));

    // Download
    const url = c.toDataURL('image/png');
    const a = d.createElement('a'); a.href = url; a.download = `intoview-${aspect==='1'?'1x1':'4x3'}.png`; a.click();
  };

  function rightText(ctx, text, x, y){
    const w = ctx.measureText(text).width; ctx.fillText(text, x - w, y);
  }

  function loadImage(src){
    return new Promise((res,rej)=>{ const im = new Image(); im.crossOrigin='anonymous'; im.onload=()=>res(im); im.onerror=rej; im.src=src; });
  }

  d.getElementById('export13').addEventListener('click', ()=> exportCard('1'));
  d.getElementById('export43').addEventListener('click', ()=> exportCard('4/3'));

  // Initialize
  tsOut.textContent = fmtTime(new Date());
})();
</script>
</body>
</html>
