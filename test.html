<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5.0,user-scalable=yes" />
  <title>intoview:NODE</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    /* ---------------------------
       THEME / ROOT
       --------------------------- */
    :root {
      /* --- CORE THEME VARIABLES --- */
      --bg-color: #0f1014;
      --ink: #ffffff;
      --ink-2: #a1a1aa;
      --ink-3: #52525b;
      --accent: #FFED29;
      
      /* UI Dimensions */
      --corner-pad: clamp(16px, 3vw, 32px);
      --fab-size: 64px;
      
      /* Glassmorphism Logic */
      --glass-bg: rgba(20, 20, 25, 0.6);
      --glass-bg-hover: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.1);
      --glass-blur: 16px;
      
      /* Depth */
      --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.5);
      
      /* Transitions */
      --ease-out: cubic-bezier(0.215, 0.61, 0.355, 1);
      
      /* Z-index layers */
      --z-ui: 220;
      --z-overlay: 250;
    }

    [data-theme="light"] {
      --bg-color: #f4f4f5;
      --ink: #18181b;
      --ink-2: #52525b;
      --ink-3: #a1a1aa;
      --accent: #FF296D;
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glass-bg-hover: rgba(0, 0, 0, 0.04);
      --glass-border: rgba(0, 0, 0, 0.08);
      --shadow-soft: 0 10px 30px -10px rgba(0,0,0,0.1);
    }

    /* --- ROSE / POP ART THEME --- */
    [data-theme="rose"] {
      --bg-color: #EA426F; 
      --ink: #000000;
      --ink-2: #222222;
      --ink-3: #444444;
      --accent: #000000;
      
      /* Pop Art Overrides - "Card" style */
      --glass-bg: #ffffff;
      --glass-bg-hover: #FFF500; /* Yellow highlight on hover */
      --glass-border: #000000;
      --glass-blur: 0px; /* No blur in pop art */
      --shadow-soft: 6px 6px 0px #000000; /* Hard shadow */
    }

    /* ---------------------------
       Base / layout
       --------------------------- */
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{height:100%; font-family:'Inter',sans-serif; font-size:14px; background:var(--bg-color); color:var(--ink); transition: background 0.3s var(--ease-out), color 0.3s var(--ease-out);}
    body{overflow:hidden}

    /* Keyboard indicator */
    .keyboard-indicator{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));border:2px solid var(--accent);padding:30px 40px;border-radius:12px;z-index:var(--z-overlay);pointer-events:none;transition:transform .18s,opacity .18s;opacity:0;box-shadow:var(--shadow-soft);}
    .keyboard-indicator.show{transform:translate(-50%,-50%) scale(1);opacity:1}
    .keyboard-indicator .key{font-family:'JetBrains Mono',monospace;font-size:48px;font-weight:700;color:var(--accent);text-align:center;margin-bottom:10px}
    .keyboard-indicator .label{font-size:14px;color:var(--ink-2);text-transform:uppercase;letter-spacing:1px;text-align:center}

    /* Nav controls */
    .top-nav,.right-nav,.left-nav{position:fixed;z-index:calc(var(--z-ui) + 2);background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border);border-radius:12px;display:flex;gap:8px;padding:8px;box-shadow:var(--shadow-soft);transition:all 0.3s var(--ease-out);}
    .top-nav{top:var(--corner-pad);left:50%;transform:translateX(-50%)}
    .left-nav{left:var(--corner-pad);top:50%;transform:translateY(-50%);flex-direction:column}
    .right-nav{right:var(--corner-pad);top:50%;transform:translateY(-50%);flex-direction:column}
    .nav-btn{padding:10px 18px;background:transparent;border:0;color:var(--ink);cursor:pointer;border-radius:8px;font-weight:600;white-space:nowrap;font-size:14px;transition:all 0.2s var(--ease-out);}
    .nav-btn:hover{background:var(--glass-bg-hover)}
    .nav-btn.active{background:var(--accent);color:#000;font-weight:700;}

    /* Theme Toggle - Top Right */
    .theme-toggle{position:fixed;top:var(--corner-pad);right:var(--corner-pad);z-index:calc(var(--z-ui) + 10);background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border);border-radius:12px;padding:8px;display:flex;gap:6px;box-shadow:var(--shadow-soft);transition:all 0.3s var(--ease-out);}
    .theme-btn{width:40px;height:40px;border-radius:8px;background:transparent;border:0;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all 0.2s var(--ease-out);}
    .theme-btn:hover{background:var(--glass-bg-hover);transform:scale(1.05);}
    .theme-btn.active{background:var(--accent);}

    /* Zoom Controls - Bottom Left */
    .zoom-controls{position:fixed;bottom:var(--corner-pad);left:var(--corner-pad);z-index:calc(var(--z-ui) + 10);display:flex;gap:8px;opacity:0;pointer-events:none;transition:opacity 0.3s var(--ease-out);}
    .zoom-controls.active{opacity:1;pointer-events:auto;}
    .zoom-btn{width:48px;height:48px;border-radius:12px;background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border);display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700;font-size:20px;color:var(--ink);box-shadow:var(--shadow-soft);transition:all 0.2s var(--ease-out);}
    .zoom-btn:hover{transform:translateY(-3px);background:var(--glass-bg-hover);}

    /* FAB */
    .fab-wrap{position:fixed;bottom:var(--corner-pad);left:50%;transform:translateX(-50%);z-index:calc(var(--z-ui) + 5);display:flex;align-items:center;gap:14px;pointer-events:none;}
    .fab{pointer-events:auto;width:var(--fab-size);height:var(--fab-size);border-radius:50%;background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow-soft);transition:all 0.2s var(--ease-out);}
    .fab:hover{transform:scale(1.08);background:var(--glass-bg-hover);}
    .fab svg{width:calc(var(--fab-size) * 0.4);height:calc(var(--fab-size) * 0.4);fill:var(--accent);transition:fill 0.3s var(--ease-out);}
    .fab-label{pointer-events:none;font-weight:700;color:var(--ink);font-size:14px;opacity:0;transform:translateY(6px);transition:opacity .18s,transform .18s;white-space:nowrap;}
    @media (min-width:900px){
      .fab-label{opacity:1;transform:none;}
    }

    /* Container + grid */
    .grid-container{position:absolute;inset:80px 20px 20px 20px;overflow-y:auto;overflow-x:hidden;opacity:0;pointer-events:none;transition:opacity 0.3s var(--ease-out);}
    .grid-container.active{opacity:1;pointer-events:auto;}
    .grid-wrapper{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;padding:20px;max-width:1600px;margin:0 auto;}
    
    .card{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.25s var(--ease-out);min-height:180px;display:flex;flex-direction:column;box-shadow:var(--shadow-soft);backdrop-filter:blur(var(--glass-blur));}
    .card:hover{transform:translateY(-4px);box-shadow:0 20px 60px -10px rgba(0,0,0,0.4);border-color:var(--accent);}
    .card-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:15px}
    .card-provider{font-size:20px;font-weight:700;color:var(--accent)}
    .card-status{padding:6px 14px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;border:1px solid var(--glass-border);background:var(--glass-bg);}
    .card-info{flex:1;display:flex;flex-direction:column;gap:8px}
    .card-footer{margin-top:auto;padding-top:15px;border-top:1px solid var(--glass-border)}
    .card-label{font-size:12px;color:var(--ink-2);display:flex;align-items:center;gap:8px}
    .card-label strong{color:var(--ink);font-weight:600}

    /* Status colors */
    .status-active .card-status{background:rgba(34,197,94,0.15);color:#22c55e;border-color:#22c55e;}
    .status-cooldown .card-status{background:rgba(251,146,60,0.15);color:#fb923c;border-color:#fb923c;}
    .status-burnt .card-status{background:rgba(239,68,68,0.15);color:#ef4444;border-color:#ef4444;}

    /* Scatter */
    .scatter-container{position:absolute;inset:0;opacity:0;pointer-events:none;transition:opacity .3s;overflow:hidden}
    .scatter-container.active{opacity:1;pointer-events:auto}
    .scatter-canvas{width:100%;height:100%;position:relative;transform-origin:center center;transition:transform .12s ease-out}
    .scatter-card{position:absolute;background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border);border-radius:12px;padding:16px;cursor:grab;transition:box-shadow .18s,border-color .18s;width:240px;user-select:none;touch-action:none;box-shadow:var(--shadow-soft);}
    .scatter-card:active{cursor:grabbing}
    .scatter-card.dragging{box-shadow:0 16px 48px rgba(0,0,0,.6);border-color:var(--accent);z-index:2000}
    .scatter-card.magnetic{transition:transform .15s cubic-bezier(.2,.9,.3,1);}

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);z-index:var(--z-overlay);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s}
    .modal-overlay.active{opacity:1;pointer-events:auto}
    .modal{background:var(--bg-color);border:1px solid var(--glass-border);border-radius:16px;padding:40px;max-width:560px;width:92%;max-height:90vh;overflow-y:auto;transform:scale(.96);transition:transform .22s;box-shadow:0 25px 50px -12px rgba(0,0,0,0.7);}
    .modal-overlay.active .modal{transform:scale(1)}
    .modal h2{color:var(--accent);margin-bottom:24px;font-family:'JetBrains Mono',monospace;font-size:24px;}
    .form-group{margin-bottom:20px}
    label{display:block;margin-bottom:8px;font-size:14px;color:var(--ink-2);font-weight:600}
    input,select{width:100%;padding:14px;background:var(--glass-bg);border:1px solid var(--glass-border);color:var(--ink);border-radius:8px;font-size:14px;transition:border-color 0.2s var(--ease-out);}
    input:focus,select:focus{outline:none;border-color:var(--accent);}
    .btn-submit{width:100%;padding:16px;background:var(--accent);color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;font-size:14px;transition:all 0.2s var(--ease-out);}
    .btn-submit:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,0.3);}
    .close-modal{position:absolute;top:20px;right:20px;background:transparent;border:0;color:var(--ink);font-size:32px;cursor:pointer;opacity:.7;transition:opacity 0.2s;}
    .close-modal:hover{opacity:1;}

    .magnet-indicator{position:fixed;width:120px;height:120px;border:3px solid var(--accent);border-radius:50%;pointer-events:none;z-index:calc(var(--z-ui) + 5);opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity 0.15s;box-shadow:0 0 30px var(--accent);}
    .magnet-indicator.active{opacity:.7;animation:pulse 1.5s ease-in-out infinite;}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
    .magnet-indicator::before{content:'üß≤';font-size:48px}

    ::-webkit-scrollbar{width:8px}
    ::-webkit-scrollbar-thumb{background:rgba(255,255,255,.16);border-radius:4px}
    ::-webkit-scrollbar-track{background:transparent}

    @media (prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important}}
  </style>
</head>
<body data-theme="dark">

  <div id="keyboardIndicator" class="keyboard-indicator" aria-hidden="true">
    <div class="key" id="indicatorKey">N</div>
    <div class="label" id="indicatorLabel">New Item</div>
  </div>

  <!-- Theme Toggle - Top Right -->
  <div class="theme-toggle" role="toolbar" aria-label="Theme selector">
    <button class="theme-btn active" data-theme="dark" title="Dark Theme">üåô</button>
    <button class="theme-btn" data-theme="light" title="Light Theme">‚òÄÔ∏è</button>
    <button class="theme-btn" data-theme="rose" title="Rose Theme">üåπ</button>
  </div>

  <!-- Top Nav - All Providers -->
  <div class="top-nav" role="toolbar" aria-label="Provider filter">
    <button class="nav-btn active" data-provider="all">All</button>
    <button class="nav-btn" data-provider="ChatGPT">ChatGPT</button>
    <button class="nav-btn" data-provider="Claude">Claude</button>
    <button class="nav-btn" data-provider="Gemini">Gemini</button>
    <button class="nav-btn" data-provider="Grok">Grok</button>
    <button class="nav-btn" data-provider="Copilot">Copilot</button>
  </div>

  <div class="left-nav" role="tablist" aria-label="View switch">
    <button class="nav-btn active" data-view="grid">Grid</button>
    <button class="nav-btn" data-view="scatter">Scatter</button>
  </div>

  <div class="right-nav" role="toolbar" aria-label="Status filter">
    <button class="nav-btn active" data-status="all">All</button>
    <button class="nav-btn" data-status="active">Active</button>
    <button class="nav-btn" data-status="cooldown">Cooldown</button>
    <button class="nav-btn" data-status="burnt">Burnt</button>
  </div>

  <!-- Zoom Controls - Bottom Left -->
  <div class="zoom-controls" id="zoomControls">
    <button class="zoom-btn" id="zoomIn" aria-label="Zoom in">+</button>
    <button class="zoom-btn" id="zoomReset" aria-label="Reset zoom">‚ü≤</button>
    <button class="zoom-btn" id="zoomOut" aria-label="Zoom out">‚àí</button>
  </div>

  <!-- FAB - Bottom Center -->
  <div class="fab-wrap">
    <button class="fab" id="fabBtn" title="New Item (N)" aria-label="Create new item">
      <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"></path></svg>
    </button>
    <div class="fab-label">Add Node</div>
  </div>

  <div class="container">
    <div class="grid-container active" id="gridContainer">
      <div class="grid-wrapper" id="gridWrapper"></div>
    </div>

    <div class="scatter-container" id="scatterContainer">
      <div class="scatter-canvas" id="scatterCanvas"></div>
    </div>
  </div>

  <div class="magnet-indicator" id="magnetIndicator"></div>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <button class="close-modal" id="closeModal">&times;</button>
      <h2>Add New Item</h2>
      <form id="addForm">
        <div class="form-group">
          <label for="formProvider">Provider</label>
          <select id="formProvider" required>
            <option value="ChatGPT">OpenAI (ChatGPT)</option>
            <option value="Claude">Anthropic (Claude)</option>
            <option value="Gemini">Google (Gemini)</option>
            <option value="Grok">xAI (Grok)</option>
            <option value="Copilot">Microsoft (Copilot)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="formEmail">Email / Username</label>
          <input id="formEmail" type="email" required>
        </div>
        <div class="form-group">
          <label for="formPassword">Password</label>
          <input id="formPassword" type="password" required>
        </div>
        <div class="form-group">
          <label for="formResetHours">Reset Hours</label>
          <input id="formResetHours" type="number" value="3" min="0.5" step="0.5" required>
        </div>
        <div class="form-group">
          <label for="formStatus">Status</label>
          <select id="formStatus" required>
            <option value="active">Active</option>
            <option value="cooldown">Cooldown</option>
            <option value="burnt">Burnt/Expired</option>
          </select>
        </div>
        <button type="submit" class="btn-submit">Create Item</button>
      </form>
    </div>
  </div>

  <script>
    let items = [];
    let currentView = 'grid';
    let currentProviderFilter = 'all';
    let currentStatusFilter = 'all';
    let currentTheme = 'dark';
    let scatterZoom = 1;
    let isDragging = false;
    let draggedCard = null;
    let dragOffset = { x: 0, y: 0 };
    let isMagnetic = false;
    let magnetPos = { x: 0, y: 0 };
    let magneticAnimationFrame = null;
    let magneticDelayTimer = null;

    function generateMockData() {
      const providers = ['ChatGPT', 'Claude', 'Gemini', 'Grok', 'Copilot'];
      const statuses = ['active', 'cooldown', 'burnt'];
      return Array.from({ length: 15 }, (_, i) => ({
        id: Date.now() + i,
        provider: providers[i % providers.length],
        email: `user${i + 1}@example.com`,
        password: `password${i + 1}`,
        resetHours: 3 + (i % 4),
        status: statuses[i % statuses.length],
        position: {
          x: Math.random() * Math.max(0, window.innerWidth - 260),
          y: Math.random() * Math.max(0, window.innerHeight - 220)
        }
      }));
    }

    items = generateMockData();

    // Theme handling
    function setTheme(theme) {
      currentTheme = theme;
      document.body.setAttribute('data-theme', theme);
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      localStorage.setItem('preferred-theme', theme);
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('preferred-theme') || 'dark';
    setTheme(savedTheme);

    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.addEventListener('click', () => setTheme(btn.dataset.theme));
    });

    // Keyboard shortcuts
    function showKeyboardIndicator(key, label) {
      const indicator = document.getElementById('keyboardIndicator');
      document.getElementById('indicatorKey').textContent = key;
      document.getElementById('indicatorLabel').textContent = label;
      indicator.classList.add('show');
      setTimeout(() => indicator.classList.remove('show'), 800);
    }

    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
      
      if (e.key === 'n' || e.key === 'N') {
        e.preventDefault();
        showKeyboardIndicator('N', 'New Item');
        openModal();
      } else if (e.key === ' ') {
        e.preventDefault();
        showKeyboardIndicator('SPACE', 'Toggle Filters');
        toggleFilters();
      }
    });

    function toggleFilters() {
      const statuses = ['all', 'active', 'cooldown', 'burnt'];
      const idx = statuses.indexOf(currentStatusFilter);
      currentStatusFilter = statuses[(idx + 1) % statuses.length];
      document.querySelectorAll('.right-nav .nav-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.status === currentStatusFilter);
      });
      renderView();
    }

    // Modal
    function openModal() {
      document.getElementById('modalOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    document.getElementById('fabBtn').addEventListener('click', openModal);
    document.getElementById('closeModal').addEventListener('click', closeModal);
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeModal();
    });

    function getFilteredItems() {
      return items.filter(item => {
        const p = currentProviderFilter === 'all' || item.provider === currentProviderFilter;
        const s = currentStatusFilter === 'all' || item.status === currentStatusFilter;
        return p && s;
      });
    }

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      }[m]));
    }

    function renderGrid() {
      const wrapper = document.getElementById('gridWrapper');
      const filtered = getFilteredItems();
      wrapper.innerHTML = filtered.map(item => `
        <div class="card status-${item.status}" data-id="${item.id}">
          <div class="card-header">
            <div class="card-provider">${escapeHtml(item.provider)}</div>
            <div class="card-status">${escapeHtml(item.status)}</div>
          </div>
          <div class="card-info">
            <div style="color:var(--ink-2);font-size:14px;margin-bottom:10px">Reset: ${item.resetHours}h</div>
          </div>
          <div class="card-footer">
            <div class="card-label"><strong>Provider:</strong> ${escapeHtml(item.provider)}</div>
            <div class="card-label"><strong>Email:</strong> ${escapeHtml(item.email)}</div>
          </div>
        </div>
      `).join('');
    }

    function renderScatter() {
      const canvas = document.getElementById('scatterCanvas');
      const filtered = getFilteredItems();
      const existing = Array.from(canvas.querySelectorAll('.scatter-card'));
      const posMap = new Map();
      
      existing.forEach(card => {
        const id = Number(card.dataset.id);
        const transform = card.style.transform;
        const match = transform.match(/translate3d\((.+)px,\s*(.+)px/);
        if (match) {
          posMap.set(id, { x: parseFloat(match[1]), y: parseFloat(match[2]) });
        }
      });

      canvas.innerHTML = filtered.map(item => {
        const pos = posMap.get(item.id) || item.position;
        return `
          <div class="scatter-card status-${item.status}" data-id="${item.id}" style="transform:translate3d(${pos.x}px,${pos.y}px,0)">
            <div class="card-header">
              <div class="card-provider">${escapeHtml(item.provider)}</div>
              <div class="card-status">${escapeHtml(item.status)}</div>
            </div>
            <div class="card-footer" style="border:none;padding-top:10px">
              <div class="card-label"><strong>${escapeHtml(item.provider)}</strong></div>
              <div class="card-label" style="font-size:11px">${escapeHtml(item.email)}</div>
            </div>
          </div>
        `;
      }).join('');

      attachScatterHandlers();
    }

    function attachScatterHandlers() {
      document.querySelectorAll('.scatter-card').forEach(card => {
        card.addEventListener('pointerdown', startDrag);
      });
    }

    function startDrag(e) {
      if (e.button === 2) return;
      draggedCard = e.currentTarget;
      isDragging = true;
      draggedCard.classList.add('dragging');
      const rect = draggedCard.getBoundingClientRect();
      dragOffset.x = e.clientX - rect.left;
      dragOffset.y = e.clientY - rect.top;
      e.preventDefault();
    }

    document.addEventListener('pointermove', (e) => {
      if (!isDragging || !draggedCard) return;
      const canvas = document.getElementById('scatterCanvas');
      const canvasRect = canvas.getBoundingClientRect();
      const x = (e.clientX - canvasRect.left - dragOffset.x) / scatterZoom;
      const y = (e.clientY - canvasRect.top - dragOffset.y) / scatterZoom;
      draggedCard.style.transform = `translate3d(${x}px,${y}px,0)`;
      const id = Number(draggedCard.dataset.id);
      const item = items.find(i => i.id === id);
      if (item) item.position = { x, y };
    });

    document.addEventListener('pointerup', () => {
      if (draggedCard) draggedCard.classList.remove('dragging');
      isDragging = false;
      draggedCard = null;
    });

    // Magnetic gathering with smooth animation loop
    document.addEventListener('contextmenu', (e) => {
      if (currentView === 'scatter') e.preventDefault();
    });

    function startMagneticEffect() {
      isMagnetic = true;
      document.getElementById('magnetIndicator').classList.add('active');
      
      // Animation loop for smooth magnetic pull
      function magnetLoop() {
        if (!isMagnetic) return;
        
        const cards = document.querySelectorAll('.scatter-card');
        cards.forEach(card => {
          card.classList.add('magnetic');
          const rect = card.getBoundingClientRect();
          const cardCenterX = rect.left + rect.width / 2;
          const cardCenterY = rect.top + rect.height / 2;
          
          const dx = magnetPos.x - cardCenterX;
          const dy = magnetPos.y - cardCenterY;
          const dist = Math.hypot(dx, dy);
          
          if (dist > 60) {
            const pull = Math.min(0.35, 150 / Math.max(1, dist));
            const transform = card.style.transform;
            const match = transform.match(/translate3d\(([^p]+)px,\s*([^p]+)px/);
            
            if (match) {
              const currentX = parseFloat(match[1]);
              const currentY = parseFloat(match[2]);
              const newX = currentX + dx * pull;
              const newY = currentY + dy * pull;
              card.style.transform = `translate3d(${newX}px,${newY}px,0)`;
              
              const id = Number(card.dataset.id);
              const item = items.find(i => i.id === id);
              if (item) item.position = { x: newX, y: newY };
            }
          }
        });
        
        magneticAnimationFrame = requestAnimationFrame(magnetLoop);
      }
      
      magnetLoop();
    }

    function stopMagneticEffect() {
      isMagnetic = false;
      document.getElementById('magnetIndicator').classList.remove('active');
      document.querySelectorAll('.scatter-card').forEach(c => c.classList.remove('magnetic'));
      if (magneticAnimationFrame) {
        cancelAnimationFrame(magneticAnimationFrame);
        magneticAnimationFrame = null;
      }
    }

    document.addEventListener('pointerdown', (e) => {
      if (e.button === 2 && currentView === 'scatter') {
        clearTimeout(magneticDelayTimer);
        magneticDelayTimer = setTimeout(() => {
          startMagneticEffect();
        }, 200); // 200ms delay to prevent accidental activation
      }
    });

    document.addEventListener('pointerup', (e) => {
      if (e.button === 2) {
        clearTimeout(magneticDelayTimer);
        stopMagneticEffect();
      }
    });

    document.addEventListener('pointermove', (e) => {
      magnetPos = { x: e.clientX, y: e.clientY };
      
      if (isMagnetic && currentView === 'scatter') {
        const indicator = document.getElementById('magnetIndicator');
        indicator.style.left = `${e.clientX - 60}px`;
        indicator.style.top = `${e.clientY - 60}px`;
      }
    });

    // Touch hold for magnet on mobile
    let touchHoldTimer;
    document.addEventListener('touchstart', (e) => {
      if (currentView === 'scatter' && e.touches.length === 1) {
        const touch = e.touches[0];
        magnetPos = { x: touch.clientX, y: touch.clientY };
        
        touchHoldTimer = setTimeout(() => {
          startMagneticEffect();
          const indicator = document.getElementById('magnetIndicator');
          indicator.style.left = `${touch.clientX - 60}px`;
          indicator.style.top = `${touch.clientY - 60}px`;
        }, 500);
      }
    });

    document.addEventListener('touchmove', (e) => {
      if (isMagnetic && currentView === 'scatter' && e.touches.length === 1) {
        const touch = e.touches[0];
        magnetPos = { x: touch.clientX, y: touch.clientY };
        
        const indicator = document.getElementById('magnetIndicator');
        indicator.style.left = `${touch.clientX - 60}px`;
        indicator.style.top = `${touch.clientY - 60}px`;
        e.preventDefault();
      }
    });

    document.addEventListener('touchend', () => {
      clearTimeout(touchHoldTimer);
      stopMagneticEffect();
    });

    // Zoom controls
    function updateZoom(delta) {
      scatterZoom = Math.max(0.5, Math.min(3, scatterZoom + delta));
      document.getElementById('scatterCanvas').style.transform = `scale(${scatterZoom})`;
    }

    document.getElementById('zoomIn').addEventListener('click', () => updateZoom(0.2));
    document.getElementById('zoomOut').addEventListener('click', () => updateZoom(-0.2));
    document.getElementById('zoomReset').addEventListener('click', () => {
      scatterZoom = 1;
      document.getElementById('scatterCanvas').style.transform = 'scale(1)';
    });

    document.getElementById('scatterContainer').addEventListener('wheel', (e) => {
      if (currentView === 'scatter') {
        e.preventDefault();
        updateZoom(e.deltaY > 0 ? -0.1 : 0.1);
      }
    }, { passive: false });

    // Pinch zoom
    let initialPinchDistance = 0;
    document.getElementById('scatterContainer').addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];
        initialPinchDistance = Math.hypot(
          touch2.clientX - touch1.clientX,
          touch2.clientY - touch1.clientY
        );
      }
    });

    document.getElementById('scatterContainer').addEventListener('touchmove', (e) => {
      if (e.touches.length === 2) {
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];
        const currentDistance = Math.hypot(
          touch2.clientX - touch1.clientX,
          touch2.clientY - touch1.clientY
        );
        const delta = (currentDistance - initialPinchDistance) * 0.01;
        updateZoom(delta);
        initialPinchDistance = currentDistance;
        e.preventDefault();
      }
    });

    // View switching
    function switchView(view) {
      currentView = view;
      const grid = document.getElementById('gridContainer');
      const scatter = document.getElementById('scatterContainer');
      const zoom = document.getElementById('zoomControls');
      
      if (view === 'grid') {
        grid.classList.add('active');
        scatter.classList.remove('active');
        zoom.classList.remove('active');
      } else {
        grid.classList.remove('active');
        scatter.classList.add('active');
        zoom.classList.add('active');
      }
      renderView();
    }

    function renderView() {
      if (currentView === 'grid') renderGrid();
      else renderScatter();
    }

    // Navigation
    document.querySelectorAll('.left-nav .nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.left-nav .nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        switchView(btn.dataset.view);
      });
    });

    document.querySelectorAll('.top-nav .nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.top-nav .nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentProviderFilter = btn.dataset.provider;
        renderView();
      });
    });

    document.querySelectorAll('.right-nav .nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.right-nav .nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentStatusFilter = btn.dataset.status;
        renderView();
      });
    });

    // Form submission
    document.getElementById('addForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const newItem = {
        id: Date.now(),
        provider: document.getElementById('formProvider').value,
        email: document.getElementById('formEmail').value,
        password: document.getElementById('formPassword').value,
        resetHours: parseFloat(document.getElementById('formResetHours').value),
        status: document.getElementById('formStatus').value,
        position: {
          x: Math.random() * Math.max(0, window.innerWidth - 260),
          y: Math.random() * Math.max(0, window.innerHeight - 220)
        }
      };
      items.push(newItem);
      closeModal();
      e.target.reset();
      renderView();
    });

    // Initialize
    renderView();
    window.addEventListener('resize', () => {
      if (currentView === 'grid') renderGrid();
      else renderScatter();
    });
  </script>
</body>
</html>
