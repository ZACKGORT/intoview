<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5.0,user-scalable=yes" />
  <title>intoview:NODE</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    /* ---------------------------
       THEME / ROOT (user requested)
       --------------------------- */
    :root {
        /* DEFAULT DARK THEME */
        --bg-color: #0f1014;
        --card-color: transparent;
        --ink: #ffffff;
        --ink-2: #9f9f9f;
        --ink-3: #6c6c6c;
        --accent: #83ff83;
        --curve-k: 1;
        --vig-opacity: .9;
        --edge-blur: 2.8px;
        --cursor-size: 20px;
        --corner-pad: clamp(14px, 2.4vw, 24px);
        --corner-top: calc(env(safe-area-inset-top) + clamp(12px, 2vh, 18px));
        --z-grain: 149;
        --z-blur: 150;
        --z-vig: 151;
        --z-ui: 220;
        --z-overlay: 250;
        --z-cursor: 230;
        --glass-bg: rgba(255, 255, 255, 0.04);
        --glass-bg-hover: rgba(255, 255, 255, 0.08);
        --glass-bg-bright: rgba(255, 255, 255, 0.12);
        --glass-border: rgba(255, 255, 255, 0.12);
        --fab-size: 80px;
        --fab-bottom: calc(env(safe-area-inset-bottom) + clamp(16px, 3vh, 32px));
        --base-font-size: 14px;
        --subtle-outline: rgba(255, 255, 255, 0.08);
        --font-stack: Inter, ui-sans-serif, system-ui;
    }

    [data-theme="light"] {
      --bg-color: #f8f8f8;
      --ink: #0f1014;
      --ink-2: #444444;
      --ink-3: #777777;
      --accent: #000000;
      --glass-bg: rgba(255, 255, 255, 0.98);
      --glass-bg-hover: rgba(255, 255, 255, 1);
      --glass-bg-bright: rgba(255, 255, 255, 1);
      --glass-border: rgba(0, 0, 0, 0.15);
      --vig-opacity: 0.5;
      --subtle-outline: rgba(0, 0, 0, 0.05);
      color-scheme: light;
    }

    [data-theme="rose"] {
      --bg-color: #FF8DA1;
      --ink: #000000;
      --ink-2: #222222;
      --ink-3: #444444;
      --accent: #000000;
      --glass-bg: rgba(255, 255, 255, 0.75);
      --glass-bg-hover: rgba(255, 255, 255, 0.5);
      --glass-bg-bright: rgba(255, 255, 255, 0.6);
      --glass-border: rgba(0, 0, 0, 0.1);
      --vig-opacity: 0.2;
      --subtle-outline: rgba(0, 0, 0, 0.05);
      color-scheme: light;
    }

    [data-theme="bauhaus"] {
      --bg-color: #f4f4f4;
      --ink: #111111;
      --ink-2: #333333;
      --ink-3: #555555;
      --accent: #000000;
      --glass-bg: rgba(255, 255, 255, 0.98);
      --glass-bg-hover: #ffffff;
      --glass-bg-bright: #ffffff;
      --glass-border: #111111;
      --vig-opacity: 0;
      --subtle-outline: #111111;
      --font-stack: "Helvetica Neue", Helvetica, Arial, sans-serif;
      color-scheme: light;
    }

    [data-theme="typographic"] {
      --bg-color: #f8f8f8;
      --ink: #0f1014;
      --ink-2: #444444;
      --ink-3: #777777;
      --accent: #000000;
      --glass-bg: transparent;
      --glass-bg-hover: #ffffff;
      --glass-border: transparent;
      --vig-opacity: 0;
      --subtle-outline: #000;
      --font-stack: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color-scheme: light;
    }

    /* ---------------------------
       Base / layout
       --------------------------- */
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{height:100%; font-family:var(--font-stack); font-size:var(--base-font-size); background:var(--bg-color); color:var(--ink);}
    body{overflow:hidden}

    .logo{position:fixed;top:var(--corner-top);left:var(--corner-pad);pointer-events:none;z-index:var(--z-ui)}
    .logo img{height:32px;width:auto;display:block;transition:opacity .2s ease}

    /* Keyboard indicator */
    .keyboard-indicator{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:rgba(0,0,0,.95);border:2px solid var(--accent);padding:30px 40px;border-radius:12px;z-index:var(--z-overlay);pointer-events:none;transition:transform .18s,opacity .18s;opacity:0}
    .keyboard-indicator.show{transform:translate(-50%,-50%) scale(1);opacity:1}
    .keyboard-indicator .key{font-family:'JetBrains Mono',monospace;font-size:48px;font-weight:700;color:var(--accent);text-align:center;margin-bottom:10px}
    .keyboard-indicator .label{font-size:14px;color:var(--ink-2);text-transform:uppercase;letter-spacing:1px;text-align:center}

    /* Nav controls */
    .top-nav,.right-nav,.left-nav{position:fixed;z-index:calc(var(--z-ui) + 2);background:var(--glass-bg);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:8px;display:flex;gap:8px;padding:6px}
    .top-nav{top:var(--corner-top);left:50%;transform:translateX(-50%)}
    .left-nav{left:var(--corner-pad);top:50%;transform:translateY(-50%);flex-direction:column}
    .right-nav{right:var(--corner-pad);top:50%;transform:translateY(-50%);flex-direction:column}
    .nav-btn{padding:10px 20px;background:transparent;border:0;color:var(--ink);cursor:pointer;border-radius:4px;font-weight:600;white-space:nowrap;font-size:14px}
    .nav-btn:hover{background:var(--glass-bg-hover)}
    .nav-btn.active{background:rgba(131,255,131,.12);color:var(--accent)}

    /* FAB: centered on desktop, bottom-right on small screens */
    .fab-wrap { position:fixed; bottom:var(--fab-bottom); left:auto; right:var(--corner-pad); z-index:calc(var(--z-ui) + 5); display:flex; align-items:center; gap:12px; pointer-events: none; }
    .fab { pointer-events: auto; width:var(--fab-size); height:var(--fab-size); border-radius:50%; background:var(--glass-bg); backdrop-filter:blur(8px); border:1px solid var(--glass-border); display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow: 0 8px 32px rgba(0,0,0,0.45); transition:transform .18s ease, background .18s ease; }
    .fab:hover{ transform:scale(1.06); background:var(--glass-bg-hover); }
    .fab svg{width:calc(var(--fab-size) * 0.35); height:calc(var(--fab-size) * 0.35); fill:var(--accent) }

    .fab-label { pointer-events: none; font-weight:700; color:var(--ink); font-size:13px; opacity:0; transform:translateY(6px); transition:opacity .18s, transform .18s; white-space:nowrap; }
    /* show label on larger screens and keep it visually separate */
    @media (min-width:900px){
      .fab-wrap { left:50%; right:auto; transform:translateX(-50%); bottom:calc(var(--fab-bottom) + 6px); gap:14px; }
      .fab-label { opacity:1; transform:none; pointer-events:none; }
    }

    /* allow smaller touch target on mobile while still readable */
    @media (max-width:899px){
      .fab { width:64px; height:64px; }
      .fab svg{ width:22px; height:22px; }
    }

    /* Container + grid */
        /* Grid View */
        .grid-container {
            position: absolute;
            inset: 80px 20px 20px 20px;
            overflow-y: auto;
            overflow-x: hidden;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .grid-container.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .grid-wrapper {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
    .card{background:var(--card-color);border:1px solid var(--glass-border);border-radius:12px;padding:20px;cursor:pointer;transition:transform .22s,box-shadow .22s,border-color .22s;min-height:180px;display:flex;flex-direction:column}
    .card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.45);border-color:var(--accent)}
    .card-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:15px}
    .card-provider{font-size:20px;font-weight:700;color:var(--accent)}
    .card-status{padding:4px 12px;border-radius:12px;font-size:11px;font-weight:700;text-transform:uppercase}
    .card-info{flex:1;display:flex;flex-direction:column;gap:8px}
    .card-footer{margin-top:auto;padding-top:15px;border-top:1px solid var(--glass-border)}
    .card-label{font-size:12px;color:var(--ink-2);display:flex;align-items:center;gap:8px}
    .card-label strong{color:var(--ink);font-weight:600}

    /* Scatter */
    .scatter-container{position:absolute;inset:0;opacity:0;pointer-events:none;transition:opacity .3s;overflow:hidden}
    .scatter-container.active{opacity:1;pointer-events:auto}
    .scatter-canvas{width:100%;height:100%;position:relative;transform-origin:center center;transition:transform .12s ease-out}
    .scatter-card{position:absolute;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:12px;padding:16px;cursor:grab;transition:box-shadow .18s,border-color .18s,left .06s,top .06s; width:240px; user-select:none; touch-action:none}
    .scatter-card:active{cursor:grabbing}
    .scatter-card.dragging{box-shadow:0 12px 32px rgba(0,0,0,.6);border-color:var(--accent);z-index:2000}
    .scatter-card.magnetic{transition:all .22s cubic-bezier(.2,.9,.3,1)}

    /* Zoom controls â€” CLAMPED TOP RIGHT */
    .zoom-controls { position: fixed; top: var(--corner-top); right: var(--corner-pad); z-index: calc(var(--z-ui) + 10); display:flex; flex-direction:row; gap:8px; align-items:center; pointer-events:auto; }
    .zoom-controls .zoom-btn { width:44px; height:44px; border-radius:8px; background:var(--glass-bg); border:1px solid var(--glass-border); display:flex; align-items:center; justify-content:center; cursor:pointer; font-weight:700; font-size:18px; color:var(--ink); box-shadow: 0 6px 18px rgba(0,0,0,0.36); transition:transform .12s }
    .zoom-controls .zoom-btn:hover { transform: translateY(-3px); background:var(--glass-bg-hover); }

    /* Modal / magnet / etc (keeps previous behavior) */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(4px);z-index:var(--z-overlay);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s}
    .modal-overlay.active{opacity:1;pointer-events:auto}
    .modal{background:var(--bg-color);border:1px solid var(--glass-border);border-radius:12px;padding:30px;max-width:560px;width:92%;max-height:90vh;overflow-y:auto;transform:scale(.96);transition:transform .22s}
    .modal-overlay.active .modal{transform:scale(1)}
    .modal h2{color:var(--accent);margin-bottom:20px;font-family:'JetBrains Mono',monospace}
    .form-group{margin-bottom:18px}
    label{display:block;margin-bottom:8px;font-size:14px;color:var(--ink-2);font-weight:600}
    input,select{width:100%;padding:12px;background:var(--glass-bg);border:1px solid var(--glass-border);color:var(--ink);border-radius:6px;font-size:14px}
    .btn-submit{width:100%;padding:14px;background:var(--accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-weight:700;text-transform:uppercase}
    .close-modal{position:absolute;top:20px;right:20px;background:transparent;border:0;color:var(--ink);font-size:28px;cursor:pointer;opacity:.75}

    .magnet-indicator{position:fixed;width:100px;height:100px;border:3px solid var(--accent);border-radius:50%;pointer-events:none;z-index:calc(var(--z-ui) + 5);opacity:0;display:flex;align-items:center;justify-content:center;animation:pulse 1s infinite}
    .magnet-indicator.active{opacity:.66}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    .magnet-indicator::before{content:'ðŸ§²';font-size:40px}

    ::-webkit-scrollbar{width:8px}
    ::-webkit-scrollbar-thumb{background:rgba(255,255,255,.16);border-radius:4px}
    ::-webkit-scrollbar-track{background:transparent}

    @media (prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important}}
  </style>
</head>
<body>
    <div class="logo">
        <img id="logoImg" src="https://raw.githubusercontent.com/ZACKGORT/intoview/main/intoview-logo-light.svg.svg" alt="IntoView Logo">
        </div>
        

  <div id="keyboardIndicator" class="keyboard-indicator" aria-hidden="true">
    <div class="key" id="indicatorKey">N</div>
    <div class="label" id="indicatorLabel">New Item</div>
  </div>

  <!-- Top / Left / Right nav -->
  <div class="top-nav" role="toolbar" aria-label="Provider filter">
    <button class="nav-btn active" data-provider="all" aria-pressed="true">All Providers</button>
    <button class="nav-btn" data-provider="ChatGPT">ChatGPT</button>
    <button class="nav-btn" data-provider="Claude">Claude</button>
    <button class="nav-btn" data-provider="Gemini">Gemini</button>
    <button class="nav-btn" data-provider="Grok">Grok</button>
  </div>

  <div class="left-nav" role="tablist" aria-label="View switch">
    <button class="nav-btn active" data-view="grid" aria-pressed="true">Grid</button>
    <button class="nav-btn" data-view="scatter" aria-pressed="false">Scatter</button>
  </div>

  <div class="right-nav" role="toolbar" aria-label="Status filter">
    <button class="nav-btn active" data-status="all" aria-pressed="true">All Status</button>
    <button class="nav-btn" data-status="active">Active</button>
    <button class="nav-btn" data-status="cooldown">Cooldown</button>
    <button class="nav-btn" data-status="burnt">Burnt</button>
  </div>

  <!-- Zoom controls (now top-right) -->
  <div class="zoom-controls" id="zoomControls" aria-hidden="true">
    <button class="zoom-btn" id="zoomIn" aria-label="Zoom in">+</button>
    <button class="zoom-btn" id="zoomReset" aria-label="Reset zoom">âŸ²</button>
    <button class="zoom-btn" id="zoomOut" aria-label="Zoom out">âˆ’</button>
  </div>

  <!-- FAB wrapper (for centered label + button) -->
  <div class="fab-wrap" role="group" aria-label="Add Node control">
    <button class="fab" id="fabBtn" title="New Item (N)" aria-haspopup="dialog" aria-controls="modalOverlay" aria-label="Create new item">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"></path></svg>
    </button>
    <div class="fab-label" aria-hidden="true">Add Node</div>
  </div>

  <div class="container">
    <div class="grid-container active" id="gridContainer" tabindex="0">
      <div class="grid-wrapper" id="gridWrapper" role="list"></div>
    </div>

    <div class="scatter-container" id="scatterContainer" aria-hidden="true">
      <div class="scatter-canvas" id="scatterCanvas"></div>
    </div>
  </div>

  <div class="magnet-indicator" id="magnetIndicator" aria-hidden="true"></div>

  <div class="modal-overlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
    <div class="modal" role="document">
      <button class="close-modal" id="closeModal" aria-label="Close">&times;</button>
      <h2 id="modalTitle">Add New Item</h2>
      <form id="addForm">
        <div class="form-group">
          <label for="formProvider">Provider</label>
          <select id="formProvider" required>
            <option value="ChatGPT">OpenAI (ChatGPT)</option>
            <option value="Claude">Anthropic (Claude)</option>
            <option value="Gemini">Google (Gemini)</option>
            <option value="Grok">xAI (Grok)</option>
            <option value="Copilot">Microsoft (Copilot)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="formEmail">Email / Username</label>
          <input id="formEmail" type="email" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="formPassword">Password</label>
          <input id="formPassword" type="password" required autocomplete="new-password">
          <small style="color:var(--ink-2);display:block;margin-top:6px">Passwords are never stored locally by this demo.</small>
        </div>
        <div class="form-group">
          <label for="formResetHours">Reset Hours</label>
          <input id="formResetHours" type="number" value="3" min="0.5" step="0.5" required>
        </div>
        <div class="form-group">
          <label for="formStatus">Status</label>
          <select id="formStatus" required>
            <option value="active">Active</option>
            <option value="cooldown">Cooldown</option>
            <option value="burnt">Burnt/Expired</option>
          </select>
        </div>
        <button type="submit" class="btn-submit">Create Item</button>
      </form>
    </div>
  </div>

  <script>
    // (Unchanged app JS -- same logic as your previous version)
    // For brevity I include the full JS from your prior file but unchanged except for minimal adjustments:
    let items = [];
    let currentView = 'grid';
    let currentProviderFilter = 'all';
    let currentStatusFilter = 'all';
    let scatterZoom = 1;
    let isDragging = false;
    let draggedCard = null;
    let dragOffset = { x: 0, y: 0 };
    let isMagnetic = false;
    let magnetPos = { x: 0, y: 0 };
    let rafId = null;

    const STORAGE_KEY = 'dv_items_safe_v1';

    function generateMockData() {
        const providers = ['ChatGPT', 'Claude', 'Gemini', 'Grok', 'Copilot'];
        const statuses = ['active', 'cooldown', 'burnt'];
        return Array.from({ length: 15 }, (_, i) => ({
            id: Date.now() + i,
            provider: providers[i % providers.length],
            email: `user${i + 1}@example.com`,
            password: `password${i + 1}`,
            resetHours: 3 + (i % 4),
            status: statuses[i % statuses.length],
            position: {
                x: Math.random() * Math.max(0, window.innerWidth - 260),
                y: Math.random() * Math.max(0, window.innerHeight - 220)
            }
        }));
    }

    function loadSafeItems() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return null;
            const safe = JSON.parse(raw);
            return safe.map(s => ({
                id: s.id,
                provider: s.provider,
                email: s.email,
                password: '',
                resetHours: s.resetHours,
                status: s.status,
                position: s.position || { x: Math.random() * (window.innerWidth - 240), y: Math.random() * (window.innerHeight - 200) }
            }));
        } catch (err) { console.warn('failed to load saved items', err); return null; }
    }

    function saveSafeItems() {
        try {
            const safe = items.map(({ id, provider, email, resetHours, status, position }) => ({ id, provider, email, resetHours, status, position }));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(safe));
        } catch (err) { console.warn('failed to save items', err); }
    }

    const persisted = loadSafeItems();
    items = persisted || generateMockData();
    saveSafeItems();

    const indicator = document.getElementById('keyboardIndicator');
    function showKeyboardIndicator(key, label){
      document.getElementById('indicatorKey').textContent = key;
      document.getElementById('indicatorLabel').textContent = label;
      indicator.classList.add('show');
      setTimeout(()=>indicator.classList.remove('show'),800);
    }

    document.addEventListener('keydown', (e) => {
      const tg = e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA');
      if (tg) return;
      if (e.key === 'n' || e.key === 'N'){ e.preventDefault(); showKeyboardIndicator('N','New Item'); openModal(); }
      else if (e.key === ' '){ e.preventDefault(); showKeyboardIndicator('SPACE','Toggle Filters'); toggleFilters(); }
      else if (e.key === 'Escape'){ if (document.getElementById('modalOverlay').classList.contains('active')) closeModal(); }
    });

    function toggleFilters(){
      const statuses = ['all','active','cooldown','burnt'];
      const idx = statuses.indexOf(currentStatusFilter);
      currentStatusFilter = statuses[(idx+1) % statuses.length];
      document.querySelectorAll('.right-nav .nav-btn').forEach(btn => {
        const is = btn.dataset.status === currentStatusFilter;
        btn.classList.toggle('active', is);
        btn.setAttribute('aria-pressed', String(is));
      });
      renderView();
    }

    const modalOverlay = document.getElementById('modalOverlay');
    const fabBtn = document.getElementById('fabBtn');
    const closeModalBtn = document.getElementById('closeModal');

    function openModal(){
      modalOverlay.classList.add('active');
      modalOverlay._lastFocus = document.activeElement;
      const first = modalOverlay.querySelector('input,select,button');
      if (first) first.focus();
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      modalOverlay.classList.remove('active');
      if (modalOverlay._lastFocus && typeof modalOverlay._lastFocus.focus === 'function') modalOverlay._lastFocus.focus();
      document.body.style.overflow = '';
    }

    fabBtn.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });

    document.addEventListener('keydown', function(e){
      if (!modalOverlay.classList.contains('active')) return;
      if (e.key !== 'Tab') return;
      const focusable = Array.from(modalOverlay.querySelectorAll('a[href],button,textarea,input,select,[tabindex]:not([tabindex="-1"])')).filter(el => !el.disabled);
      if (!focusable.length) return;
      const idx = focusable.indexOf(document.activeElement);
      if (e.shiftKey && idx === 0){ e.preventDefault(); focusable[focusable.length - 1].focus(); }
      else if (!e.shiftKey && idx === focusable.length - 1){ e.preventDefault(); focusable[0].focus(); }
    });

    function getFilteredItems(){
      return items.filter(item => {
        const p = (currentProviderFilter === 'all') || item.provider === currentProviderFilter;
        const s = (currentStatusFilter === 'all') || item.status === currentStatusFilter;
        return p && s;
      });
    }

    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    function renderGrid(){
      const wrapper = document.getElementById('gridWrapper');
      const filtered = getFilteredItems();
      wrapper.innerHTML = filtered.map(item => `
        <div class="card status-${item.status}" data-id="${item.id}" role="listitem" tabindex="0">
          <div class="card-header">
            <div class="card-provider">${escapeHtml(item.provider)}</div>
            <div class="card-status ${item.status}">${escapeHtml(item.status)}</div>
          </div>
          <div class="card-info">
            <div style="color:var(--ink-2);font-size:14px;margin-bottom:10px">Reset: ${Number(item.resetHours)}h</div>
          </div>
          <div class="card-footer">
            <div class="card-label"><strong>Provider:</strong> ${escapeHtml(item.provider)}</div>
            <div class="card-label"><strong>Email:</strong> ${escapeHtml(item.email)}</div>
          </div>
        </div>
      `).join('');
    }

    function renderScatter(){
      const canvas = document.getElementById('scatterCanvas');
      const filtered = getFilteredItems();
      const existing = Array.from(canvas.querySelectorAll('.scatter-card'));
      const posMap = new Map();
      const canvasRect = canvas.getBoundingClientRect();
      existing.forEach(card => {
        const id = Number(card.dataset.id);
        const rect = card.getBoundingClientRect();
        posMap.set(id, {
          x: (rect.left - canvasRect.left),
          y: (rect.top - canvasRect.top)
        });
      });

      canvas.innerHTML = filtered.map(item => {
        const pos = posMap.get(item.id) || item.position;
        const left = Math.max(0, Math.min(pos.x, window.innerWidth - 260));
        const top = Math.max(0, Math.min(pos.y, window.innerHeight - 200));
        return `
          <div class="scatter-card status-${item.status}" data-id="${item.id}" style="transform:translate3d(${left}px,${top}px,0)">
            <div class="card-header">
              <div class="card-provider">${escapeHtml(item.provider)}</div>
              <div class="card-status ${item.status}">${escapeHtml(item.status)}</div>
            </div>
            <div class="card-footer" style="border:none;padding-top:10px">
              <div class="card-label"><strong>${escapeHtml(item.provider)}</strong></div>
              <div class="card-label" style="font-size:11px">${escapeHtml(item.email)}</div>
            </div>
          </div>
        `;
      }).join('');

      attachScatterHandlers();
    }

    function attachScatterHandlers(){
      const cards = document.querySelectorAll('.scatter-card');
      cards.forEach(card => {
        card.addEventListener('pointerdown', startDrag);
        card.style.touchAction = 'none';
      });
    }

    function startDrag(e){
      if (e.button === 2) return;
      draggedCard = e.currentTarget;
      isDragging = true;
      draggedCard.classList.add('dragging');
      const rect = draggedCard.getBoundingClientRect();
      const canvasRect = document.getElementById('scatterCanvas').getBoundingClientRect();
      const clientX = e.clientX;
      const clientY = e.clientY;
      dragOffset.x = clientX - rect.left;
      dragOffset.y = clientY - rect.top;
      try { draggedCard.setPointerCapture && draggedCard.setPointerCapture(e.pointerId); } catch (err) {}
      e.preventDefault();
    }

    document.addEventListener('pointermove', handleDrag, { passive:false });
    function handleDrag(e){
      if (!isDragging || !draggedCard) return;
      e.preventDefault();
      const canvas = document.getElementById('scatterCanvas');
      const canvasRect = canvas.getBoundingClientRect();
      const x = (e.clientX - canvasRect.left - dragOffset.x) / scatterZoom;
      const y = (e.clientY - canvasRect.top - dragOffset.y) / scatterZoom;
      const clampedX = Math.max(0, Math.min(x, canvasRect.width - 240));
      const clampedY = Math.max(0, Math.min(y, canvasRect.height - 120));
      draggedCard.style.transform = `translate3d(${clampedX}px,${clampedY}px,0)`;
      const id = Number(draggedCard.dataset.id);
      const item = items.find(i => i.id === id);
      if (item){ item.position = { x: clampedX, y: clampedY }; }
    }

    document.addEventListener('pointerup', stopDrag);
    function stopDrag(e){
      if (draggedCard){
        draggedCard.classList.remove('dragging');
        try { draggedCard.releasePointerCapture && draggedCard.releasePointerCapture(e && e.pointerId); } catch (err) {}
      }
      draggedCard = null;
      isDragging = false;
      saveSafeItems();
    }

    document.addEventListener('contextmenu', (e) => { if (currentView === 'scatter') e.preventDefault(); });

    document.addEventListener('pointerdown', (e) => {
      if (e.button === 2 && currentView === 'scatter'){
        isMagnetic = true;
        document.getElementById('magnetIndicator').classList.add('active');
        magnetPos = { x: e.clientX, y: e.clientY };
        startMagnetLoop();
      }
    });

    document.addEventListener('pointerup', (e) => {
      if (e.button === 2){
        isMagnetic = false;
        document.getElementById('magnetIndicator').classList.remove('active');
        document.querySelectorAll('.scatter-card').forEach(c => c.classList.remove('magnetic'));
        cancelAnimationFrame(rafId);
        saveSafeItems();
      }
    });

    document.addEventListener('pointermove', (e) => {
      if (isMagnetic && currentView === 'scatter') {
        magnetPos = { x: e.clientX, y: e.clientY };
        const indicator = document.getElementById('magnetIndicator');
        indicator.style.left = `${e.clientX - 50}px`;
        indicator.style.top = `${e.clientY - 50}px`;
      }
    });

    let touchHoldTimer;
    document.addEventListener('touchstart', (e) => {
      if (currentView === 'scatter' && e.touches.length === 1){
        const t = e.touches[0];
        touchHoldTimer = setTimeout(() => {
          isMagnetic = true;
          document.getElementById('magnetIndicator').classList.add('active');
          magnetPos = { x: t.clientX, y: t.clientY };
          startMagnetLoop();
        }, 450);
      }
    }, { passive: true });

    document.addEventListener('touchend', () => {
      clearTimeout(touchHoldTimer);
      if (isMagnetic){
        isMagnetic = false;
        document.getElementById('magnetIndicator').classList.remove('active');
        document.querySelectorAll('.scatter-card').forEach(c => c.classList.remove('magnetic'));
        cancelAnimationFrame(rafId);
        saveSafeItems();
      }
    });

    function startMagnetLoop(){
      if (rafId) cancelAnimationFrame(rafId);
      function loop(){
        if (!isMagnetic) return;
        const canvas = document.getElementById('scatterCanvas');
        const canvasRect = canvas.getBoundingClientRect();
        const cards = Array.from(document.querySelectorAll('.scatter-card'));
        cards.forEach(card => {
          card.classList.add('magnetic');
          const rect = card.getBoundingClientRect();
          const cardCenterX = rect.left + rect.width/2;
          const cardCenterY = rect.top + rect.height/2;
          const dx = magnetPos.x - cardCenterX;
          const dy = magnetPos.y - cardCenterY;
          const dist = Math.hypot(dx,dy);
          if (dist > 36){
            const pull = Math.min(0.28, 120 / Math.max(1, dist));
            const newX = ((rect.left - canvasRect.left) + dx * pull);
            const newY = ((rect.top - canvasRect.top) + dy * pull);
            const clampedX = Math.max(0, Math.min(newX, canvasRect.width - 240));
            const clampedY = Math.max(0, Math.min(newY, canvasRect.height - 120));
            card.style.transform = `translate3d(${clampedX}px,${clampedY}px,0)`;
            const id = Number(card.dataset.id);
            const item = items.find(i => i.id === id);
            if (item) item.position = { x: clampedX, y: clampedY };
          }
        });
        rafId = requestAnimationFrame(loop);
      }
      loop();
    }

    const zoomIn = document.getElementById('zoomIn'), zoomOut = document.getElementById('zoomOut'), zoomReset = document.getElementById('zoomReset');
    function updateZoom(delta){
      scatterZoom = Math.max(0.5, Math.min(3, scatterZoom + delta));
      document.getElementById('scatterCanvas').style.transform = `scale(${scatterZoom})`;
    }
    zoomIn.addEventListener('click', ()=> updateZoom(0.2));
    zoomOut.addEventListener('click', ()=> updateZoom(-0.2));
    zoomReset.addEventListener('click', ()=> { scatterZoom = 1; document.getElementById('scatterCanvas').style.transform = 'scale(1)'; });

    document.getElementById('scatterContainer').addEventListener('wheel', (e) => {
      if (currentView === 'scatter'){ e.preventDefault(); updateZoom(e.deltaY > 0 ? -0.1 : 0.1); }
    }, { passive:false });

    function switchView(view){
      currentView = view;
      const grid = document.getElementById('gridContainer');
      const scatter = document.getElementById('scatterContainer');
      const zc = document.getElementById('zoomControls');
      if (view === 'grid'){ grid.classList.add('active'); scatter.classList.remove('active'); zc.classList.remove('active'); scatter.setAttribute('aria-hidden','true'); grid.setAttribute('aria-hidden','false'); }
      else { grid.classList.remove('active'); scatter.classList.add('active'); zc.classList.add('active'); scatter.setAttribute('aria-hidden','false'); grid.setAttribute('aria-hidden','true'); }
      renderView();
    }

    function renderView(){ if (currentView === 'grid') renderGrid(); else renderScatter(); }

    document.querySelectorAll('.left-nav .nav-btn').forEach(btn => btn.addEventListener('click', () => {
      document.querySelectorAll('.left-nav .nav-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      btn.setAttribute('aria-pressed','true');
      switchView(btn.dataset.view);
    }));

    document.querySelectorAll('.top-nav .nav-btn').forEach(btn => btn.addEventListener('click', () => {
      document.querySelectorAll('.top-nav .nav-btn').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
      btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
      currentProviderFilter = btn.dataset.provider;
      renderView();
    }));

    document.querySelectorAll('.right-nav .nav-btn').forEach(btn => btn.addEventListener('click', () => {
      document.querySelectorAll('.right-nav .nav-btn').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
      btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
      currentStatusFilter = btn.dataset.status;
      renderView();
    }));

    document.getElementById('addForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const newItem = {
        id: Date.now(),
        provider: document.getElementById('formProvider').value,
        email: document.getElementById('formEmail').value,
        password: document.getElementById('formPassword').value,
        resetHours: parseFloat(document.getElementById('formResetHours').value),
        status: document.getElementById('formStatus').value,
        position: { x: Math.random() * Math.max(0, window.innerWidth - 260), y: Math.random() * Math.max(0, window.innerHeight - 220) }
      };
      items.push(newItem);
      document.getElementById('formPassword').value = '';
      closeModal();
      e.target.reset();
      saveSafeItems();
      renderView();
    });

    renderView();
    window.addEventListener('resize', () => { if (currentView === 'grid') renderGrid(); else renderScatter(); });
    window.addEventListener('beforeunload', saveSafeItems);
  </script>
</body>
</html>
