<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Click for clarity</title>
  <link href="https://fonts.googleapis.com" rel="preconnect" crossorigin>
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@500&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      background: #0f1014; /* Dark Default */
    }
    
    #canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }
    
    .instruction {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: rgba(255, 255, 255, 0.7);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      user-select: none;
      max-width: 90%;
      text-align: left;
      white-space: nowrap;
    }

    @media (max-width: 600px) {
      .instruction {
        letter-spacing: 0.1em;
        white-space: normal;
        line-height: 1.5;
      }
    }

    :root {
      --bg-color: #0f1014;
      --card-color: transparent;
      --ink: #ffffff;
      --ink-2: #9f9f9f;
      --ink-3: #6c6c6c;
      --accent: #83ff83;
      --curve-k: 1;
      --vig-opacity: .01;
      --edge-blur: 4.4px;
      --cursor-size: 20px;
      --corner-pad: clamp(14px, 2.4vw, 24px);
      --corner-top: calc(env(safe-area-inset-top) + clamp(12px, 2vh, 18px));
      --z-grain: 149;
      --z-blur: 4;
      --z-vig: .01;
      --z-ui: 220;
      --z-overlay: 250;
      --z-cursor: 230;
      --glass-bg: rgba(255, 255, 255, 0.04);
      --glass-bg-hover: rgba(255, 255, 255, 0.08);
      --glass-bg-bright: rgba(255, 255, 255, 0.12);
      --glass-border: rgba(255, 255, 255, 0.12);
      --fab-size: 80px;
      --fab-bottom: calc(env(safe-area-inset-bottom) + clamp(16px, 3vh, 32px));
      --base-font-size: 14px;
      --subtle-outline: rgba(255, 255, 255, 0.08);
      --font-stack: Inter, ui-sans-serif, system-ui;
    }

    [data-theme="dark"] {
      --bg-color: #0f1014;
      --ink: #ffffff;
      --ink-2: #9f9f9f;
      --ink-3: #6c6c6c;
      --accent: #83ff83;
      --glass-bg: rgba(255, 255, 255, 0.04);
      --glass-bg-hover: rgba(255, 255, 255, 0.08);
      --glass-bg-bright: rgba(255, 255, 255, 0.12);
      --glass-border: rgba(255, 255, 255, 0.12);
      --vig-opacity: .01;
      --edge-blur: 4.4px;
      --subtle-outline: rgba(255, 255, 255, 0.08);
      color-scheme: dark;
    }

    [data-theme="pedro"] {
      --bg-color: #921212;
      --ink: #ffffff;
      --ink-2: #f70131;
      --ink-3: #aaaaaa;
      --accent: #f70131;
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-bg-hover: rgba(255, 255, 255, 0.12);
      --glass-bg-bright: rgba(255, 255, 255, 0.16);
      --glass-border: rgba(255, 255, 255, 0.16);
      --vig-opacity: .02;
      --edge-blur: 3px;
      --subtle-outline: rgba(255, 255, 255, 0.12);
      color-scheme: dark;
    }

    [data-theme="dark"] .vignette {
      background: radial-gradient(120% 90% at 50% 50%, #fff0 10%, rgb(0 0 0 / 0.8) 60%, rgb(0 0 0 / 1) 100%);
    }

    [data-theme="pedro"] .vignette {
      background: radial-gradient(120% 90% at 50% 50%, #fff0 10%, rgb(146 18 18 / 0.6) 60%, rgb(146 18 18 / 0.9) 100%);
    }

    [data-theme="dark"] .edge-blur {
      mask: radial-gradient(100% 64% at 50% 50%, transparent 40%, rgb(255 255 255 / 0.98) 60%);
    }

    [data-theme="pedro"] .edge-blur {
      mask: radial-gradient(100% 64% at 50% 50%, transparent 40%, rgb(255 255 255 / 0.98) 60%);
    }

    @media (max-width: 768px) {
      .edge-blur {
        mask: radial-gradient(100% 80% at 50% 50%, transparent 70%, rgb(255 255 255 / 0.98) 85%);
      }
      [data-theme="dark"] .edge-blur {
        mask: radial-gradient(100% 80% at 50% 50%, transparent 50%, rgb(255 255 255 / 0.98) 70%);
      }
      [data-theme="pedro"] .edge-blur {
        mask: radial-gradient(100% 80% at 50% 50%, transparent 50%, rgb(255 255 255 / 0.98) 70%);
      }
    }

    *, *::before, *::after { box-sizing: border-box; }
    html { color-scheme: dark; font-size: var(--base-font-size); }
    body, html { height: 100%; margin: 0; background: var(--bg-color); }
    body {
      color: var(--ink);
      font-family: var(--font-stack);
      line-height: 1.4;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      touch-action: pan-y;
      -webkit-user-select: none;
      user-select: none;
      overscroll-behavior: none;
      transition: background-color 0.5s ease, color 0.5s ease;
    }

    body::after {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: var(--z-grain); opacity: 0.1;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.45'/%3E%3C/svg%3E");
      background-size: 120px 120px;
    }
    .curved {
      transform-style: preserve-3d;
      transform: perspective(2000px) rotateX(0deg) rotateY(0deg);
      will-change: transform;
    }

    .logo {
      position: fixed;
      top: var(--corner-top);
      left: var(--corner-pad);
      z-index: var(--z-ui);
      pointer-events: none;
    }

    .logo img {
      height: 32px;
      width: auto;
      display: block;
      transition: opacity 0.2s ease;
    }

    .top-toggle-nav {
      position: fixed;
      top: var(--corner-top);
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: var(--z-ui);
      background: var(--glass-bg);
      padding: 8px;
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      pointer-events: auto;
    }

    .top-toggle-nav button {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: var(--ink);
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
    }

    .top-toggle-nav button:hover {
      background: var(--glass-bg-hover);
    }

    .top-toggle-nav button svg {
      width: 1em;
      height: 1em;
      margin-left: 0.5em;
    }

    .top-toggle-nav button .emoji {
      display: none;
    }

    @media (max-width: 768px) {
      .top-toggle-nav button .text {
        display: none;
      }
      .top-toggle-nav button .emoji {
        display: inline;
      }
      .top-toggle-nav button svg {
        display: none;
      }
    }

    .fab {
      position: fixed;
      bottom: var(--fab-bottom);
      right: var(--corner-pad);
      z-index: var(--z-ui);
      width: var(--fab-size);
      height: var(--fab-size);
      border-radius: 50%;
      background: var(--glass-bg-bright);
      border: 1px solid var(--glass-border);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      pointer-events: auto;
    }

    .fab svg {
      width: 32px;
      height: 32px;
    }

    .overlay-sheet {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: var(--z-overlay);
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(0,0,0,0.5);
    }

    .overlay-sheet.open {
      opacity: 1;
      pointer-events: auto;
    }

    .sheet {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      width: 400px;
      background: var(--glass-bg);
      border-left: 1px solid var(--glass-border);
      padding: 24px;
      overflow-y: auto;
    }

    @media (max-width: 768px) {
      .sheet {
        width: 100%;
      }
    }

    .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--ink);
    }

    .reset-btn {
      padding: 12px 24px;
      background: var(--accent);
      color: var(--bg-color);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 16px;
    }

    #cursor {
      position: fixed;
      pointer-events: none;
      z-index: var(--z-cursor);
    }

    .cursor-circle {
      position: absolute;
      width: var(--cursor-size);
      height: var(--cursor-size);
      border-radius: 50%;
      background: var(--accent);
      opacity: 0.2;
      transform: translate(-50%, -50%);
    }

    .context-menu {
      display: none;
      position: absolute;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      padding: 8px;
      z-index: 300;
    }

    .context-menu button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px;
      background: transparent;
      border: none;
      color: var(--ink);
      cursor: pointer;
    }

    .context-menu button:hover {
      background: var(--glass-bg-hover);
    }

    .vignette {
      position: fixed; inset: 0; pointer-events: none; z-index: var(--z-vig);
      background: radial-gradient(120% 90% at 50% 50%, #fff0 10%, rgb(0 0 0 / 0.8) 60%, rgb(0 0 0 / 1) 100%);
      opacity: var(--vig-opacity);
    }

    .edge-blur {
      position: fixed; inset: 0; pointer-events: none; z-index: var(--z-blur);
      backdrop-filter: blur(var(--edge-blur)); -webkit-backdrop-filter: blur(var(--edge-blur));
      mask: radial-gradient(100% 64% at 50% 50%, transparent 40%, rgb(255 255 255 / 0.98) 60%);
    }

    @media (max-width: 768px) {
      .edge-blur {
        mask: radial-gradient(100% 80% at 50% 50%, transparent 50%, rgb(255 255 255 / 0.98) 70%);
      }
    }

    .right-toggle-nav, .left-toggle-nav {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: var(--z-ui);
      background: var(--glass-bg);
      padding: 8px;
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      pointer-events: auto;
      overflow-y: auto;
      max-height: 80vh;
    }

    .left-toggle-nav {
      left: var(--corner-pad);
    }

    .right-toggle-nav {
      right: var(--corner-pad);
    }

    .right-toggle-nav button, .left-toggle-nav button {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: var(--ink);
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
    }

    .right-toggle-nav button:hover, .left-toggle-nav button:hover {
      background: var(--glass-bg-hover);
    }

    .right-toggle-nav button.active, .left-toggle-nav button.active {
      background: var(--glass-bg-bright);
    }

    @media (max-width: 768px) {
      .right-toggle-nav button .text, .left-toggle-nav button .text {
        display: none;
      }
      .right-toggle-nav button .emoji, .left-toggle-nav button .emoji {
        display: inline;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="logo">
    <img id="logoImg" src="https://raw.githubusercontent.com/ZACKGORT/intoview/main/intoview-logo-light.svg.svg" alt="IntoView Logo">
  </div>

  <svg style="position: absolute; height: 0; width: 0;">
    <filter id="goo">
      <feGaussianBlur in="SourceGraphic" stdDeviation="1" result="blur" />
      <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -10" result="goo" />
      <feBlend in="SourceGraphic" in2="goo" />
    </filter>
  </svg>
  
  <canvas id="canvas"></canvas>
  <div class="overlay">
    <div class="instruction">One does not simply rebuild. One resets. Then builds. ‚Äî Zack Gort</div>
  </div>

  <div class="edge-blur"></div>
  <div class="vignette"></div>
  <div id="cursor"></div>

  <div class="top-toggle-nav">
    <button id="resetNavBtn"><span class="text">Reset</span><span class="emoji">üîÑ</span></button>
    <button id="pedroBtn"><span class="text">Pedro</span><span class="emoji">üéØ</span></button>
    <button id="cvBtn"><span class="text">CV</span><span class="emoji">üìÑ</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>
    <button id="noteBtn"><span class="text">Note</span><span class="emoji">üìù</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>
    <button id="kanbanBtn"><span class="text">Kanban</span><span class="emoji">üóÇÔ∏è</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>
    <button id="melodyBtn"><span class="text">Melody</span><span class="emoji">üé∂</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>
    <button id="emdashBtn"><span class="text">Emdash</span><span class="emoji">üìã</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>
    <button id="portfolioBtn"><span class="text">Portfolio</span><span class="emoji">üñºÔ∏è</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>
  </div>

  <div class="left-toggle-nav">
    <button id="smallGridBtn" title="4x8 grid"><span class="text"></span><span class="emoji">4:8</span></button>
    <button id="largeGridBtn" title="6x12 grid"><span class="text"></span><span class="emoji">6:12</span></button>
    <button id="pedroGridBtn" title="4x10 grid (Pedro)"><span class="text"></span><span class="emoji">4:10</span></button>
  </div>

  <div class="right-toggle-nav">
    <button id="jediBtn" title="Jedi: launch/touch radius allows more blocks to be influenced by a single click; maintains current influence"><span class="text">Jedi</span><span class="emoji">ü™Ñ</span></button>
    <button id="kickBtn" title="Kick: use current settings"><span class="text">Kick</span><span class="emoji">‚öΩ</span></button>
    <button id="tapBtn" title="Tap: light, curious kick/tap; less influence"><span class="text">Tap</span><span class="emoji">üëÜ</span></button>
  </div>

  <div class="fab-wrap">
    <button id="fabButton" class="fab" aria-label="Open menu">
      <svg viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="cubeTop" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#fff" stop-opacity="1" />
            <stop offset="1" stop-color="#dcdcdc" stop-opacity="1" />
          </linearGradient>
          <linearGradient id="cubeSide" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#e8e8e8" />
            <stop offset="1" stop-color="#bdbdbd" />
          </linearGradient>
          <linearGradient id="cubeDark" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#8a8a8a" />
            <stop offset="1" stop-color="#4b4b4b" />
          </linearGradient>
          <filter id="cubeGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000" flood-opacity=".45" />
          </filter>
        </defs>
        <g filter="url(#cubeGlow)">
          <polygon fill="url(#cubeTop)" points="50,14 80,30 50,46 20,30" />
          <polygon fill="url(#cubeSide)" points="80,30 80,66 50,82 50,46" />
          <polygon fill="url(#cubeDark)" points="50,46 50,82 20,66 20,30" />
        </g>
      </svg>
    </button>
  </div>

  <div id="overlay" class="overlay-sheet" aria-hidden="true">
    <div class="sheet">
      <button id="closeOverlay" class="close-btn">√ó</button>
      <div class="sheet-content">
        <summary><strong>Think Pink #FF8DA1</strong></summary><br>
        <div class="accordion-content">
          <p>Long story short, I was adopted and shipped to the US in a pink onezie (which is a boy's color in Korea). Anyway, it's become part of my personal brand, signifying my embrace of defying expectations from the get-go.</p>
        </div><br>
        <p>As for <strong>intoview.pro</strong>, I am using this space as a place for creative exploration and furtherence of my craft.</p>
      </div><br>

        <h2>Meanwhile...</h2>
        <p>Go kick [blocks]</p>
        <button id="resetBtn" class="reset-btn">#yolo</button>
      </div>
    </div>
  </div>

  <div id="contextMenu" class="context-menu">
    <button id="contextReset">Reset</button>
    <button id="contextCopyResume">Copy Resume Link</button>
    <button id="contextCopyPortfolio">Copy Portfolio Link</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
  
  <script>
    const canvas = document.getElementById('canvas');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x921212);
    
    const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 0, 5);
    
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    
    const world = new CANNON.World();
    world.gravity.set(0, -10, 0);
    world.broadphase = new CANNON.NaiveBroadphase();
    
    // Lighting setup matching Pedro demo
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);
    
    const pointLight = new THREE.PointLight(0xffffff, 4, 100);
    pointLight.position.set(0, 10, 2);
    pointLight.castShadow = true;
    pointLight.shadow.mapSize.width = 1024;
    pointLight.shadow.mapSize.height = 1024;
    pointLight.shadow.camera.far = 100;
    pointLight.shadow.camera.left = -10;
    pointLight.shadow.camera.right = 10;
    pointLight.shadow.camera.top = 10;
    pointLight.shadow.camera.bottom = -10;
    scene.add(pointLight);

    // Create cube render target for reflections
    const cubeRenderTarget = new THREE.WebGLCubeRenderTarget(1024, {
      format: THREE.RGBAFormat,
      generateMipmaps: true,
      minFilter: THREE.LinearMipmapLinearFilter
    });
    const cubeCamera = new THREE.CubeCamera(0.1, 100, cubeRenderTarget);
    scene.add(cubeCamera);

    // Create PEDRO text texture
    function createTextTexture(text, color) {
      const canvas = document.createElement('canvas');
      canvas.width = 2048;
      canvas.height = 512;
      const ctx = canvas.getContext('2d');
      
      ctx.fillStyle = 'transparent';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.font = 'bold 400px Kanit';
      ctx.fillStyle = color;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, canvas.width / 2, canvas.height / 2);
      
      const texture = new THREE.CanvasTexture(canvas);
      return texture;
    }

    // PEDRO text in front
    const pedroTexture = createTextTexture('¬°Viva la PX!', '#aaaaaa');
    const pedroGeo = new THREE.PlaneGeometry(13, 2.5);
    const pedroMat = new THREE.MeshBasicMaterial({ 
      map: pedroTexture,
      transparent: true,
      side: THREE.DoubleSide
    });
    const pedroMesh = new THREE.Mesh(pedroGeo, pedroMat);
    pedroMesh.position.set(0, 2, -10);
    scene.add(pedroMesh);

    // CLICK HERE text behind
    const clickTexture = createTextTexture('UX IS DEAD', '#f70131');
    const clickGeo = new THREE.PlaneGeometry(13, 2.5);
    const clickMat = new THREE.MeshBasicMaterial({ 
      map: clickTexture,
      transparent: true,
      side: THREE.DoubleSide
    });
    const clickMesh = new THREE.Mesh(clickGeo, clickMat);
    clickMesh.position.set(0, 2, 24);
    clickMesh.scale.set(-1, 1, 1);
    clickMesh.layers.enable(11);
    scene.add(clickMesh);

    // PEDRO text copies for cube camera
    const textCopies = [];
    const circleVertices = [
      new THREE.Vector3(0, 2, -10),
      new THREE.Vector3(10, 2, 0),
      new THREE.Vector3(-10, 2, 0),
      new THREE.Vector3(0, 12, 0),
      new THREE.Vector3(0, -8, 0)
    ];
    
    circleVertices.forEach((pos, i) => {
      if (i === 0) return; // Skip the main one
      const mesh = new THREE.Mesh(pedroGeo.clone(), pedroMat.clone());
      mesh.position.copy(pos);
      mesh.lookAt(0, 0, 0);
      mesh.layers.set(11);
      scene.add(mesh);
      textCopies.push(mesh);
    });

    // Ground plane
    const groundGeo = new THREE.PlaneGeometry(1000, 1000);
    const groundMat = new THREE.ShadowMaterial({ opacity: 0.2 });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -2;
    ground.receiveShadow = true;
    scene.add(ground);
    
    const groundShape = new CANNON.Plane();
    const groundBody = new CANNON.Body({ mass: 0 });
    groundBody.addShape(groundShape);
    groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
    groundBody.position.set(0, -2, 0);
    world.addBody(groundBody);

    // Back wall
    const backWallShape = new CANNON.Plane();
    const backWallBody = new CANNON.Body({ mass: 0 });
    backWallBody.addShape(backWallShape);
    backWallBody.position.set(0, 0, -20);
    world.addBody(backWallBody);

    // Text collision body
    const textShape = new CANNON.Box(new CANNON.Vec3(6.5, 1.25, 0.1));
    const textBody = new CANNON.Body({ mass: 0 });
    textBody.addShape(textShape);
    textBody.position.set(0, 2.25, -10);
    world.addBody(textBody);

    // Create mirror blocks
    let cubes = [];
    const ROWS = 4;
    const COLS = 10;
    const BOX_SIZE = 2;
    
    const sideMaterial = new THREE.MeshPhysicalMaterial({
      color: 0x921212,
      envMap: cubeRenderTarget.texture,
      roughness: 0.8,
      metalness: 0.2
    });
    
    const reflectionMaterial = new THREE.MeshPhysicalMaterial({
      envMap: cubeRenderTarget.texture,
      roughness: 0,
      metalness: 1,
      color: 0x929292
    });

    function createCubes() {
      for (let i = 0; i < ROWS; i++) {
        for (let j = 0; j < COLS; j++) {
          const cubeGeo = new THREE.BoxGeometry(BOX_SIZE, BOX_SIZE, BOX_SIZE);
          const materials = [
            sideMaterial,
            sideMaterial,
            sideMaterial,
            sideMaterial,
            reflectionMaterial,
            sideMaterial
          ];
          const cube = new THREE.Mesh(cubeGeo, materials);
          
          const x = -COLS + (j * BOX_SIZE);
          const y = -1 + BOX_SIZE * i;
          const z = 0;
          
          cube.position.set(x, y, z);
          cube.castShadow = true;
          cube.receiveShadow = true;
          scene.add(cube);
          
          const shape = new CANNON.Box(new CANNON.Vec3(BOX_SIZE / 2, BOX_SIZE / 2, BOX_SIZE / 2));
          const body = new CANNON.Body({ 
            mass: 1,
            material: new CANNON.Material({ friction: 1, restitution: 0 })
          });
          body.addShape(shape);
          body.position.set(x, y, z);
          body.linearDamping = 0.01;
          body.angularDamping = 0.3;
          world.addBody(body);
          
          cubes.push({ mesh: cube, body: body, initial: { x, y, z } });
        }
      }
    }

    createCubes();

    // Mouse interaction
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    
    function onMouseClick(event) {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(cubes.map(c => c.mesh));
      
      if (intersects.length > 0) {
        const cube = cubes.find(c => c.mesh === intersects[0].object);
        if (cube) {
          const impulse = new CANNON.Vec3(0, 0, -50);
          cube.body.applyImpulse(impulse, cube.body.position);
          
          const torque = new CANNON.Vec3(
            (Math.random() - 0.5) * 120,
            (Math.random() - 0.5) * 120,
            (Math.random() - 0.5) * 120
          );
          cube.body.angularVelocity.set(torque.x, torque.y, torque.z);
        }
      }
    }
    
    window.addEventListener('click', onMouseClick);

    // Mouse movement for rotation
    const targetRotation = { x: 0, y: 0 };
    const currentRotation = { x: 0, y: 0 };
    
    function onMouseMove(event) {
      targetRotation.y = (event.clientX / window.innerWidth - 0.5) * 0.2;
      targetRotation.x = (event.clientY / window.innerHeight - 0.5) * 0.2;
    }
    
    window.addEventListener('mousemove', onMouseMove);

    // Animation loop
    const fixedTimeStep = 1.0 / 60.0;
    let lastTime = 0;
    
    function animate() {
      requestAnimationFrame(animate);
      
      const currentTime = performance.now() / 1000;
      const deltaTime = currentTime - lastTime;
      lastTime = currentTime;
      
      world.step(fixedTimeStep, deltaTime, 3);
      
      cubes.forEach(({ mesh, body }) => {
        mesh.position.copy(body.position);
        mesh.quaternion.copy(body.quaternion);
      });
      
      currentRotation.x += (targetRotation.x - currentRotation.x) * 0.1;
      currentRotation.y += (targetRotation.y - currentRotation.y) * 0.1;
      scene.rotation.x = currentRotation.x;
      scene.rotation.y = currentRotation.y;
      
      // Update cube camera for reflections
      camera.layers.set(11);
      cubes.forEach(c => c.mesh.visible = false);
      cubeCamera.position.set(0, 0, 0);
      cubeCamera.update(renderer, scene);
      camera.layers.set(0);
      cubes.forEach(c => c.mesh.visible = true);
      
      renderer.render(scene, camera);
    }
    
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    window.addEventListener('resize', onWindowResize);
    
    animate();
  </script>
</body>
</html>
